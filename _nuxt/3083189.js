/*! For license information please see LICENSES */
(window.webpackJsonp=window.webpackJsonp||[]).push([[17],{903:function(e,t,n){"use strict";(function(e,t){var r=n(847),o=n(851),c=n(849),l=n(848),h=n(860),d="";function f(e){d=e}var _,v=function(){function e(e){this.domStorage_=e,this.prefix_="firebase:"}return e.prototype.set=function(e,t){null==t?this.domStorage_.removeItem(this.prefixedName_(e)):this.domStorage_.setItem(this.prefixedName_(e),Object(c.D)(t))},e.prototype.get=function(e){var t=this.domStorage_.getItem(this.prefixedName_(e));return null==t?null:Object(c.x)(t)},e.prototype.remove=function(e){this.domStorage_.removeItem(this.prefixedName_(e))},e.prototype.prefixedName_=function(e){return this.prefix_+e},e.prototype.toString=function(){return this.domStorage_.toString()},e}(),y=function(){function e(){this.cache_={},this.isInMemoryStorage=!0}return e.prototype.set=function(e,t){null==t?delete this.cache_[e]:this.cache_[e]=t},e.prototype.get=function(e){return Object(c.i)(this.cache_,e)?this.cache_[e]:null},e.prototype.remove=function(e){delete this.cache_[e]},e}(),m=function(e){try{if("undefined"!=typeof window&&void 0!==window[e]){var t=window[e];return t.setItem("firebase:sentinel","cache"),t.removeItem("firebase:sentinel"),new v(t)}}catch(e){}return new y},w=m("localStorage"),C=m("sessionStorage"),O=new h.b("@firebase/database"),T=(_=1,function(){return _++}),E=function(e){var t=Object(c.C)(e),n=new c.d;n.update(t);var r=n.digest();return c.g.encodeByteArray(r)},k=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];for(var n="",i=0;i<e.length;i++){var r=e[i];Array.isArray(r)||r&&"object"==typeof r&&"number"==typeof r.length?n+=k.apply(null,r):n+="object"==typeof r?Object(c.D)(r):r,n+=" "}return n},I=null,S=!0,P=function(e,t){Object(c.e)(!t||!0===e||!1===e,"Can't turn on custom loggers persistently."),!0===e?(O.logLevel=h.a.VERBOSE,I=O.log.bind(O),t&&C.set("logging_enabled",!0)):"function"==typeof e?I=e:(I=null,C.remove("logging_enabled"))},x=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];if(!0===S&&(S=!1,null===I&&!0===C.get("logging_enabled")&&P(!0)),I){var n=k.apply(null,e);I(n)}},j=function(e){return function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];x.apply(void 0,Object(l.f)([e],Object(l.e)(t)))}},N=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n="FIREBASE INTERNAL ERROR: "+k.apply(void 0,Object(l.f)([],Object(l.e)(e)));O.error(n)},R=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n="FIREBASE FATAL ERROR: "+k.apply(void 0,Object(l.f)([],Object(l.e)(e)));throw O.error(n),new Error(n)},D=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n="FIREBASE WARNING: "+k.apply(void 0,Object(l.f)([],Object(l.e)(e)));O.warn(n)},A=function(data){return"number"==typeof data&&(data!=data||data===Number.POSITIVE_INFINITY||data===Number.NEGATIVE_INFINITY)},F="[MIN_NAME]",M="[MAX_NAME]",L=function(a,b){if(a===b)return 0;if(a===F||b===M)return-1;if(b===F||a===M)return 1;var e=Y(a),t=Y(b);return null!==e?null!==t?e-t==0?a.length-b.length:e-t:-1:null!==t?1:a<b?-1:1},W=function(a,b){return a===b?0:a<b?-1:1},U=function(e,t){if(t&&e in t)return t[e];throw new Error("Missing required key ("+e+") in object: "+Object(c.D)(t))},B=function(e){if("object"!=typeof e||null===e)return Object(c.D)(e);var t=[];for(var n in e)t.push(n);t.sort();for(var r="{",i=0;i<t.length;i++)0!==i&&(r+=","),r+=Object(c.D)(t[i]),r+=":",r+=B(e[t[i]]);return r+="}"},Q=function(e,t){var n=e.length;if(n<=t)return[e];for(var r=[],o=0;o<n;o+=t)o+t>n?r.push(e.substring(o,n)):r.push(e.substring(o,o+t));return r};function V(e,t){for(var n in e)e.hasOwnProperty(n)&&t(n,e[n])}var H=function(e){Object(c.e)(!A(e),"Invalid JSON number");var s,t,n,r,i;0===e?(t=0,n=0,s=1/e==-1/0?1:0):(s=e<0,(e=Math.abs(e))>=Math.pow(2,-1022)?(t=(r=Math.min(Math.floor(Math.log(e)/Math.LN2),1023))+1023,n=Math.round(e*Math.pow(2,52-r)-Math.pow(2,52))):(t=0,n=Math.round(e/Math.pow(2,-1074))));var o=[];for(i=52;i;i-=1)o.push(n%2?1:0),n=Math.floor(n/2);for(i=11;i;i-=1)o.push(t%2?1:0),t=Math.floor(t/2);o.push(s?1:0),o.reverse();var l=o.join(""),h="";for(i=0;i<64;i+=8){var d=parseInt(l.substr(i,8),2).toString(16);1===d.length&&(d="0"+d),h+=d}return h.toLowerCase()};var z=new RegExp("^-?(0*)\\d{1,10}$"),Y=function(e){if(z.test(e)){var t=Number(e);if(t>=-2147483648&&t<=2147483647)return t}return null},K=function(e){try{e()}catch(e){setTimeout((function(){var t=e.stack||"";throw D("Exception was thrown by user callback.",t),e}),Math.floor(0))}},G=function(e,time){var t=setTimeout(e,time);return"object"==typeof t&&t.unref&&t.unref(),t},$=function(){function e(e,t){var n=this;this.appName_=e,this.appCheckProvider=t,this.appCheck=null==t?void 0:t.getImmediate({optional:!0}),this.appCheck||null==t||t.get().then((function(e){return n.appCheck=e}))}return e.prototype.getToken=function(e){var t=this;return this.appCheck?this.appCheck.getToken(e):new Promise((function(n,r){setTimeout((function(){t.appCheck?t.getToken(e).then(n,r):n(null)}),0)}))},e.prototype.addTokenChangeListener=function(e){var t;null===(t=this.appCheckProvider)||void 0===t||t.get().then((function(t){return t.addTokenListener(e)}))},e.prototype.notifyForInvalidToken=function(){D('Provided AppCheck credentials for the app named "'+this.appName_+'" are invalid. This usually indicates your app was not initialized correctly.')},e}(),J=function(){function e(e,t,n){var r=this;this.appName_=e,this.firebaseOptions_=t,this.authProvider_=n,this.auth_=null,this.auth_=n.getImmediate({optional:!0}),this.auth_||n.onInit((function(e){return r.auth_=e}))}return e.prototype.getToken=function(e){var t=this;return this.auth_?this.auth_.getToken(e).catch((function(e){return e&&"auth/token-not-initialized"===e.code?(x("Got auth/token-not-initialized error.  Treating as null token."),null):Promise.reject(e)})):new Promise((function(n,r){setTimeout((function(){t.auth_?t.getToken(e).then(n,r):n(null)}),0)}))},e.prototype.addTokenChangeListener=function(e){this.auth_?this.auth_.addAuthTokenListener(e):this.authProvider_.get().then((function(t){return t.addAuthTokenListener(e)}))},e.prototype.removeTokenChangeListener=function(e){this.authProvider_.get().then((function(t){return t.removeAuthTokenListener(e)}))},e.prototype.notifyForInvalidToken=function(){var e='Provided authentication credentials for the app named "'+this.appName_+'" are invalid. This usually indicates your app was not initialized correctly. ';"credential"in this.firebaseOptions_?e+='Make sure the "credential" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':"serviceAccount"in this.firebaseOptions_?e+='Make sure the "serviceAccount" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':e+='Make sure the "apiKey" and "databaseURL" properties provided to initializeApp() match the values provided for your app at https://console.firebase.google.com/.',D(e)},e}(),X=function(){function e(e){this.accessToken=e}return e.prototype.getToken=function(e){return Promise.resolve({accessToken:this.accessToken})},e.prototype.addTokenChangeListener=function(e){e(this.accessToken)},e.prototype.removeTokenChangeListener=function(e){},e.prototype.notifyForInvalidToken=function(){},e.OWNER="owner",e}(),Z=/(console\.firebase|firebase-console-\w+\.corp|firebase\.corp)\.google\.com/,ee=function(){function e(e,t,n,r,o,c,l){void 0===o&&(o=!1),void 0===c&&(c=""),void 0===l&&(l=!1),this.secure=t,this.namespace=n,this.webSocketOnly=r,this.nodeAdmin=o,this.persistenceKey=c,this.includeNamespaceInQueryParams=l,this._host=e.toLowerCase(),this._domain=this._host.substr(this._host.indexOf(".")+1),this.internalHost=w.get("host:"+e)||this._host}return e.prototype.isCacheableHost=function(){return"s-"===this.internalHost.substr(0,2)},e.prototype.isCustomHost=function(){return"firebaseio.com"!==this._domain&&"firebaseio-demo.com"!==this._domain},Object.defineProperty(e.prototype,"host",{get:function(){return this._host},set:function(e){e!==this.internalHost&&(this.internalHost=e,this.isCacheableHost()&&w.set("host:"+this._host,this.internalHost))},enumerable:!1,configurable:!0}),e.prototype.toString=function(){var e=this.toURLString();return this.persistenceKey&&(e+="<"+this.persistenceKey+">"),e},e.prototype.toURLString=function(){var e=this.secure?"https://":"http://",t=this.includeNamespaceInQueryParams?"?ns="+this.namespace:"";return""+e+this.host+"/"+t},e}();function te(e,t,n){var r;if(Object(c.e)("string"==typeof t,"typeof type must == string"),Object(c.e)("object"==typeof n,"typeof params must == object"),"websocket"===t)r=(e.secure?"wss://":"ws://")+e.internalHost+"/.ws?";else{if("long_polling"!==t)throw new Error("Unknown connection type: "+t);r=(e.secure?"https://":"http://")+e.internalHost+"/.lp?"}(function(e){return e.host!==e.internalHost||e.isCustomHost()||e.includeNamespaceInQueryParams})(e)&&(n.ns=e.namespace);var o=[];return V(n,(function(e,t){o.push(e+"="+t)})),r+o.join("&")}var ne=function(){function e(){this.counters_={}}return e.prototype.incrementCounter=function(e,t){void 0===t&&(t=1),Object(c.i)(this.counters_,e)||(this.counters_[e]=0),this.counters_[e]+=t},e.prototype.get=function(){return Object(c.l)(this.counters_)},e}(),re={},ie={};function oe(e){var t=e.toString();return re[t]||(re[t]=new ne),re[t]}var ae=function(){function e(e){this.onMessage_=e,this.pendingResponses=[],this.currentResponseNum=0,this.closeAfterResponse=-1,this.onClose=null}return e.prototype.closeAfter=function(e,t){this.closeAfterResponse=e,this.onClose=t,this.closeAfterResponse<this.currentResponseNum&&(this.onClose(),this.onClose=null)},e.prototype.handleResponse=function(e,data){var t=this;this.pendingResponses[e]=data;for(var n=function(){var e=r.pendingResponses[r.currentResponseNum];delete r.pendingResponses[r.currentResponseNum];for(var n=function(i){e[i]&&K((function(){t.onMessage_(e[i])}))},i=0;i<e.length;++i)n(i);if(r.currentResponseNum===r.closeAfterResponse)return r.onClose&&(r.onClose(),r.onClose=null),"break";r.currentResponseNum++},r=this;this.pendingResponses[this.currentResponseNum];){if("break"===n())break}},e}(),se=function(){function e(e,t,n,r,o,c,l){var h=this;this.connId=e,this.repoInfo=t,this.applicationId=n,this.appCheckToken=r,this.authToken=o,this.transportSessionId=c,this.lastSessionId=l,this.bytesSent=0,this.bytesReceived=0,this.everConnected_=!1,this.log_=j(e),this.stats_=oe(t),this.urlFn=function(e){return h.appCheckToken&&(e.ac=h.appCheckToken),te(t,"long_polling",e)}}return e.prototype.open=function(e,t){var n=this;this.curSegmentNum=0,this.onDisconnect_=t,this.myPacketOrderer=new ae(e),this.isClosed_=!1,this.connectTimeoutTimer_=setTimeout((function(){n.log_("Timed out trying to connect."),n.onClosed_(),n.connectTimeoutTimer_=null}),Math.floor(3e4)),function(e){if(Object(c.u)()||"complete"===document.readyState)e();else{var t=!1,n=function(){document.body?t||(t=!0,e()):setTimeout(n,Math.floor(10))};document.addEventListener?(document.addEventListener("DOMContentLoaded",n,!1),window.addEventListener("load",n,!1)):document.attachEvent&&(document.attachEvent("onreadystatechange",(function(){"complete"===document.readyState&&n()})),window.attachEvent("onload",n))}}((function(){if(!n.isClosed_){n.scriptTagHolder=new ue((function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r=Object(l.e)(e,5),o=r[0],c=r[1],h=r[2];if(r[3],r[4],n.incrementIncomingBytes_(e),n.scriptTagHolder)if(n.connectTimeoutTimer_&&(clearTimeout(n.connectTimeoutTimer_),n.connectTimeoutTimer_=null),n.everConnected_=!0,"start"===o)n.id=c,n.password=h;else{if("close"!==o)throw new Error("Unrecognized command received: "+o);c?(n.scriptTagHolder.sendNewPolls=!1,n.myPacketOrderer.closeAfter(c,(function(){n.onClosed_()}))):n.onClosed_()}}),(function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r=Object(l.e)(e,2),o=r[0],data=r[1];n.incrementIncomingBytes_(e),n.myPacketOrderer.handleResponse(o,data)}),(function(){n.onClosed_()}),n.urlFn);var e={start:"t"};e.ser=Math.floor(1e8*Math.random()),n.scriptTagHolder.uniqueCallbackIdentifier&&(e.cb=n.scriptTagHolder.uniqueCallbackIdentifier),e.v="5",n.transportSessionId&&(e.s=n.transportSessionId),n.lastSessionId&&(e.ls=n.lastSessionId),n.applicationId&&(e.p=n.applicationId),n.appCheckToken&&(e.ac=n.appCheckToken),"undefined"!=typeof location&&location.hostname&&Z.test(location.hostname)&&(e.r="f");var t=n.urlFn(e);n.log_("Connecting via long-poll to "+t),n.scriptTagHolder.addTag(t,(function(){}))}}))},e.prototype.start=function(){this.scriptTagHolder.startLongPoll(this.id,this.password),this.addDisconnectPingFrame(this.id,this.password)},e.forceAllow=function(){e.forceAllow_=!0},e.forceDisallow=function(){e.forceDisallow_=!0},e.isAvailable=function(){return!Object(c.u)()&&(!!e.forceAllow_||!(e.forceDisallow_||"undefined"==typeof document||null==document.createElement||"object"==typeof window&&window.chrome&&window.chrome.extension&&!/^chrome/.test(window.location.href)||"object"==typeof Windows&&"object"==typeof Windows.UI))},e.prototype.markConnectionHealthy=function(){},e.prototype.shutdown_=function(){this.isClosed_=!0,this.scriptTagHolder&&(this.scriptTagHolder.close(),this.scriptTagHolder=null),this.myDisconnFrame&&(document.body.removeChild(this.myDisconnFrame),this.myDisconnFrame=null),this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null)},e.prototype.onClosed_=function(){this.isClosed_||(this.log_("Longpoll is closing itself"),this.shutdown_(),this.onDisconnect_&&(this.onDisconnect_(this.everConnected_),this.onDisconnect_=null))},e.prototype.close=function(){this.isClosed_||(this.log_("Longpoll is being closed."),this.shutdown_())},e.prototype.send=function(data){var e=Object(c.D)(data);this.bytesSent+=e.length,this.stats_.incrementCounter("bytes_sent",e.length);for(var t=Object(c.h)(e),n=Q(t,1840),i=0;i<n.length;i++)this.scriptTagHolder.enqueueSegment(this.curSegmentNum,n.length,n[i]),this.curSegmentNum++},e.prototype.addDisconnectPingFrame=function(e,t){if(!Object(c.u)()){this.myDisconnFrame=document.createElement("iframe");var n={dframe:"t"};n.id=e,n.pw=t,this.myDisconnFrame.src=this.urlFn(n),this.myDisconnFrame.style.display="none",document.body.appendChild(this.myDisconnFrame)}},e.prototype.incrementIncomingBytes_=function(e){var t=Object(c.D)(e).length;this.bytesReceived+=t,this.stats_.incrementCounter("bytes_received",t)},e}(),ue=function(){function e(t,n,r,o){if(this.onDisconnect=r,this.urlFn=o,this.outstandingRequests=new Set,this.pendingSegs=[],this.currentSerial=Math.floor(1e8*Math.random()),this.sendNewPolls=!0,Object(c.u)())this.commandCB=t,this.onMessageCB=n;else{this.uniqueCallbackIdentifier=T(),window["pLPCommand"+this.uniqueCallbackIdentifier]=t,window["pRTLPCB"+this.uniqueCallbackIdentifier]=n,this.myIFrame=e.createIFrame_();var script="";if(this.myIFrame.src&&"javascript:"===this.myIFrame.src.substr(0,"javascript:".length))script='<script>document.domain="'+document.domain+'";<\/script>';var l="<html><body>"+script+"</body></html>";try{this.myIFrame.doc.open(),this.myIFrame.doc.write(l),this.myIFrame.doc.close()}catch(e){x("frame writing exception"),e.stack&&x(e.stack),x(e)}}}return e.createIFrame_=function(){var iframe=document.createElement("iframe");if(iframe.style.display="none",!document.body)throw"Document body has not initialized. Wait to initialize Firebase until after the document is ready.";document.body.appendChild(iframe);try{iframe.contentWindow.document||x("No IE domain setting required")}catch(t){var e=document.domain;iframe.src="javascript:void((function(){document.open();document.domain='"+e+"';document.close();})())"}return iframe.contentDocument?iframe.doc=iframe.contentDocument:iframe.contentWindow?iframe.doc=iframe.contentWindow.document:iframe.document&&(iframe.doc=iframe.document),iframe},e.prototype.close=function(){var e=this;this.alive=!1,this.myIFrame&&(this.myIFrame.doc.body.innerHTML="",setTimeout((function(){null!==e.myIFrame&&(document.body.removeChild(e.myIFrame),e.myIFrame=null)}),Math.floor(0)));var t=this.onDisconnect;t&&(this.onDisconnect=null,t())},e.prototype.startLongPoll=function(e,t){for(this.myID=e,this.myPW=t,this.alive=!0;this.newRequest_(););},e.prototype.newRequest_=function(){if(this.alive&&this.sendNewPolls&&this.outstandingRequests.size<(this.pendingSegs.length>0?2:1)){this.currentSerial++;var e={};e.id=this.myID,e.pw=this.myPW,e.ser=this.currentSerial;for(var t=this.urlFn(e),n="",i=0;this.pendingSegs.length>0;){if(!(this.pendingSegs[0].d.length+30+n.length<=1870))break;var r=this.pendingSegs.shift();n=n+"&seg"+i+"="+r.seg+"&ts"+i+"="+r.ts+"&d"+i+"="+r.d,i++}return t+=n,this.addLongPollTag_(t,this.currentSerial),!0}return!1},e.prototype.enqueueSegment=function(e,t,data){this.pendingSegs.push({seg:e,ts:t,d:data}),this.alive&&this.newRequest_()},e.prototype.addLongPollTag_=function(e,t){var n=this;this.outstandingRequests.add(t);var r=function(){n.outstandingRequests.delete(t),n.newRequest_()},o=setTimeout(r,Math.floor(25e3));this.addTag(e,(function(){clearTimeout(o),r()}))},e.prototype.addTag=function(e,t){var n=this;Object(c.u)()?this.doNodeLongPoll(e,t):setTimeout((function(){try{if(!n.sendNewPolls)return;var r=n.myIFrame.doc.createElement("script");r.type="text/javascript",r.async=!0,r.src=e,r.onload=r.onreadystatechange=function(){var e=r.readyState;e&&"loaded"!==e&&"complete"!==e||(r.onload=r.onreadystatechange=null,r.parentNode&&r.parentNode.removeChild(r),t())},r.onerror=function(){x("Long-poll script failed to load: "+e),n.sendNewPolls=!1,n.close()},n.myIFrame.doc.body.appendChild(r)}catch(e){}}),Math.floor(1))},e}(),ce=null;"undefined"!=typeof MozWebSocket?ce=MozWebSocket:"undefined"!=typeof WebSocket&&(ce=WebSocket);var le=function(){function t(e,n,r,o,c,l,h){this.connId=e,this.applicationId=r,this.appCheckToken=o,this.authToken=c,this.keepaliveTimer=null,this.frames=null,this.totalFrames=0,this.bytesSent=0,this.bytesReceived=0,this.log_=j(this.connId),this.stats_=oe(n),this.connURL=t.connectionURL_(n,l,h,o),this.nodeAdmin=n.nodeAdmin}return t.connectionURL_=function(e,t,n,r){var o={v:"5"};return!Object(c.u)()&&"undefined"!=typeof location&&location.hostname&&Z.test(location.hostname)&&(o.r="f"),t&&(o.s=t),n&&(o.ls=n),r&&(o.ac=r),te(e,"websocket",o)},t.prototype.open=function(t,n){var r=this;this.onDisconnect=n,this.onMessage=t,this.log_("Websocket connecting to "+this.connURL),this.everConnected_=!1,w.set("previous_websocket_failure",!0);try{if(Object(c.u)()){var o=this.nodeAdmin?"AdminNode":"Node",l={headers:{"User-Agent":"Firebase/5/"+d+"/"+e.platform+"/"+o,"X-Firebase-GMPID":this.applicationId||""}};this.authToken&&(l.headers.Authorization="Bearer "+this.authToken),this.appCheckToken&&(l.headers["X-Firebase-AppCheck"]=this.appCheckToken);var h=e.env,f=0===this.connURL.indexOf("wss://")?h.HTTPS_PROXY||h.https_proxy:h.HTTP_PROXY||h.http_proxy;f&&(l.proxy={origin:f}),this.mySock=new ce(this.connURL,[],l)}else{l={headers:{"X-Firebase-GMPID":this.applicationId||"","X-Firebase-AppCheck":this.appCheckToken||""}};this.mySock=new ce(this.connURL,[],l)}}catch(e){this.log_("Error instantiating WebSocket.");var _=e.message||e.data;return _&&this.log_(_),void this.onClosed_()}this.mySock.onopen=function(){r.log_("Websocket connected."),r.everConnected_=!0},this.mySock.onclose=function(){r.log_("Websocket connection was disconnected."),r.mySock=null,r.onClosed_()},this.mySock.onmessage=function(e){r.handleIncomingFrame(e)},this.mySock.onerror=function(e){r.log_("WebSocket error.  Closing connection.");var t=e.message||e.data;t&&r.log_(t),r.onClosed_()}},t.prototype.start=function(){},t.forceDisallow=function(){t.forceDisallow_=!0},t.isAvailable=function(){var e=!1;if("undefined"!=typeof navigator&&navigator.userAgent){var n=navigator.userAgent.match(/Android ([0-9]{0,}\.[0-9]{0,})/);n&&n.length>1&&parseFloat(n[1])<4.4&&(e=!0)}return!e&&null!==ce&&!t.forceDisallow_},t.previouslyFailed=function(){return w.isInMemoryStorage||!0===w.get("previous_websocket_failure")},t.prototype.markConnectionHealthy=function(){w.remove("previous_websocket_failure")},t.prototype.appendFrame_=function(data){if(this.frames.push(data),this.frames.length===this.totalFrames){var e=this.frames.join("");this.frames=null;var t=Object(c.x)(e);this.onMessage(t)}},t.prototype.handleNewFrameCount_=function(e){this.totalFrames=e,this.frames=[]},t.prototype.extractFrameCount_=function(data){if(Object(c.e)(null===this.frames,"We already have a frame buffer"),data.length<=6){var e=Number(data);if(!isNaN(e))return this.handleNewFrameCount_(e),null}return this.handleNewFrameCount_(1),data},t.prototype.handleIncomingFrame=function(e){if(null!==this.mySock){var data=e.data;if(this.bytesReceived+=data.length,this.stats_.incrementCounter("bytes_received",data.length),this.resetKeepAlive(),null!==this.frames)this.appendFrame_(data);else{var t=this.extractFrameCount_(data);null!==t&&this.appendFrame_(t)}}},t.prototype.send=function(data){this.resetKeepAlive();var e=Object(c.D)(data);this.bytesSent+=e.length,this.stats_.incrementCounter("bytes_sent",e.length);var t=Q(e,16384);t.length>1&&this.sendString_(String(t.length));for(var i=0;i<t.length;i++)this.sendString_(t[i])},t.prototype.shutdown_=function(){this.isClosed_=!0,this.keepaliveTimer&&(clearInterval(this.keepaliveTimer),this.keepaliveTimer=null),this.mySock&&(this.mySock.close(),this.mySock=null)},t.prototype.onClosed_=function(){this.isClosed_||(this.log_("WebSocket is closing itself"),this.shutdown_(),this.onDisconnect&&(this.onDisconnect(this.everConnected_),this.onDisconnect=null))},t.prototype.close=function(){this.isClosed_||(this.log_("WebSocket is being closed"),this.shutdown_())},t.prototype.resetKeepAlive=function(){var e=this;clearInterval(this.keepaliveTimer),this.keepaliveTimer=setInterval((function(){e.mySock&&e.sendString_("0"),e.resetKeepAlive()}),Math.floor(45e3))},t.prototype.sendString_=function(e){try{this.mySock.send(e)}catch(e){this.log_("Exception thrown from WebSocket.send():",e.message||e.data,"Closing connection."),setTimeout(this.onClosed_.bind(this),0)}},t.responsesRequiredToBeHealthy=2,t.healthyTimeout=3e4,t}(),he=function(){function e(e){this.initTransports_(e)}return Object.defineProperty(e,"ALL_TRANSPORTS",{get:function(){return[se,le]},enumerable:!1,configurable:!0}),e.prototype.initTransports_=function(t){var n,r,o=le&&le.isAvailable(),c=o&&!le.previouslyFailed();if(t.webSocketOnly&&(o||D("wss:// URL used, but browser isn't known to support websockets.  Trying anyway."),c=!0),c)this.transports_=[le];else{var h=this.transports_=[];try{for(var d=Object(l.g)(e.ALL_TRANSPORTS),f=d.next();!f.done;f=d.next()){var _=f.value;_&&_.isAvailable()&&h.push(_)}}catch(e){n={error:e}}finally{try{f&&!f.done&&(r=d.return)&&r.call(d)}finally{if(n)throw n.error}}}},e.prototype.initialTransport=function(){if(this.transports_.length>0)return this.transports_[0];throw new Error("No transports available")},e.prototype.upgradeTransport=function(){return this.transports_.length>1?this.transports_[1]:null},e}(),de=function(){function e(e,t,n,r,o,c,l,h,d,f){this.id=e,this.repoInfo_=t,this.applicationId_=n,this.appCheckToken_=r,this.authToken_=o,this.onMessage_=c,this.onReady_=l,this.onDisconnect_=h,this.onKill_=d,this.lastSessionId=f,this.connectionCount=0,this.pendingDataMessages=[],this.state_=0,this.log_=j("c:"+this.id+":"),this.transportManager_=new he(t),this.log_("Connection created"),this.start_()}return e.prototype.start_=function(){var e=this,t=this.transportManager_.initialTransport();this.conn_=new t(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,null,this.lastSessionId),this.primaryResponsesRequired_=t.responsesRequiredToBeHealthy||0;var n=this.connReceiver_(this.conn_),r=this.disconnReceiver_(this.conn_);this.tx_=this.conn_,this.rx_=this.conn_,this.secondaryConn_=null,this.isHealthy_=!1,setTimeout((function(){e.conn_&&e.conn_.open(n,r)}),Math.floor(0));var o=t.healthyTimeout||0;o>0&&(this.healthyTimeout_=G((function(){e.healthyTimeout_=null,e.isHealthy_||(e.conn_&&e.conn_.bytesReceived>102400?(e.log_("Connection exceeded healthy timeout but has received "+e.conn_.bytesReceived+" bytes.  Marking connection healthy."),e.isHealthy_=!0,e.conn_.markConnectionHealthy()):e.conn_&&e.conn_.bytesSent>10240?e.log_("Connection exceeded healthy timeout but has sent "+e.conn_.bytesSent+" bytes.  Leaving connection alive."):(e.log_("Closing unhealthy connection after timeout."),e.close()))}),Math.floor(o)))},e.prototype.nextTransportId_=function(){return"c:"+this.id+":"+this.connectionCount++},e.prototype.disconnReceiver_=function(e){var t=this;return function(n){e===t.conn_?t.onConnectionLost_(n):e===t.secondaryConn_?(t.log_("Secondary connection lost."),t.onSecondaryConnectionLost_()):t.log_("closing an old connection")}},e.prototype.connReceiver_=function(e){var t=this;return function(n){2!==t.state_&&(e===t.rx_?t.onPrimaryMessageReceived_(n):e===t.secondaryConn_?t.onSecondaryMessageReceived_(n):t.log_("message on old connection"))}},e.prototype.sendRequest=function(e){var t={t:"d",d:e};this.sendData_(t)},e.prototype.tryCleanupConnection=function(){this.tx_===this.secondaryConn_&&this.rx_===this.secondaryConn_&&(this.log_("cleaning up and promoting a connection: "+this.secondaryConn_.connId),this.conn_=this.secondaryConn_,this.secondaryConn_=null)},e.prototype.onSecondaryControl_=function(e){if("t"in e){var t=e.t;"a"===t?this.upgradeIfSecondaryHealthy_():"r"===t?(this.log_("Got a reset on secondary, closing it"),this.secondaryConn_.close(),this.tx_!==this.secondaryConn_&&this.rx_!==this.secondaryConn_||this.close()):"o"===t&&(this.log_("got pong on secondary."),this.secondaryResponsesRequired_--,this.upgradeIfSecondaryHealthy_())}},e.prototype.onSecondaryMessageReceived_=function(e){var t=U("t",e),data=U("d",e);if("c"===t)this.onSecondaryControl_(data);else{if("d"!==t)throw new Error("Unknown protocol layer: "+t);this.pendingDataMessages.push(data)}},e.prototype.upgradeIfSecondaryHealthy_=function(){this.secondaryResponsesRequired_<=0?(this.log_("Secondary connection is healthy."),this.isHealthy_=!0,this.secondaryConn_.markConnectionHealthy(),this.proceedWithUpgrade_()):(this.log_("sending ping on secondary."),this.secondaryConn_.send({t:"c",d:{t:"p",d:{}}}))},e.prototype.proceedWithUpgrade_=function(){this.secondaryConn_.start(),this.log_("sending client ack on secondary"),this.secondaryConn_.send({t:"c",d:{t:"a",d:{}}}),this.log_("Ending transmission on primary"),this.conn_.send({t:"c",d:{t:"n",d:{}}}),this.tx_=this.secondaryConn_,this.tryCleanupConnection()},e.prototype.onPrimaryMessageReceived_=function(e){var t=U("t",e),data=U("d",e);"c"===t?this.onControl_(data):"d"===t&&this.onDataMessage_(data)},e.prototype.onDataMessage_=function(e){this.onPrimaryResponse_(),this.onMessage_(e)},e.prototype.onPrimaryResponse_=function(){this.isHealthy_||(this.primaryResponsesRequired_--,this.primaryResponsesRequired_<=0&&(this.log_("Primary connection is healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()))},e.prototype.onControl_=function(e){var t=U("t",e);if("d"in e){var n=e.d;if("h"===t)this.onHandshake_(n);else if("n"===t){this.log_("recvd end transmission on primary"),this.rx_=this.secondaryConn_;for(var i=0;i<this.pendingDataMessages.length;++i)this.onDataMessage_(this.pendingDataMessages[i]);this.pendingDataMessages=[],this.tryCleanupConnection()}else"s"===t?this.onConnectionShutdown_(n):"r"===t?this.onReset_(n):"e"===t?N("Server Error: "+n):"o"===t?(this.log_("got pong on primary."),this.onPrimaryResponse_(),this.sendPingOnPrimaryIfNecessary_()):N("Unknown control packet command: "+t)}},e.prototype.onHandshake_=function(e){var t=e.ts,n=e.v,r=e.h;this.sessionId=e.s,this.repoInfo_.host=r,0===this.state_&&(this.conn_.start(),this.onConnectionEstablished_(this.conn_,t),"5"!==n&&D("Protocol version mismatch detected"),this.tryStartUpgrade_())},e.prototype.tryStartUpgrade_=function(){var e=this.transportManager_.upgradeTransport();e&&this.startUpgrade_(e)},e.prototype.startUpgrade_=function(e){var t=this;this.secondaryConn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,this.sessionId),this.secondaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;var n=this.connReceiver_(this.secondaryConn_),r=this.disconnReceiver_(this.secondaryConn_);this.secondaryConn_.open(n,r),G((function(){t.secondaryConn_&&(t.log_("Timed out trying to upgrade."),t.secondaryConn_.close())}),Math.floor(6e4))},e.prototype.onReset_=function(e){this.log_("Reset packet received.  New host: "+e),this.repoInfo_.host=e,1===this.state_?this.close():(this.closeConnections_(),this.start_())},e.prototype.onConnectionEstablished_=function(e,t){var n=this;this.log_("Realtime connection established."),this.conn_=e,this.state_=1,this.onReady_&&(this.onReady_(t,this.sessionId),this.onReady_=null),0===this.primaryResponsesRequired_?(this.log_("Primary connection is healthy."),this.isHealthy_=!0):G((function(){n.sendPingOnPrimaryIfNecessary_()}),Math.floor(5e3))},e.prototype.sendPingOnPrimaryIfNecessary_=function(){this.isHealthy_||1!==this.state_||(this.log_("sending ping on primary."),this.sendData_({t:"c",d:{t:"p",d:{}}}))},e.prototype.onSecondaryConnectionLost_=function(){var e=this.secondaryConn_;this.secondaryConn_=null,this.tx_!==e&&this.rx_!==e||this.close()},e.prototype.onConnectionLost_=function(e){this.conn_=null,e||0!==this.state_?1===this.state_&&this.log_("Realtime connection lost."):(this.log_("Realtime connection failed."),this.repoInfo_.isCacheableHost()&&(w.remove("host:"+this.repoInfo_.host),this.repoInfo_.internalHost=this.repoInfo_.host)),this.close()},e.prototype.onConnectionShutdown_=function(e){this.log_("Connection shutdown command received. Shutting down..."),this.onKill_&&(this.onKill_(e),this.onKill_=null),this.onDisconnect_=null,this.close()},e.prototype.sendData_=function(data){if(1!==this.state_)throw"Connection is not connected";this.tx_.send(data)},e.prototype.close=function(){2!==this.state_&&(this.log_("Closing realtime connection."),this.state_=2,this.closeConnections_(),this.onDisconnect_&&(this.onDisconnect_(),this.onDisconnect_=null))},e.prototype.closeConnections_=function(){this.log_("Shutting down all connections"),this.conn_&&(this.conn_.close(),this.conn_=null),this.secondaryConn_&&(this.secondaryConn_.close(),this.secondaryConn_=null),this.healthyTimeout_&&(clearTimeout(this.healthyTimeout_),this.healthyTimeout_=null)},e}(),pe=function(){function e(){}return e.prototype.put=function(e,data,t,n){},e.prototype.merge=function(e,data,t,n){},e.prototype.refreshAuthToken=function(e){},e.prototype.refreshAppCheckToken=function(e){},e.prototype.onDisconnectPut=function(e,data,t){},e.prototype.onDisconnectMerge=function(e,data,t){},e.prototype.onDisconnectCancel=function(e,t){},e.prototype.reportStats=function(e){},e}(),fe=function(){function e(e){this.allowedEvents_=e,this.listeners_={},Object(c.e)(Array.isArray(e)&&e.length>0,"Requires a non-empty array")}return e.prototype.trigger=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];if(Array.isArray(this.listeners_[e]))for(var r=Object(l.f)([],Object(l.e)(this.listeners_[e])),i=0;i<r.length;i++)r[i].callback.apply(r[i].context,t)},e.prototype.on=function(e,t,n){this.validateEventType_(e),this.listeners_[e]=this.listeners_[e]||[],this.listeners_[e].push({callback:t,context:n});var r=this.getInitialEvent(e);r&&t.apply(n,r)},e.prototype.off=function(e,t,n){this.validateEventType_(e);for(var r=this.listeners_[e]||[],i=0;i<r.length;i++)if(r[i].callback===t&&(!n||n===r[i].context))return void r.splice(i,1)},e.prototype.validateEventType_=function(e){Object(c.e)(this.allowedEvents_.find((function(t){return t===e})),"Unknown event: "+e)},e}(),_e=function(e){function t(){var t=e.call(this,["online"])||this;return t.online_=!0,"undefined"==typeof window||void 0===window.addEventListener||Object(c.s)()||(window.addEventListener("online",(function(){t.online_||(t.online_=!0,t.trigger("online",!0))}),!1),window.addEventListener("offline",(function(){t.online_&&(t.online_=!1,t.trigger("online",!1))}),!1)),t}return Object(l.c)(t,e),t.getInstance=function(){return new t},t.prototype.getInitialEvent=function(e){return Object(c.e)("online"===e,"Unknown event type: "+e),[this.online_]},t.prototype.currentlyOnline=function(){return this.online_},t}(fe),ve=function(){function e(e,t){if(void 0===t){this.pieces_=e.split("/");for(var n=0,i=0;i<this.pieces_.length;i++)this.pieces_[i].length>0&&(this.pieces_[n]=this.pieces_[i],n++);this.pieces_.length=n,this.pieceNum_=0}else this.pieces_=e,this.pieceNum_=t}return e.prototype.toString=function(){for(var e="",i=this.pieceNum_;i<this.pieces_.length;i++)""!==this.pieces_[i]&&(e+="/"+this.pieces_[i]);return e||"/"},e}();function ye(){return new ve("")}function ge(path){return path.pieceNum_>=path.pieces_.length?null:path.pieces_[path.pieceNum_]}function me(path){return path.pieces_.length-path.pieceNum_}function be(path){var e=path.pieceNum_;return e<path.pieces_.length&&e++,new ve(path.pieces_,e)}function we(path){return path.pieceNum_<path.pieces_.length?path.pieces_[path.pieces_.length-1]:null}function Ce(path,e){return void 0===e&&(e=0),path.pieces_.slice(path.pieceNum_+e)}function Oe(path){if(path.pieceNum_>=path.pieces_.length)return null;for(var e=[],i=path.pieceNum_;i<path.pieces_.length-1;i++)e.push(path.pieces_[i]);return new ve(e,0)}function Te(path,e){for(var t=[],i=path.pieceNum_;i<path.pieces_.length;i++)t.push(path.pieces_[i]);if(e instanceof ve)for(i=e.pieceNum_;i<e.pieces_.length;i++)t.push(e.pieces_[i]);else{var n=e.split("/");for(i=0;i<n.length;i++)n[i].length>0&&t.push(n[i])}return new ve(t,0)}function Ee(path){return path.pieceNum_>=path.pieces_.length}function ke(e,t){var n=ge(e),r=ge(t);if(null===n)return t;if(n===r)return ke(be(e),be(t));throw new Error("INTERNAL ERROR: innerPath ("+t+") is not within outerPath ("+e+")")}function Ie(e,t){for(var n=Ce(e,0),r=Ce(t,0),i=0;i<n.length&&i<r.length;i++){var o=L(n[i],r[i]);if(0!==o)return o}return n.length===r.length?0:n.length<r.length?-1:1}function Se(path,e){if(me(path)!==me(e))return!1;for(var i=path.pieceNum_,t=e.pieceNum_;i<=path.pieces_.length;i++,t++)if(path.pieces_[i]!==e.pieces_[t])return!1;return!0}function Pe(path,e){var i=path.pieceNum_,t=e.pieceNum_;if(me(path)>me(e))return!1;for(;i<path.pieces_.length;){if(path.pieces_[i]!==e.pieces_[t])return!1;++i,++t}return!0}var xe=function(path,e){this.errorPrefix_=e,this.parts_=Ce(path,0),this.byteLength_=Math.max(1,this.parts_.length);for(var i=0;i<this.parts_.length;i++)this.byteLength_+=Object(c.B)(this.parts_[i]);je(this)};function je(e){if(e.byteLength_>768)throw new Error(e.errorPrefix_+"has a key path longer than 768 bytes ("+e.byteLength_+").");if(e.parts_.length>32)throw new Error(e.errorPrefix_+"path specified exceeds the maximum depth that can be written (32) or object contains a cycle "+Ne(e))}function Ne(e){return 0===e.parts_.length?"":"in property '"+e.parts_.join(".")+"'"}var Re,De,Ae=function(e){function t(){var t,n,r=e.call(this,["visible"])||this;return"undefined"!=typeof document&&void 0!==document.addEventListener&&(void 0!==document.hidden?(n="visibilitychange",t="hidden"):void 0!==document.mozHidden?(n="mozvisibilitychange",t="mozHidden"):void 0!==document.msHidden?(n="msvisibilitychange",t="msHidden"):void 0!==document.webkitHidden&&(n="webkitvisibilitychange",t="webkitHidden")),r.visible_=!0,n&&document.addEventListener(n,(function(){var e=!document[t];e!==r.visible_&&(r.visible_=e,r.trigger("visible",e))}),!1),r}return Object(l.c)(t,e),t.getInstance=function(){return new t},t.prototype.getInitialEvent=function(e){return Object(c.e)("visible"===e,"Unknown event type: "+e),[this.visible_]},t}(fe),Fe=function(e){function t(n,r,o,l,h,d,f,_){var v=e.call(this)||this;if(v.repoInfo_=n,v.applicationId_=r,v.onDataUpdate_=o,v.onConnectStatus_=l,v.onServerInfoUpdate_=h,v.authTokenProvider_=d,v.appCheckTokenProvider_=f,v.authOverride_=_,v.id=t.nextPersistentConnectionId_++,v.log_=j("p:"+v.id+":"),v.interruptReasons_={},v.listens=new Map,v.outstandingPuts_=[],v.outstandingGets_=[],v.outstandingPutCount_=0,v.outstandingGetCount_=0,v.onDisconnectRequestQueue_=[],v.connected_=!1,v.reconnectDelay_=1e3,v.maxReconnectDelay_=3e5,v.securityDebugCallback_=null,v.lastSessionId=null,v.establishConnectionTimer_=null,v.visible_=!1,v.requestCBHash_={},v.requestNumber_=0,v.realtime_=null,v.authToken_=null,v.appCheckToken_=null,v.forceTokenRefresh_=!1,v.invalidAuthTokenCount_=0,v.invalidAppCheckTokenCount_=0,v.firstConnection_=!0,v.lastConnectionAttemptTime_=null,v.lastConnectionEstablishedTime_=null,_&&!Object(c.u)())throw new Error("Auth override specified in options, but not supported on non Node.js platforms");return Ae.getInstance().on("visible",v.onVisible_,v),-1===n.host.indexOf("fblocal")&&_e.getInstance().on("online",v.onOnline_,v),v}return Object(l.c)(t,e),t.prototype.sendRequest=function(e,body,t){var n=++this.requestNumber_,r={r:n,a:e,b:body};this.log_(Object(c.D)(r)),Object(c.e)(this.connected_,"sendRequest call when we're not connected not allowed."),this.realtime_.sendRequest(r),t&&(this.requestCBHash_[n]=t)},t.prototype.get=function(e){var t=this;this.initConnection_();var n=new c.a,r={p:e._path.toString(),q:e._queryObject},o={action:"g",request:r,onComplete:function(e){var o=e.d;"ok"===e.s?(t.onDataUpdate_(r.p,o,!1,null),n.resolve(o)):n.reject(o)}};this.outstandingGets_.push(o),this.outstandingGetCount_++;var l=this.outstandingGets_.length-1;return this.connected_||setTimeout((function(){var e=t.outstandingGets_[l];void 0!==e&&o===e&&(delete t.outstandingGets_[l],t.outstandingGetCount_--,0===t.outstandingGetCount_&&(t.outstandingGets_=[]),t.log_("get "+l+" timed out on connection"),n.reject(new Error("Client is offline.")))}),3e3),this.connected_&&this.sendGet_(l),n.promise},t.prototype.listen=function(e,t,n,r){this.initConnection_();var o=e._queryIdentifier,l=e._path.toString();this.log_("Listen called for "+l+" "+o),this.listens.has(l)||this.listens.set(l,new Map),Object(c.e)(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"listen() called for non-default but complete query"),Object(c.e)(!this.listens.get(l).has(o),"listen() called twice for same path/queryId.");var h={onComplete:r,hashFn:t,query:e,tag:n};this.listens.get(l).set(o,h),this.connected_&&this.sendListen_(h)},t.prototype.sendGet_=function(e){var t=this,n=this.outstandingGets_[e];this.sendRequest("g",n.request,(function(r){delete t.outstandingGets_[e],t.outstandingGetCount_--,0===t.outstandingGetCount_&&(t.outstandingGets_=[]),n.onComplete&&n.onComplete(r)}))},t.prototype.sendListen_=function(e){var n=this,r=e.query,o=r._path.toString(),c=r._queryIdentifier;this.log_("Listen on "+o+" for "+c);var l={p:o};e.tag&&(l.q=r._queryObject,l.t=e.tag),l.h=e.hashFn(),this.sendRequest("q",l,(function(l){var h=l.d,d=l.s;t.warnOnListenWarnings_(h,r),(n.listens.get(o)&&n.listens.get(o).get(c))===e&&(n.log_("listen response",l),"ok"!==d&&n.removeListen_(o,c),e.onComplete&&e.onComplete(d,h))}))},t.warnOnListenWarnings_=function(e,t){if(e&&"object"==typeof e&&Object(c.i)(e,"w")){var n=Object(c.A)(e,"w");if(Array.isArray(n)&&~n.indexOf("no_index")){var r='".indexOn": "'+t._queryParams.getIndex().toString()+'"',o=t._path.toString();D("Using an unspecified index. Your data will be downloaded and filtered on the client. Consider adding "+r+" at "+o+" to your security rules for better performance.")}}},t.prototype.refreshAuthToken=function(e){this.authToken_=e,this.log_("Auth token refreshed"),this.authToken_?this.tryAuth():this.connected_&&this.sendRequest("unauth",{},(function(){})),this.reduceReconnectDelayIfAdminCredential_(e)},t.prototype.reduceReconnectDelayIfAdminCredential_=function(e){(e&&40===e.length||Object(c.p)(e))&&(this.log_("Admin auth credential detected.  Reducing max reconnect time."),this.maxReconnectDelay_=3e4)},t.prototype.refreshAppCheckToken=function(e){this.appCheckToken_=e,this.log_("App check token refreshed"),this.appCheckToken_?this.tryAppCheck():this.connected_&&this.sendRequest("unappeck",{},(function(){}))},t.prototype.tryAuth=function(){var e=this;if(this.connected_&&this.authToken_){var t=this.authToken_,n=Object(c.w)(t)?"auth":"gauth",r={cred:t};null===this.authOverride_?r.noauth=!0:"object"==typeof this.authOverride_&&(r.authvar=this.authOverride_),this.sendRequest(n,r,(function(n){var r=n.s,data=n.d||"error";e.authToken_===t&&("ok"===r?e.invalidAuthTokenCount_=0:e.onAuthRevoked_(r,data))}))}},t.prototype.tryAppCheck=function(){var e=this;this.connected_&&this.appCheckToken_&&this.sendRequest("appcheck",{token:this.appCheckToken_},(function(t){var n=t.s,data=t.d||"error";"ok"===n?e.invalidAppCheckTokenCount_=0:e.onAppCheckRevoked_(n,data)}))},t.prototype.unlisten=function(e,t){var n=e._path.toString(),r=e._queryIdentifier;this.log_("Unlisten called for "+n+" "+r),Object(c.e)(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"unlisten() called for non-default but complete query"),this.removeListen_(n,r)&&this.connected_&&this.sendUnlisten_(n,r,e._queryObject,t)},t.prototype.sendUnlisten_=function(e,t,n,r){this.log_("Unlisten on "+e+" for "+t);var o={p:e};r&&(o.q=n,o.t=r),this.sendRequest("n",o)},t.prototype.onDisconnectPut=function(e,data,t){this.initConnection_(),this.connected_?this.sendOnDisconnect_("o",e,data,t):this.onDisconnectRequestQueue_.push({pathString:e,action:"o",data:data,onComplete:t})},t.prototype.onDisconnectMerge=function(e,data,t){this.initConnection_(),this.connected_?this.sendOnDisconnect_("om",e,data,t):this.onDisconnectRequestQueue_.push({pathString:e,action:"om",data:data,onComplete:t})},t.prototype.onDisconnectCancel=function(e,t){this.initConnection_(),this.connected_?this.sendOnDisconnect_("oc",e,null,t):this.onDisconnectRequestQueue_.push({pathString:e,action:"oc",data:null,onComplete:t})},t.prototype.sendOnDisconnect_=function(e,t,data,n){var r={p:t,d:data};this.log_("onDisconnect "+e,r),this.sendRequest(e,r,(function(e){n&&setTimeout((function(){n(e.s,e.d)}),Math.floor(0))}))},t.prototype.put=function(e,data,t,n){this.putInternal("p",e,data,t,n)},t.prototype.merge=function(e,data,t,n){this.putInternal("m",e,data,t,n)},t.prototype.putInternal=function(e,t,data,n,r){this.initConnection_();var o={p:t,d:data};void 0!==r&&(o.h=r),this.outstandingPuts_.push({action:e,request:o,onComplete:n}),this.outstandingPutCount_++;var c=this.outstandingPuts_.length-1;this.connected_?this.sendPut_(c):this.log_("Buffering put: "+t)},t.prototype.sendPut_=function(e){var t=this,n=this.outstandingPuts_[e].action,r=this.outstandingPuts_[e].request,o=this.outstandingPuts_[e].onComplete;this.outstandingPuts_[e].queued=this.connected_,this.sendRequest(n,r,(function(r){t.log_(n+" response",r),delete t.outstandingPuts_[e],t.outstandingPutCount_--,0===t.outstandingPutCount_&&(t.outstandingPuts_=[]),o&&o(r.s,r.d)}))},t.prototype.reportStats=function(e){var t=this;if(this.connected_){var n={c:e};this.log_("reportStats",n),this.sendRequest("s",n,(function(e){if("ok"!==e.s){var n=e.d;t.log_("reportStats","Error sending stats: "+n)}}))}},t.prototype.onDataMessage_=function(e){if("r"in e){this.log_("from server: "+Object(c.D)(e));var t=e.r,n=this.requestCBHash_[t];n&&(delete this.requestCBHash_[t],n(e.b))}else{if("error"in e)throw"A server-side error has occurred: "+e.error;"a"in e&&this.onDataPush_(e.a,e.b)}},t.prototype.onDataPush_=function(e,body){this.log_("handleServerMessage",e,body),"d"===e?this.onDataUpdate_(body.p,body.d,!1,body.t):"m"===e?this.onDataUpdate_(body.p,body.d,!0,body.t):"c"===e?this.onListenRevoked_(body.p,body.q):"ac"===e?this.onAuthRevoked_(body.s,body.d):"apc"===e?this.onAppCheckRevoked_(body.s,body.d):"sd"===e?this.onSecurityDebugPacket_(body):N("Unrecognized action received from server: "+Object(c.D)(e)+"\nAre you using the latest client?")},t.prototype.onReady_=function(e,t){this.log_("connection ready"),this.connected_=!0,this.lastConnectionEstablishedTime_=(new Date).getTime(),this.handleTimestamp_(e),this.lastSessionId=t,this.firstConnection_&&this.sendConnectStats_(),this.restoreState_(),this.firstConnection_=!1,this.onConnectStatus_(!0)},t.prototype.scheduleConnect_=function(e){var t=this;Object(c.e)(!this.realtime_,"Scheduling a connect when we're already connected/ing?"),this.establishConnectionTimer_&&clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=setTimeout((function(){t.establishConnectionTimer_=null,t.establishConnection_()}),Math.floor(e))},t.prototype.initConnection_=function(){!this.realtime_&&this.firstConnection_&&this.scheduleConnect_(0)},t.prototype.onVisible_=function(e){e&&!this.visible_&&this.reconnectDelay_===this.maxReconnectDelay_&&(this.log_("Window became visible.  Reducing delay."),this.reconnectDelay_=1e3,this.realtime_||this.scheduleConnect_(0)),this.visible_=e},t.prototype.onOnline_=function(e){e?(this.log_("Browser went online."),this.reconnectDelay_=1e3,this.realtime_||this.scheduleConnect_(0)):(this.log_("Browser went offline.  Killing connection."),this.realtime_&&this.realtime_.close())},t.prototype.onRealtimeDisconnect_=function(){if(this.log_("data client disconnected"),this.connected_=!1,this.realtime_=null,this.cancelSentTransactions_(),this.requestCBHash_={},this.shouldReconnect_()){if(this.visible_){if(this.lastConnectionEstablishedTime_){(new Date).getTime()-this.lastConnectionEstablishedTime_>3e4&&(this.reconnectDelay_=1e3),this.lastConnectionEstablishedTime_=null}}else this.log_("Window isn't visible.  Delaying reconnect."),this.reconnectDelay_=this.maxReconnectDelay_,this.lastConnectionAttemptTime_=(new Date).getTime();var e=(new Date).getTime()-this.lastConnectionAttemptTime_,t=Math.max(0,this.reconnectDelay_-e);t=Math.random()*t,this.log_("Trying to reconnect in "+t+"ms"),this.scheduleConnect_(t),this.reconnectDelay_=Math.min(this.maxReconnectDelay_,1.3*this.reconnectDelay_)}this.onConnectStatus_(!1)},t.prototype.establishConnection_=function(){return Object(l.b)(this,void 0,void 0,(function(){var e,n,r,o,h,d,f,_,v,y,m,w,C,O,T=this;return Object(l.d)(this,(function(E){switch(E.label){case 0:if(!this.shouldReconnect_())return[3,4];this.log_("Making a connection attempt"),this.lastConnectionAttemptTime_=(new Date).getTime(),this.lastConnectionEstablishedTime_=null,e=this.onDataMessage_.bind(this),n=this.onReady_.bind(this),r=this.onRealtimeDisconnect_.bind(this),o=this.id+":"+t.nextConnectionId_++,h=this.lastSessionId,d=!1,f=null,_=function(){f?f.close():(d=!0,r())},v=function(e){Object(c.e)(f,"sendRequest call when we're not connected not allowed."),f.sendRequest(e)},this.realtime_={close:_,sendRequest:v},y=this.forceTokenRefresh_,this.forceTokenRefresh_=!1,E.label=1;case 1:return E.trys.push([1,3,,4]),[4,Promise.all([this.authTokenProvider_.getToken(y),this.appCheckTokenProvider_.getToken(y)])];case 2:return m=l.e.apply(void 0,[E.sent(),2]),w=m[0],C=m[1],d?x("getToken() completed but was canceled"):(x("getToken() completed. Creating connection."),this.authToken_=w&&w.accessToken,this.appCheckToken_=C&&C.token,f=new de(o,this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,e,n,r,(function(e){D(e+" ("+T.repoInfo_.toString()+")"),T.interrupt("server_kill")}),h)),[3,4];case 3:return O=E.sent(),this.log_("Failed to get token: "+O),d||(this.repoInfo_.nodeAdmin&&D(O),_()),[3,4];case 4:return[2]}}))}))},t.prototype.interrupt=function(e){x("Interrupting connection for reason: "+e),this.interruptReasons_[e]=!0,this.realtime_?this.realtime_.close():(this.establishConnectionTimer_&&(clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=null),this.connected_&&this.onRealtimeDisconnect_())},t.prototype.resume=function(e){x("Resuming connection for reason: "+e),delete this.interruptReasons_[e],Object(c.r)(this.interruptReasons_)&&(this.reconnectDelay_=1e3,this.realtime_||this.scheduleConnect_(0))},t.prototype.handleTimestamp_=function(e){var t=e-(new Date).getTime();this.onServerInfoUpdate_({serverTimeOffset:t})},t.prototype.cancelSentTransactions_=function(){for(var i=0;i<this.outstandingPuts_.length;i++){var e=this.outstandingPuts_[i];e&&"h"in e.request&&e.queued&&(e.onComplete&&e.onComplete("disconnect"),delete this.outstandingPuts_[i],this.outstandingPutCount_--)}0===this.outstandingPutCount_&&(this.outstandingPuts_=[])},t.prototype.onListenRevoked_=function(e,t){var n;n=t?t.map((function(q){return B(q)})).join("$"):"default";var r=this.removeListen_(e,n);r&&r.onComplete&&r.onComplete("permission_denied")},t.prototype.removeListen_=function(e,t){var n,r=new ve(e).toString();if(this.listens.has(r)){var map=this.listens.get(r);n=map.get(t),map.delete(t),0===map.size&&this.listens.delete(r)}else n=void 0;return n},t.prototype.onAuthRevoked_=function(e,t){x("Auth token revoked: "+e+"/"+t),this.authToken_=null,this.forceTokenRefresh_=!0,this.realtime_.close(),"invalid_token"!==e&&"permission_denied"!==e||(this.invalidAuthTokenCount_++,this.invalidAuthTokenCount_>=3&&(this.reconnectDelay_=3e4,this.authTokenProvider_.notifyForInvalidToken()))},t.prototype.onAppCheckRevoked_=function(e,t){x("App check token revoked: "+e+"/"+t),this.appCheckToken_=null,this.forceTokenRefresh_=!0,"invalid_token"!==e&&"permission_denied"!==e||(this.invalidAppCheckTokenCount_++,this.invalidAppCheckTokenCount_>=3&&this.appCheckTokenProvider_.notifyForInvalidToken())},t.prototype.onSecurityDebugPacket_=function(body){this.securityDebugCallback_?this.securityDebugCallback_(body):"msg"in body&&console.log("FIREBASE: "+body.msg.replace("\n","\nFIREBASE: "))},t.prototype.restoreState_=function(){var e,t,n,r;this.tryAuth(),this.tryAppCheck();try{for(var o=Object(l.g)(this.listens.values()),c=o.next();!c.done;c=o.next()){var h=c.value;try{for(var d=(n=void 0,Object(l.g)(h.values())),f=d.next();!f.done;f=d.next()){var _=f.value;this.sendListen_(_)}}catch(e){n={error:e}}finally{try{f&&!f.done&&(r=d.return)&&r.call(d)}finally{if(n)throw n.error}}}}catch(t){e={error:t}}finally{try{c&&!c.done&&(t=o.return)&&t.call(o)}finally{if(e)throw e.error}}for(var i=0;i<this.outstandingPuts_.length;i++)this.outstandingPuts_[i]&&this.sendPut_(i);for(;this.onDisconnectRequestQueue_.length;){var v=this.onDisconnectRequestQueue_.shift();this.sendOnDisconnect_(v.action,v.pathString,v.data,v.onComplete)}for(i=0;i<this.outstandingGets_.length;i++)this.outstandingGets_[i]&&this.sendGet_(i)},t.prototype.sendConnectStats_=function(){var e={},t="js";Object(c.u)()&&(t=this.repoInfo_.nodeAdmin?"admin_node":"node"),e["sdk."+t+"."+d.replace(/\./g,"-")]=1,Object(c.s)()?e["framework.cordova"]=1:Object(c.v)()&&(e["framework.reactnative"]=1),this.reportStats(e)},t.prototype.shouldReconnect_=function(){var e=_e.getInstance().currentlyOnline();return Object(c.r)(this.interruptReasons_)&&e},t.nextPersistentConnectionId_=0,t.nextConnectionId_=0,t}(pe),qe=function(){function e(e,t){this.name=e,this.node=t}return e.Wrap=function(t,n){return new e(t,n)},e}(),Me=function(){function e(){}return e.prototype.getCompare=function(){return this.compare.bind(this)},e.prototype.indexedValueChanged=function(e,t){var n=new qe(F,e),r=new qe(F,t);return 0!==this.compare(n,r)},e.prototype.minPost=function(){return qe.MIN},e}(),Le=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Object(l.c)(t,e),Object.defineProperty(t,"__EMPTY_NODE",{get:function(){return Re},set:function(e){Re=e},enumerable:!1,configurable:!0}),t.prototype.compare=function(a,b){return L(a.name,b.name)},t.prototype.isDefinedOn=function(e){throw Object(c.f)("KeyIndex.isDefinedOn not expected to be called.")},t.prototype.indexedValueChanged=function(e,t){return!1},t.prototype.minPost=function(){return qe.MIN},t.prototype.maxPost=function(){return new qe(M,Re)},t.prototype.makePost=function(e,t){return Object(c.e)("string"==typeof e,"KeyIndex indexValue must always be a string."),new qe(e,Re)},t.prototype.toString=function(){return".key"},t}(Me),We=new Le,Ue=function(){function e(e,t,n,r,o){void 0===o&&(o=null),this.isReverse_=r,this.resultGenerator_=o,this.nodeStack_=[];for(var c=1;!e.isEmpty();)if(e=e,c=t?n(e.key,t):1,r&&(c*=-1),c<0)e=this.isReverse_?e.left:e.right;else{if(0===c){this.nodeStack_.push(e);break}this.nodeStack_.push(e),e=this.isReverse_?e.right:e.left}}return e.prototype.getNext=function(){if(0===this.nodeStack_.length)return null;var e,t=this.nodeStack_.pop();if(e=this.resultGenerator_?this.resultGenerator_(t.key,t.value):{key:t.key,value:t.value},this.isReverse_)for(t=t.left;!t.isEmpty();)this.nodeStack_.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack_.push(t),t=t.left;return e},e.prototype.hasNext=function(){return this.nodeStack_.length>0},e.prototype.peek=function(){if(0===this.nodeStack_.length)return null;var e=this.nodeStack_[this.nodeStack_.length-1];return this.resultGenerator_?this.resultGenerator_(e.key,e.value):{key:e.key,value:e.value}},e}(),Be=function(){function e(t,n,r,o,c){this.key=t,this.value=n,this.color=null!=r?r:e.RED,this.left=null!=o?o:Ve.EMPTY_NODE,this.right=null!=c?c:Ve.EMPTY_NODE}return e.prototype.copy=function(t,n,r,o,c){return new e(null!=t?t:this.key,null!=n?n:this.value,null!=r?r:this.color,null!=o?o:this.left,null!=c?c:this.right)},e.prototype.count=function(){return this.left.count()+1+this.right.count()},e.prototype.isEmpty=function(){return!1},e.prototype.inorderTraversal=function(e){return this.left.inorderTraversal(e)||!!e(this.key,this.value)||this.right.inorderTraversal(e)},e.prototype.reverseTraversal=function(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)},e.prototype.min_=function(){return this.left.isEmpty()?this:this.left.min_()},e.prototype.minKey=function(){return this.min_().key},e.prototype.maxKey=function(){return this.right.isEmpty()?this.key:this.right.maxKey()},e.prototype.insert=function(e,t,n){var r=this,o=n(e,r.key);return(r=o<0?r.copy(null,null,null,r.left.insert(e,t,n),null):0===o?r.copy(null,t,null,null,null):r.copy(null,null,null,null,r.right.insert(e,t,n))).fixUp_()},e.prototype.removeMin_=function(){if(this.left.isEmpty())return Ve.EMPTY_NODE;var e=this;return e.left.isRed_()||e.left.left.isRed_()||(e=e.moveRedLeft_()),(e=e.copy(null,null,null,e.left.removeMin_(),null)).fixUp_()},e.prototype.remove=function(e,t){var n,r;if(t(e,(n=this).key)<0)n.left.isEmpty()||n.left.isRed_()||n.left.left.isRed_()||(n=n.moveRedLeft_()),n=n.copy(null,null,null,n.left.remove(e,t),null);else{if(n.left.isRed_()&&(n=n.rotateRight_()),n.right.isEmpty()||n.right.isRed_()||n.right.left.isRed_()||(n=n.moveRedRight_()),0===t(e,n.key)){if(n.right.isEmpty())return Ve.EMPTY_NODE;r=n.right.min_(),n=n.copy(r.key,r.value,null,null,n.right.removeMin_())}n=n.copy(null,null,null,null,n.right.remove(e,t))}return n.fixUp_()},e.prototype.isRed_=function(){return this.color},e.prototype.fixUp_=function(){var e=this;return e.right.isRed_()&&!e.left.isRed_()&&(e=e.rotateLeft_()),e.left.isRed_()&&e.left.left.isRed_()&&(e=e.rotateRight_()),e.left.isRed_()&&e.right.isRed_()&&(e=e.colorFlip_()),e},e.prototype.moveRedLeft_=function(){var e=this.colorFlip_();return e.right.left.isRed_()&&(e=(e=(e=e.copy(null,null,null,null,e.right.rotateRight_())).rotateLeft_()).colorFlip_()),e},e.prototype.moveRedRight_=function(){var e=this.colorFlip_();return e.left.left.isRed_()&&(e=(e=e.rotateRight_()).colorFlip_()),e},e.prototype.rotateLeft_=function(){var t=this.copy(null,null,e.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)},e.prototype.rotateRight_=function(){var t=this.copy(null,null,e.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)},e.prototype.colorFlip_=function(){var e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)},e.prototype.checkMaxDepth_=function(){var e=this.check_();return Math.pow(2,e)<=this.count()+1},e.prototype.check_=function(){if(this.isRed_()&&this.left.isRed_())throw new Error("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed_())throw new Error("Right child of ("+this.key+","+this.value+") is red");var e=this.left.check_();if(e!==this.right.check_())throw new Error("Black depths differ");return e+(this.isRed_()?0:1)},e.RED=!0,e.BLACK=!1,e}(),Qe=function(){function e(){}return e.prototype.copy=function(e,t,n,r,o){return this},e.prototype.insert=function(e,t,n){return new Be(e,t,null)},e.prototype.remove=function(e,t){return this},e.prototype.count=function(){return 0},e.prototype.isEmpty=function(){return!0},e.prototype.inorderTraversal=function(e){return!1},e.prototype.reverseTraversal=function(e){return!1},e.prototype.minKey=function(){return null},e.prototype.maxKey=function(){return null},e.prototype.check_=function(){return 0},e.prototype.isRed_=function(){return!1},e}(),Ve=function(){function e(t,n){void 0===n&&(n=e.EMPTY_NODE),this.comparator_=t,this.root_=n}return e.prototype.insert=function(t,n){return new e(this.comparator_,this.root_.insert(t,n,this.comparator_).copy(null,null,Be.BLACK,null,null))},e.prototype.remove=function(t){return new e(this.comparator_,this.root_.remove(t,this.comparator_).copy(null,null,Be.BLACK,null,null))},e.prototype.get=function(e){for(var t,n=this.root_;!n.isEmpty();){if(0===(t=this.comparator_(e,n.key)))return n.value;t<0?n=n.left:t>0&&(n=n.right)}return null},e.prototype.getPredecessorKey=function(e){for(var t,n=this.root_,r=null;!n.isEmpty();){if(0===(t=this.comparator_(e,n.key))){if(n.left.isEmpty())return r?r.key:null;for(n=n.left;!n.right.isEmpty();)n=n.right;return n.key}t<0?n=n.left:t>0&&(r=n,n=n.right)}throw new Error("Attempted to find predecessor key for a nonexistent key.  What gives?")},e.prototype.isEmpty=function(){return this.root_.isEmpty()},e.prototype.count=function(){return this.root_.count()},e.prototype.minKey=function(){return this.root_.minKey()},e.prototype.maxKey=function(){return this.root_.maxKey()},e.prototype.inorderTraversal=function(e){return this.root_.inorderTraversal(e)},e.prototype.reverseTraversal=function(e){return this.root_.reverseTraversal(e)},e.prototype.getIterator=function(e){return new Ue(this.root_,null,this.comparator_,!1,e)},e.prototype.getIteratorFrom=function(e,t){return new Ue(this.root_,e,this.comparator_,!1,t)},e.prototype.getReverseIteratorFrom=function(e,t){return new Ue(this.root_,e,this.comparator_,!0,t)},e.prototype.getReverseIterator=function(e){return new Ue(this.root_,null,this.comparator_,!0,e)},e.EMPTY_NODE=new Qe,e}();function He(e,t){return L(e.name,t.name)}function ze(e,t){return L(e,t)}var Ye,Ke,Ge,$e=function(e){return"number"==typeof e?"number:"+H(e):"string:"+e},Je=function(e){if(e.isLeafNode()){var t=e.val();Object(c.e)("string"==typeof t||"number"==typeof t||"object"==typeof t&&Object(c.i)(t,".sv"),"Priority must be a string or number.")}else Object(c.e)(e===De||e.isEmpty(),"priority of unexpected type.");Object(c.e)(e===De||e.getPriority().isEmpty(),"Priority nodes can't have a priority of their own.")},Xe=function(){function e(t,n){void 0===n&&(n=e.__childrenNodeConstructor.EMPTY_NODE),this.value_=t,this.priorityNode_=n,this.lazyHash_=null,Object(c.e)(void 0!==this.value_&&null!==this.value_,"LeafNode shouldn't be created with null/undefined value."),Je(this.priorityNode_)}return Object.defineProperty(e,"__childrenNodeConstructor",{get:function(){return Ye},set:function(e){Ye=e},enumerable:!1,configurable:!0}),e.prototype.isLeafNode=function(){return!0},e.prototype.getPriority=function(){return this.priorityNode_},e.prototype.updatePriority=function(t){return new e(this.value_,t)},e.prototype.getImmediateChild=function(t){return".priority"===t?this.priorityNode_:e.__childrenNodeConstructor.EMPTY_NODE},e.prototype.getChild=function(path){return Ee(path)?this:".priority"===ge(path)?this.priorityNode_:e.__childrenNodeConstructor.EMPTY_NODE},e.prototype.hasChild=function(){return!1},e.prototype.getPredecessorChildName=function(e,t){return null},e.prototype.updateImmediateChild=function(t,n){return".priority"===t?this.updatePriority(n):n.isEmpty()&&".priority"!==t?this:e.__childrenNodeConstructor.EMPTY_NODE.updateImmediateChild(t,n).updatePriority(this.priorityNode_)},e.prototype.updateChild=function(path,t){var n=ge(path);return null===n?t:t.isEmpty()&&".priority"!==n?this:(Object(c.e)(".priority"!==n||1===me(path),".priority must be the last token in a path"),this.updateImmediateChild(n,e.__childrenNodeConstructor.EMPTY_NODE.updateChild(be(path),t)))},e.prototype.isEmpty=function(){return!1},e.prototype.numChildren=function(){return 0},e.prototype.forEachChild=function(e,t){return!1},e.prototype.val=function(e){return e&&!this.getPriority().isEmpty()?{".value":this.getValue(),".priority":this.getPriority().val()}:this.getValue()},e.prototype.hash=function(){if(null===this.lazyHash_){var e="";this.priorityNode_.isEmpty()||(e+="priority:"+$e(this.priorityNode_.val())+":");var t=typeof this.value_;e+=t+":",e+="number"===t?H(this.value_):this.value_,this.lazyHash_=E(e)}return this.lazyHash_},e.prototype.getValue=function(){return this.value_},e.prototype.compareTo=function(t){return t===e.__childrenNodeConstructor.EMPTY_NODE?1:t instanceof e.__childrenNodeConstructor?-1:(Object(c.e)(t.isLeafNode(),"Unknown node type"),this.compareToLeafNode_(t))},e.prototype.compareToLeafNode_=function(t){var n=typeof t.value_,r=typeof this.value_,o=e.VALUE_TYPE_ORDER.indexOf(n),l=e.VALUE_TYPE_ORDER.indexOf(r);return Object(c.e)(o>=0,"Unknown leaf type: "+n),Object(c.e)(l>=0,"Unknown leaf type: "+r),o===l?"object"===r?0:this.value_<t.value_?-1:this.value_===t.value_?0:1:l-o},e.prototype.withIndex=function(){return this},e.prototype.isIndexed=function(){return!0},e.prototype.equals=function(e){if(e===this)return!0;if(e.isLeafNode()){var t=e;return this.value_===t.value_&&this.priorityNode_.equals(t.priorityNode_)}return!1},e.VALUE_TYPE_ORDER=["object","boolean","number","string"],e}();var Ze,et,tt=new(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Object(l.c)(t,e),t.prototype.compare=function(a,b){var e=a.node.getPriority(),t=b.node.getPriority(),n=e.compareTo(t);return 0===n?L(a.name,b.name):n},t.prototype.isDefinedOn=function(e){return!e.getPriority().isEmpty()},t.prototype.indexedValueChanged=function(e,t){return!e.getPriority().equals(t.getPriority())},t.prototype.minPost=function(){return qe.MIN},t.prototype.maxPost=function(){return new qe(M,new Xe("[PRIORITY-POST]",Ge))},t.prototype.makePost=function(e,t){var n=Ke(e);return new qe(t,new Xe("[PRIORITY-POST]",n))},t.prototype.toString=function(){return".priority"},t}(Me)),nt=Math.log(2),it=function(){function e(e){var t;this.count=(t=e+1,parseInt(Math.log(t)/nt,10)),this.current_=this.count-1;var n,mask=(n=this.count,parseInt(Array(n+1).join("1"),2));this.bits_=e+1&mask}return e.prototype.nextBitIsOne=function(){var e=!(this.bits_&1<<this.current_);return this.current_--,e},e}(),ot=function(e,t,n,r){e.sort(t);var o=function(t,r){var c,l,h=r-t;if(0===h)return null;if(1===h)return c=e[t],l=n?n(c):c,new Be(l,c.node,Be.BLACK,null,null);var d=parseInt(h/2,10)+t,f=o(t,d),_=o(d+1,r);return c=e[d],l=n?n(c):c,new Be(l,c.node,Be.BLACK,f,_)},c=function(t){for(var r=null,c=null,l=e.length,h=function(t,r){var c=l-t,h=l;l-=t;var f=o(c+1,h),_=e[c],v=n?n(_):_;d(new Be(v,_.node,r,null,f))},d=function(e){r?(r.left=e,r=e):(c=e,r=e)},i=0;i<t.count;++i){var f=t.nextBitIsOne(),_=Math.pow(2,t.count-(i+1));f?h(_,Be.BLACK):(h(_,Be.BLACK),h(_,Be.RED))}return c}(new it(e.length));return new Ve(r||t,c)},at={},st=function(){function e(e,t){this.indexes_=e,this.indexSet_=t}return Object.defineProperty(e,"Default",{get:function(){return Object(c.e)(at&&tt,"ChildrenNode.ts has not been loaded"),Ze=Ze||new e({".priority":at},{".priority":tt})},enumerable:!1,configurable:!0}),e.prototype.get=function(e){var t=Object(c.A)(this.indexes_,e);if(!t)throw new Error("No index defined for "+e);return t instanceof Ve?t:null},e.prototype.hasIndex=function(e){return Object(c.i)(this.indexSet_,e.toString())},e.prototype.addIndex=function(t,n){Object(c.e)(t!==We,"KeyIndex always exists and isn't meant to be added to the IndexMap.");for(var r,o=[],h=!1,d=n.getIterator(qe.Wrap),f=d.getNext();f;)h=h||t.isDefinedOn(f.node),o.push(f),f=d.getNext();r=h?ot(o,t.getCompare()):at;var _=t.toString(),v=Object(l.a)({},this.indexSet_);v[_]=t;var y=Object(l.a)({},this.indexes_);return y[_]=r,new e(y,v)},e.prototype.addToIndexes=function(t,n){var r=this;return new e(Object(c.y)(this.indexes_,(function(e,o){var l=Object(c.A)(r.indexSet_,o);if(Object(c.e)(l,"Missing index implementation for "+o),e===at){if(l.isDefinedOn(t.node)){for(var h=[],d=n.getIterator(qe.Wrap),f=d.getNext();f;)f.name!==t.name&&h.push(f),f=d.getNext();return h.push(t),ot(h,l.getCompare())}return at}var _=n.get(t.name),v=e;return _&&(v=v.remove(new qe(t.name,_))),v.insert(t,t.node)})),this.indexSet_)},e.prototype.removeFromIndexes=function(t,n){return new e(Object(c.y)(this.indexes_,(function(e){if(e===at)return e;var r=n.get(t.name);return r?e.remove(new qe(t.name,r)):e})),this.indexSet_)},e}(),ut=function(){function e(e,t,n){this.children_=e,this.priorityNode_=t,this.indexMap_=n,this.lazyHash_=null,this.priorityNode_&&Je(this.priorityNode_),this.children_.isEmpty()&&Object(c.e)(!this.priorityNode_||this.priorityNode_.isEmpty(),"An empty node cannot have a priority")}return Object.defineProperty(e,"EMPTY_NODE",{get:function(){return et||(et=new e(new Ve(ze),null,st.Default))},enumerable:!1,configurable:!0}),e.prototype.isLeafNode=function(){return!1},e.prototype.getPriority=function(){return this.priorityNode_||et},e.prototype.updatePriority=function(t){return this.children_.isEmpty()?this:new e(this.children_,t,this.indexMap_)},e.prototype.getImmediateChild=function(e){if(".priority"===e)return this.getPriority();var t=this.children_.get(e);return null===t?et:t},e.prototype.getChild=function(path){var e=ge(path);return null===e?this:this.getImmediateChild(e).getChild(be(path))},e.prototype.hasChild=function(e){return null!==this.children_.get(e)},e.prototype.updateImmediateChild=function(t,n){if(Object(c.e)(n,"We should always be passing snapshot nodes"),".priority"===t)return this.updatePriority(n);var r=new qe(t,n),o=void 0,l=void 0;n.isEmpty()?(o=this.children_.remove(t),l=this.indexMap_.removeFromIndexes(r,this.children_)):(o=this.children_.insert(t,n),l=this.indexMap_.addToIndexes(r,this.children_));var h=o.isEmpty()?et:this.priorityNode_;return new e(o,h,l)},e.prototype.updateChild=function(path,e){var t=ge(path);if(null===t)return e;Object(c.e)(".priority"!==ge(path)||1===me(path),".priority must be the last token in a path");var n=this.getImmediateChild(t).updateChild(be(path),e);return this.updateImmediateChild(t,n)},e.prototype.isEmpty=function(){return this.children_.isEmpty()},e.prototype.numChildren=function(){return this.children_.count()},e.prototype.val=function(t){if(this.isEmpty())return null;var n={},r=0,o=0,c=!0;if(this.forEachChild(tt,(function(l,h){n[l]=h.val(t),r++,c&&e.INTEGER_REGEXP_.test(l)?o=Math.max(o,Number(l)):c=!1})),!t&&c&&o<2*r){var l=[];for(var h in n)l[h]=n[h];return l}return t&&!this.getPriority().isEmpty()&&(n[".priority"]=this.getPriority().val()),n},e.prototype.hash=function(){if(null===this.lazyHash_){var e="";this.getPriority().isEmpty()||(e+="priority:"+$e(this.getPriority().val())+":"),this.forEachChild(tt,(function(t,n){var r=n.hash();""!==r&&(e+=":"+t+":"+r)})),this.lazyHash_=""===e?"":E(e)}return this.lazyHash_},e.prototype.getPredecessorChildName=function(e,t,n){var r=this.resolveIndex_(n);if(r){var o=r.getPredecessorKey(new qe(e,t));return o?o.name:null}return this.children_.getPredecessorKey(e)},e.prototype.getFirstChildName=function(e){var t=this.resolveIndex_(e);if(t){var n=t.minKey();return n&&n.name}return this.children_.minKey()},e.prototype.getFirstChild=function(e){var t=this.getFirstChildName(e);return t?new qe(t,this.children_.get(t)):null},e.prototype.getLastChildName=function(e){var t=this.resolveIndex_(e);if(t){var n=t.maxKey();return n&&n.name}return this.children_.maxKey()},e.prototype.getLastChild=function(e){var t=this.getLastChildName(e);return t?new qe(t,this.children_.get(t)):null},e.prototype.forEachChild=function(e,t){var n=this.resolveIndex_(e);return n?n.inorderTraversal((function(e){return t(e.name,e.node)})):this.children_.inorderTraversal(t)},e.prototype.getIterator=function(e){return this.getIteratorFrom(e.minPost(),e)},e.prototype.getIteratorFrom=function(e,t){var n=this.resolveIndex_(t);if(n)return n.getIteratorFrom(e,(function(e){return e}));for(var r=this.children_.getIteratorFrom(e.name,qe.Wrap),o=r.peek();null!=o&&t.compare(o,e)<0;)r.getNext(),o=r.peek();return r},e.prototype.getReverseIterator=function(e){return this.getReverseIteratorFrom(e.maxPost(),e)},e.prototype.getReverseIteratorFrom=function(e,t){var n=this.resolveIndex_(t);if(n)return n.getReverseIteratorFrom(e,(function(e){return e}));for(var r=this.children_.getReverseIteratorFrom(e.name,qe.Wrap),o=r.peek();null!=o&&t.compare(o,e)>0;)r.getNext(),o=r.peek();return r},e.prototype.compareTo=function(e){return this.isEmpty()?e.isEmpty()?0:-1:e.isLeafNode()||e.isEmpty()?1:e===ct?-1:0},e.prototype.withIndex=function(t){if(t===We||this.indexMap_.hasIndex(t))return this;var n=this.indexMap_.addIndex(t,this.children_);return new e(this.children_,this.priorityNode_,n)},e.prototype.isIndexed=function(e){return e===We||this.indexMap_.hasIndex(e)},e.prototype.equals=function(e){if(e===this)return!0;if(e.isLeafNode())return!1;var t=e;if(this.getPriority().equals(t.getPriority())){if(this.children_.count()===t.children_.count()){for(var n=this.getIterator(tt),r=t.getIterator(tt),o=n.getNext(),c=r.getNext();o&&c;){if(o.name!==c.name||!o.node.equals(c.node))return!1;o=n.getNext(),c=r.getNext()}return null===o&&null===c}return!1}return!1},e.prototype.resolveIndex_=function(e){return e===We?null:this.indexMap_.get(e.toString())},e.INTEGER_REGEXP_=/^(0|[1-9]\d*)$/,e}(),ct=new(function(e){function t(){return e.call(this,new Ve(ze),ut.EMPTY_NODE,st.Default)||this}return Object(l.c)(t,e),t.prototype.compareTo=function(e){return e===this?0:1},t.prototype.equals=function(e){return e===this},t.prototype.getPriority=function(){return this},t.prototype.getImmediateChild=function(e){return ut.EMPTY_NODE},t.prototype.isEmpty=function(){return!1},t}(ut));Object.defineProperties(qe,{MIN:{value:new qe(F,ut.EMPTY_NODE)},MAX:{value:new qe(M,ct)}}),Le.__EMPTY_NODE=ut.EMPTY_NODE,Xe.__childrenNodeConstructor=ut,De=ct,function(e){Ge=e}(ct);function lt(e,t){if(void 0===t&&(t=null),null===e)return ut.EMPTY_NODE;if("object"==typeof e&&".priority"in e&&(t=e[".priority"]),Object(c.e)(null===t||"string"==typeof t||"number"==typeof t||"object"==typeof t&&".sv"in t,"Invalid priority type found: "+typeof t),"object"==typeof e&&".value"in e&&null!==e[".value"]&&(e=e[".value"]),"object"!=typeof e||".sv"in e)return new Xe(e,lt(t));if(e instanceof Array){var n=ut.EMPTY_NODE;return V(e,(function(t,r){if(Object(c.i)(e,t)&&"."!==t.substring(0,1)){var o=lt(r);!o.isLeafNode()&&o.isEmpty()||(n=n.updateImmediateChild(t,o))}})),n.updatePriority(lt(t))}var r=[],o=!1;if(V(e,(function(e,t){if("."!==e.substring(0,1)){var n=lt(t);n.isEmpty()||(o=o||!n.getPriority().isEmpty(),r.push(new qe(e,n)))}})),0===r.length)return ut.EMPTY_NODE;var l=ot(r,He,(function(e){return e.name}),ze);if(o){var h=ot(r,tt.getCompare());return new ut(l,lt(t),new st({".priority":h},{".priority":tt}))}return new ut(l,lt(t),st.Default)}!function(e){Ke=e}(lt);var ht,pt,ft=function(e){function t(t){var n=e.call(this)||this;return n.indexPath_=t,Object(c.e)(!Ee(t)&&".priority"!==ge(t),"Can't create PathIndex with empty path or .priority key"),n}return Object(l.c)(t,e),t.prototype.extractChild=function(e){return e.getChild(this.indexPath_)},t.prototype.isDefinedOn=function(e){return!e.getChild(this.indexPath_).isEmpty()},t.prototype.compare=function(a,b){var e=this.extractChild(a.node),t=this.extractChild(b.node),n=e.compareTo(t);return 0===n?L(a.name,b.name):n},t.prototype.makePost=function(e,t){var n=lt(e),r=ut.EMPTY_NODE.updateChild(this.indexPath_,n);return new qe(t,r)},t.prototype.maxPost=function(){var e=ut.EMPTY_NODE.updateChild(this.indexPath_,ct);return new qe(M,e)},t.prototype.toString=function(){return Ce(this.indexPath_,0).join("/")},t}(Me),_t=new(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Object(l.c)(t,e),t.prototype.compare=function(a,b){var e=a.node.compareTo(b.node);return 0===e?L(a.name,b.name):e},t.prototype.isDefinedOn=function(e){return!0},t.prototype.indexedValueChanged=function(e,t){return!e.equals(t)},t.prototype.minPost=function(){return qe.MIN},t.prototype.maxPost=function(){return qe.MAX},t.prototype.makePost=function(e,t){var n=lt(e);return new qe(t,n)},t.prototype.toString=function(){return".value"},t}(Me)),vt="-0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz",yt=(ht=0,pt=[],function(e){var i,t=e===ht;ht=e;var n=new Array(8);for(i=7;i>=0;i--)n[i]=vt.charAt(e%64),e=Math.floor(e/64);Object(c.e)(0===e,"Cannot push at time == 0");var r=n.join("");if(t){for(i=11;i>=0&&63===pt[i];i--)pt[i]=0;pt[i]++}else for(i=0;i<12;i++)pt[i]=Math.floor(64*Math.random());for(i=0;i<12;i++)r+=vt.charAt(pt[i]);return Object(c.e)(20===r.length,"nextPushId: Length should be 20."),r}),gt=function(e){if("2147483647"===e)return"-";var t=Y(e);if(null!=t)return""+(t+1);for(var n=new Array(e.length),r=0;r<n.length;r++)n[r]=e.charAt(r);if(n.length<786)return n.push("-"),n.join("");for(var i=n.length-1;i>=0&&"z"===n[i];)i--;if(-1===i)return M;var source=n[i],o=vt.charAt(vt.indexOf(source)+1);return n[i]=o,n.slice(0,i+1).join("")},mt=function(e){if("-2147483648"===e)return F;var t=Y(e);if(null!=t)return""+(t-1);for(var n=new Array(e.length),i=0;i<n.length;i++)n[i]=e.charAt(i);return"-"===n[n.length-1]?1===n.length?"2147483647":(delete n[n.length-1],n.join("")):(n[n.length-1]=vt.charAt(vt.indexOf(n[n.length-1])-1),n.join("")+"z".repeat(786-n.length))};function bt(e){return{type:"value",snapshotNode:e}}function wt(e,t){return{type:"child_added",snapshotNode:t,childName:e}}function Ct(e,t){return{type:"child_removed",snapshotNode:t,childName:e}}function Ot(e,t,n){return{type:"child_changed",snapshotNode:t,childName:e,oldSnap:n}}var Tt=function(){function e(e){this.index_=e}return e.prototype.updateChild=function(e,t,n,r,source,o){Object(c.e)(e.isIndexed(this.index_),"A node must be indexed if only a child is updated");var l=e.getImmediateChild(t);return l.getChild(r).equals(n.getChild(r))&&l.isEmpty()===n.isEmpty()?e:(null!=o&&(n.isEmpty()?e.hasChild(t)?o.trackChildChange(Ct(t,l)):Object(c.e)(e.isLeafNode(),"A child remove without an old child only makes sense on a leaf node"):l.isEmpty()?o.trackChildChange(wt(t,n)):o.trackChildChange(Ot(t,n,l))),e.isLeafNode()&&n.isEmpty()?e:e.updateImmediateChild(t,n).withIndex(this.index_))},e.prototype.updateFullNode=function(e,t,n){return null!=n&&(e.isLeafNode()||e.forEachChild(tt,(function(e,r){t.hasChild(e)||n.trackChildChange(Ct(e,r))})),t.isLeafNode()||t.forEachChild(tt,(function(t,r){if(e.hasChild(t)){var o=e.getImmediateChild(t);o.equals(r)||n.trackChildChange(Ot(t,r,o))}else n.trackChildChange(wt(t,r))}))),t.withIndex(this.index_)},e.prototype.updatePriority=function(e,t){return e.isEmpty()?ut.EMPTY_NODE:e.updatePriority(t)},e.prototype.filtersNodes=function(){return!1},e.prototype.getIndexedFilter=function(){return this},e.prototype.getIndex=function(){return this.index_},e}(),Et=function(){function e(t){this.indexedFilter_=new Tt(t.getIndex()),this.index_=t.getIndex(),this.startPost_=e.getStartPost_(t),this.endPost_=e.getEndPost_(t)}return e.prototype.getStartPost=function(){return this.startPost_},e.prototype.getEndPost=function(){return this.endPost_},e.prototype.matches=function(e){return this.index_.compare(this.getStartPost(),e)<=0&&this.index_.compare(e,this.getEndPost())<=0},e.prototype.updateChild=function(e,t,n,r,source,o){return this.matches(new qe(t,n))||(n=ut.EMPTY_NODE),this.indexedFilter_.updateChild(e,t,n,r,source,o)},e.prototype.updateFullNode=function(e,t,n){t.isLeafNode()&&(t=ut.EMPTY_NODE);var r=t.withIndex(this.index_);r=r.updatePriority(ut.EMPTY_NODE);var o=this;return t.forEachChild(tt,(function(e,t){o.matches(new qe(e,t))||(r=r.updateImmediateChild(e,ut.EMPTY_NODE))})),this.indexedFilter_.updateFullNode(e,r,n)},e.prototype.updatePriority=function(e,t){return e},e.prototype.filtersNodes=function(){return!0},e.prototype.getIndexedFilter=function(){return this.indexedFilter_},e.prototype.getIndex=function(){return this.index_},e.getStartPost_=function(e){if(e.hasStart()){var t=e.getIndexStartName();return e.getIndex().makePost(e.getIndexStartValue(),t)}return e.getIndex().minPost()},e.getEndPost_=function(e){if(e.hasEnd()){var t=e.getIndexEndName();return e.getIndex().makePost(e.getIndexEndValue(),t)}return e.getIndex().maxPost()},e}(),kt=function(){function e(e){this.rangedFilter_=new Et(e),this.index_=e.getIndex(),this.limit_=e.getLimit(),this.reverse_=!e.isViewFromLeft()}return e.prototype.updateChild=function(e,t,n,r,source,o){return this.rangedFilter_.matches(new qe(t,n))||(n=ut.EMPTY_NODE),e.getImmediateChild(t).equals(n)?e:e.numChildren()<this.limit_?this.rangedFilter_.getIndexedFilter().updateChild(e,t,n,r,source,o):this.fullLimitUpdateChild_(e,t,n,source,o)},e.prototype.updateFullNode=function(e,t,n){var r;if(t.isLeafNode()||t.isEmpty())r=ut.EMPTY_NODE.withIndex(this.index_);else if(2*this.limit_<t.numChildren()&&t.isIndexed(this.index_)){r=ut.EMPTY_NODE.withIndex(this.index_);var o=void 0;o=this.reverse_?t.getReverseIteratorFrom(this.rangedFilter_.getEndPost(),this.index_):t.getIteratorFrom(this.rangedFilter_.getStartPost(),this.index_);for(var c=0;o.hasNext()&&c<this.limit_;){var l=o.getNext();if(!(this.reverse_?this.index_.compare(this.rangedFilter_.getStartPost(),l)<=0:this.index_.compare(l,this.rangedFilter_.getEndPost())<=0))break;r=r.updateImmediateChild(l.name,l.node),c++}}else{r=(r=t.withIndex(this.index_)).updatePriority(ut.EMPTY_NODE);var h=void 0,d=void 0,f=void 0;o=void 0;if(this.reverse_){o=r.getReverseIterator(this.index_),h=this.rangedFilter_.getEndPost(),d=this.rangedFilter_.getStartPost();var _=this.index_.getCompare();f=function(a,b){return _(b,a)}}else o=r.getIterator(this.index_),h=this.rangedFilter_.getStartPost(),d=this.rangedFilter_.getEndPost(),f=this.index_.getCompare();c=0;for(var v=!1;o.hasNext();){l=o.getNext();!v&&f(h,l)<=0&&(v=!0),v&&c<this.limit_&&f(l,d)<=0?c++:r=r.updateImmediateChild(l.name,ut.EMPTY_NODE)}}return this.rangedFilter_.getIndexedFilter().updateFullNode(e,r,n)},e.prototype.updatePriority=function(e,t){return e},e.prototype.filtersNodes=function(){return!0},e.prototype.getIndexedFilter=function(){return this.rangedFilter_.getIndexedFilter()},e.prototype.getIndex=function(){return this.index_},e.prototype.fullLimitUpdateChild_=function(e,t,n,source,r){var o;if(this.reverse_){var l=this.index_.getCompare();o=function(a,b){return l(b,a)}}else o=this.index_.getCompare();var h=e;Object(c.e)(h.numChildren()===this.limit_,"");var d=new qe(t,n),f=this.reverse_?h.getFirstChild(this.index_):h.getLastChild(this.index_),_=this.rangedFilter_.matches(d);if(h.hasChild(t)){for(var v=h.getImmediateChild(t),y=source.getChildAfterChild(this.index_,f,this.reverse_);null!=y&&(y.name===t||h.hasChild(y.name));)y=source.getChildAfterChild(this.index_,y,this.reverse_);var m=null==y?1:o(y,d);if(_&&!n.isEmpty()&&m>=0)return null!=r&&r.trackChildChange(Ot(t,n,v)),h.updateImmediateChild(t,n);null!=r&&r.trackChildChange(Ct(t,v));var w=h.updateImmediateChild(t,ut.EMPTY_NODE);return null!=y&&this.rangedFilter_.matches(y)?(null!=r&&r.trackChildChange(wt(y.name,y.node)),w.updateImmediateChild(y.name,y.node)):w}return n.isEmpty()?e:_&&o(f,d)>=0?(null!=r&&(r.trackChildChange(Ct(f.name,f.node)),r.trackChildChange(wt(t,n))),h.updateImmediateChild(t,n).updateImmediateChild(f.name,ut.EMPTY_NODE)):e},e}(),It=function(){function e(){this.limitSet_=!1,this.startSet_=!1,this.startNameSet_=!1,this.startAfterSet_=!1,this.endSet_=!1,this.endNameSet_=!1,this.endBeforeSet_=!1,this.limit_=0,this.viewFrom_="",this.indexStartValue_=null,this.indexStartName_="",this.indexEndValue_=null,this.indexEndName_="",this.index_=tt}return e.prototype.hasStart=function(){return this.startSet_},e.prototype.hasStartAfter=function(){return this.startAfterSet_},e.prototype.hasEndBefore=function(){return this.endBeforeSet_},e.prototype.isViewFromLeft=function(){return""===this.viewFrom_?this.startSet_:"l"===this.viewFrom_},e.prototype.getIndexStartValue=function(){return Object(c.e)(this.startSet_,"Only valid if start has been set"),this.indexStartValue_},e.prototype.getIndexStartName=function(){return Object(c.e)(this.startSet_,"Only valid if start has been set"),this.startNameSet_?this.indexStartName_:F},e.prototype.hasEnd=function(){return this.endSet_},e.prototype.getIndexEndValue=function(){return Object(c.e)(this.endSet_,"Only valid if end has been set"),this.indexEndValue_},e.prototype.getIndexEndName=function(){return Object(c.e)(this.endSet_,"Only valid if end has been set"),this.endNameSet_?this.indexEndName_:M},e.prototype.hasLimit=function(){return this.limitSet_},e.prototype.hasAnchoredLimit=function(){return this.limitSet_&&""!==this.viewFrom_},e.prototype.getLimit=function(){return Object(c.e)(this.limitSet_,"Only valid if limit has been set"),this.limit_},e.prototype.getIndex=function(){return this.index_},e.prototype.loadsAllData=function(){return!(this.startSet_||this.endSet_||this.limitSet_)},e.prototype.isDefault=function(){return this.loadsAllData()&&this.index_===tt},e.prototype.copy=function(){var t=new e;return t.limitSet_=this.limitSet_,t.limit_=this.limit_,t.startSet_=this.startSet_,t.indexStartValue_=this.indexStartValue_,t.startNameSet_=this.startNameSet_,t.indexStartName_=this.indexStartName_,t.endSet_=this.endSet_,t.indexEndValue_=this.indexEndValue_,t.endNameSet_=this.endNameSet_,t.indexEndName_=this.indexEndName_,t.index_=this.index_,t.viewFrom_=this.viewFrom_,t},e}();function St(e,t,n){var r=e.copy();return r.startSet_=!0,void 0===t&&(t=null),r.indexStartValue_=t,null!=n?(r.startNameSet_=!0,r.indexStartName_=n):(r.startNameSet_=!1,r.indexStartName_=""),r}function Pt(e,t,n){var r=e.copy();return r.endSet_=!0,void 0===t&&(t=null),r.indexEndValue_=t,void 0!==n?(r.endNameSet_=!0,r.indexEndName_=n):(r.endNameSet_=!1,r.indexEndName_=""),r}function xt(e,t){var n=e.copy();return n.index_=t,n}function jt(e){var t,n={};return e.isDefault()||(e.index_===tt?t="$priority":e.index_===_t?t="$value":e.index_===We?t="$key":(Object(c.e)(e.index_ instanceof ft,"Unrecognized index type!"),t=e.index_.toString()),n.orderBy=Object(c.D)(t),e.startSet_&&(n.startAt=Object(c.D)(e.indexStartValue_),e.startNameSet_&&(n.startAt+=","+Object(c.D)(e.indexStartName_))),e.endSet_&&(n.endAt=Object(c.D)(e.indexEndValue_),e.endNameSet_&&(n.endAt+=","+Object(c.D)(e.indexEndName_))),e.limitSet_&&(e.isViewFromLeft()?n.limitToFirst=e.limit_:n.limitToLast=e.limit_)),n}function Nt(e){var t={};if(e.startSet_&&(t.sp=e.indexStartValue_,e.startNameSet_&&(t.sn=e.indexStartName_)),e.endSet_&&(t.ep=e.indexEndValue_,e.endNameSet_&&(t.en=e.indexEndName_)),e.limitSet_){t.l=e.limit_;var n=e.viewFrom_;""===n&&(n=e.isViewFromLeft()?"l":"r"),t.vf=n}return e.index_!==tt&&(t.i=e.index_.toString()),t}var Rt=function(e){function t(t,n,r,o){var c=e.call(this)||this;return c.repoInfo_=t,c.onDataUpdate_=n,c.authTokenProvider_=r,c.appCheckTokenProvider_=o,c.log_=j("p:rest:"),c.listens_={},c}return Object(l.c)(t,e),t.prototype.reportStats=function(e){throw new Error("Method not implemented.")},t.getListenId_=function(e,t){return void 0!==t?"tag$"+t:(Object(c.e)(e._queryParams.isDefault(),"should have a tag if it's not a default query."),e._path.toString())},t.prototype.listen=function(e,n,r,o){var l=this,h=e._path.toString();this.log_("Listen called for "+h+" "+e._queryIdentifier);var d=t.getListenId_(e,r),f={};this.listens_[d]=f;var _=jt(e._queryParams);this.restRequest_(h+".json",_,(function(e,t){var data=t;(404===e&&(data=null,e=null),null===e&&l.onDataUpdate_(h,data,!1,r),Object(c.A)(l.listens_,d)===f)&&o(e?401===e?"permission_denied":"rest_error:"+e:"ok",null)}))},t.prototype.unlisten=function(e,n){var r=t.getListenId_(e,n);delete this.listens_[r]},t.prototype.get=function(e){var t=this,n=jt(e._queryParams),r=e._path.toString(),o=new c.a;return this.restRequest_(r+".json",n,(function(e,n){var data=n;404===e&&(data=null,e=null),null===e?(t.onDataUpdate_(r,data,!1,null),o.resolve(data)):o.reject(new Error(data))})),o.promise},t.prototype.refreshAuthToken=function(e){},t.prototype.restRequest_=function(e,t,n){var r=this;return void 0===t&&(t={}),t.format="export",Promise.all([this.authTokenProvider_.getToken(!1),this.appCheckTokenProvider_.getToken(!1)]).then((function(o){var h=Object(l.e)(o,2),d=h[0],f=h[1];d&&d.accessToken&&(t.auth=d.accessToken),f&&f.token&&(t.ac=f.token);var _=(r.repoInfo_.secure?"https://":"http://")+r.repoInfo_.host+e+"?ns="+r.repoInfo_.namespace+Object(c.z)(t);r.log_("Sending REST request for "+_);var v=new XMLHttpRequest;v.onreadystatechange=function(){if(n&&4===v.readyState){r.log_("REST Response for "+_+" received. status:",v.status,"response:",v.responseText);var e=null;if(v.status>=200&&v.status<300){try{e=Object(c.x)(v.responseText)}catch(e){D("Failed to parse JSON response for "+_+": "+v.responseText)}n(null,e)}else 401!==v.status&&404!==v.status&&D("Got unsuccessful REST response for "+_+" Status: "+v.status),n(v.status);n=null}},v.open("GET",_,!0),v.send()}))},t}(pe),Dt=function(){function e(){this.rootNode_=ut.EMPTY_NODE}return e.prototype.getNode=function(path){return this.rootNode_.getChild(path)},e.prototype.updateSnapshot=function(path,e){this.rootNode_=this.rootNode_.updateChild(path,e)},e}();function At(){return{value:null,children:new Map}}function Ft(e,path,data){if(Ee(path))e.value=data,e.children.clear();else if(null!==e.value)e.value=e.value.updateChild(path,data);else{var t=ge(path);e.children.has(t)||e.children.set(t,At()),Ft(e.children.get(t),path=be(path),data)}}function qt(e,t,n){null!==e.value?n(t,e.value):function(e,t){e.children.forEach((function(e,n){t(n,e)}))}(e,(function(e,r){qt(r,new ve(t.toString()+"/"+e),n)}))}var Mt,Lt=function(){function e(e){this.collection_=e,this.last_=null}return e.prototype.get=function(){var e=this.collection_.get(),t=Object(l.a)({},e);return this.last_&&V(this.last_,(function(e,n){t[e]=t[e]-n})),this.last_=e,t},e}(),Wt=function(){function e(e,t){this.server_=t,this.statsToReport_={},this.statsListener_=new Lt(e);var n=1e4+2e4*Math.random();G(this.reportStats_.bind(this),Math.floor(n))}return e.prototype.reportStats_=function(){var e=this,t=this.statsListener_.get(),n={},r=!1;V(t,(function(t,o){o>0&&Object(c.i)(e.statsToReport_,t)&&(n[t]=o,r=!0)})),r&&this.server_.reportStats(n),G(this.reportStats_.bind(this),Math.floor(2*Math.random()*3e5))},e}();function Ut(e){return{fromUser:!1,fromServer:!0,queryId:e,tagged:!0}}!function(e){e[e.OVERWRITE=0]="OVERWRITE",e[e.MERGE=1]="MERGE",e[e.ACK_USER_WRITE=2]="ACK_USER_WRITE",e[e.LISTEN_COMPLETE=3]="LISTEN_COMPLETE"}(Mt||(Mt={}));var Bt,Qt=function(){function e(path,e,t){this.path=path,this.affectedTree=e,this.revert=t,this.type=Mt.ACK_USER_WRITE,this.source={fromUser:!0,fromServer:!1,queryId:null,tagged:!1}}return e.prototype.operationForChild=function(t){if(Ee(this.path)){if(null!=this.affectedTree.value)return Object(c.e)(this.affectedTree.children.isEmpty(),"affectedTree should not have overlapping affected paths."),this;var n=this.affectedTree.subtree(new ve(t));return new e(ye(),n,this.revert)}return Object(c.e)(ge(this.path)===t,"operationForChild called for unrelated child."),new e(be(this.path),this.affectedTree,this.revert)},e}(),Vt=function(){function e(source,path){this.source=source,this.path=path,this.type=Mt.LISTEN_COMPLETE}return e.prototype.operationForChild=function(t){return Ee(this.path)?new e(this.source,ye()):new e(this.source,be(this.path))},e}(),Ht=function(){function e(source,path,e){this.source=source,this.path=path,this.snap=e,this.type=Mt.OVERWRITE}return e.prototype.operationForChild=function(t){return Ee(this.path)?new e(this.source,ye(),this.snap.getImmediateChild(t)):new e(this.source,be(this.path),this.snap)},e}(),zt=function(){function e(source,path,e){this.source=source,this.path=path,this.children=e,this.type=Mt.MERGE}return e.prototype.operationForChild=function(t){if(Ee(this.path)){var n=this.children.subtree(new ve(t));return n.isEmpty()?null:n.value?new Ht(this.source,ye(),n.value):new e(this.source,ye(),n)}return Object(c.e)(ge(this.path)===t,"Can't get a merge for a child not on the path of the operation"),new e(this.source,be(this.path),this.children)},e.prototype.toString=function(){return"Operation("+this.path+": "+this.source.toString()+" merge: "+this.children.toString()+")"},e}(),Yt=function(){function e(e,t,n){this.node_=e,this.fullyInitialized_=t,this.filtered_=n}return e.prototype.isFullyInitialized=function(){return this.fullyInitialized_},e.prototype.isFiltered=function(){return this.filtered_},e.prototype.isCompleteForPath=function(path){if(Ee(path))return this.isFullyInitialized()&&!this.filtered_;var e=ge(path);return this.isCompleteForChild(e)},e.prototype.isCompleteForChild=function(e){return this.isFullyInitialized()&&!this.filtered_||this.node_.hasChild(e)},e.prototype.getNode=function(){return this.node_},e}(),Kt=function(e){this.query_=e,this.index_=this.query_._queryParams.getIndex()};function Gt(e,t,n,r,o,l){var h=r.filter((function(e){return e.type===n}));h.sort((function(a,b){return function(e,a,b){if(null==a.childName||null==b.childName)throw Object(c.f)("Should only compare child_ events.");var t=new qe(a.childName,a.snapshotNode),n=new qe(b.childName,b.snapshotNode);return e.index_.compare(t,n)}(e,a,b)})),h.forEach((function(n){var r=function(e,t,n){return"value"===t.type||"child_removed"===t.type||(t.prevName=n.getPredecessorChildName(t.childName,t.snapshotNode,e.index_)),t}(e,n,l);o.forEach((function(o){o.respondsTo(n.type)&&t.push(o.createEvent(r,e.query_))}))}))}function $t(e,t){return{eventCache:e,serverCache:t}}function Jt(e,t,n,r){return $t(new Yt(t,n,r),e.serverCache)}function Xt(e,t,n,r){return $t(e.eventCache,new Yt(t,n,r))}function Zt(e){return e.eventCache.isFullyInitialized()?e.eventCache.getNode():null}function en(e){return e.serverCache.isFullyInitialized()?e.serverCache.getNode():null}var tn=function(){function e(e,t){void 0===t&&(Bt||(Bt=new Ve(W)),t=Bt),this.value=e,this.children=t}return e.fromObject=function(t){var n=new e(null);return V(t,(function(e,t){n=n.set(new ve(e),t)})),n},e.prototype.isEmpty=function(){return null===this.value&&this.children.isEmpty()},e.prototype.findRootMostMatchingPathAndValue=function(e,t){if(null!=this.value&&t(this.value))return{path:ye(),value:this.value};if(Ee(e))return null;var n=ge(e),r=this.children.get(n);if(null!==r){var o=r.findRootMostMatchingPathAndValue(be(e),t);return null!=o?{path:Te(new ve(n),o.path),value:o.value}:null}return null},e.prototype.findRootMostValueAndPath=function(e){return this.findRootMostMatchingPathAndValue(e,(function(){return!0}))},e.prototype.subtree=function(t){if(Ee(t))return this;var n=ge(t),r=this.children.get(n);return null!==r?r.subtree(be(t)):new e(null)},e.prototype.set=function(t,n){if(Ee(t))return new e(n,this.children);var r=ge(t),o=(this.children.get(r)||new e(null)).set(be(t),n),c=this.children.insert(r,o);return new e(this.value,c)},e.prototype.remove=function(t){if(Ee(t))return this.children.isEmpty()?new e(null):new e(null,this.children);var n=ge(t),r=this.children.get(n);if(r){var o=r.remove(be(t)),c=void 0;return c=o.isEmpty()?this.children.remove(n):this.children.insert(n,o),null===this.value&&c.isEmpty()?new e(null):new e(this.value,c)}return this},e.prototype.get=function(e){if(Ee(e))return this.value;var t=ge(e),n=this.children.get(t);return n?n.get(be(e)):null},e.prototype.setTree=function(t,n){if(Ee(t))return n;var r=ge(t),o=(this.children.get(r)||new e(null)).setTree(be(t),n),c=void 0;return c=o.isEmpty()?this.children.remove(r):this.children.insert(r,o),new e(this.value,c)},e.prototype.fold=function(e){return this.fold_(ye(),e)},e.prototype.fold_=function(e,t){var n={};return this.children.inorderTraversal((function(r,o){n[r]=o.fold_(Te(e,r),t)})),t(e,this.value,n)},e.prototype.findOnPath=function(path,e){return this.findOnPath_(path,ye(),e)},e.prototype.findOnPath_=function(e,t,n){var r=!!this.value&&n(t,this.value);if(r)return r;if(Ee(e))return null;var o=ge(e),c=this.children.get(o);return c?c.findOnPath_(be(e),Te(t,o),n):null},e.prototype.foreachOnPath=function(path,e){return this.foreachOnPath_(path,ye(),e)},e.prototype.foreachOnPath_=function(t,n,r){if(Ee(t))return this;this.value&&r(n,this.value);var o=ge(t),c=this.children.get(o);return c?c.foreachOnPath_(be(t),Te(n,o),r):new e(null)},e.prototype.foreach=function(e){this.foreach_(ye(),e)},e.prototype.foreach_=function(e,t){this.children.inorderTraversal((function(n,r){r.foreach_(Te(e,n),t)})),this.value&&t(e,this.value)},e.prototype.foreachChild=function(e){this.children.inorderTraversal((function(t,n){n.value&&e(t,n.value)}))},e}(),nn=function(){function e(e){this.writeTree_=e}return e.empty=function(){return new e(new tn(null))},e}();function rn(e,path,t){if(Ee(path))return new nn(new tn(t));var n=e.writeTree_.findRootMostValueAndPath(path);if(null!=n){var r=n.path,o=n.value,c=ke(r,path);return o=o.updateChild(c,t),new nn(e.writeTree_.set(r,o))}var l=new tn(t),h=e.writeTree_.setTree(path,l);return new nn(h)}function on(e,path,t){var n=e;return V(t,(function(e,t){n=rn(n,Te(path,e),t)})),n}function an(e,path){if(Ee(path))return nn.empty();var t=e.writeTree_.setTree(path,new tn(null));return new nn(t)}function sn(e,path){return null!=un(e,path)}function un(e,path){var t=e.writeTree_.findRootMostValueAndPath(path);return null!=t?e.writeTree_.get(t.path).getChild(ke(t.path,path)):null}function cn(e){var t=[],n=e.writeTree_.value;return null!=n?n.isLeafNode()||n.forEachChild(tt,(function(e,n){t.push(new qe(e,n))})):e.writeTree_.children.inorderTraversal((function(e,n){null!=n.value&&t.push(new qe(e,n.value))})),t}function ln(e,path){if(Ee(path))return e;var t=un(e,path);return new nn(null!=t?new tn(t):e.writeTree_.subtree(path))}function hn(e){return e.writeTree_.isEmpty()}function dn(e,t){return function e(t,n,r){if(null!=n.value)return r.updateChild(t,n.value);var o=null;return n.children.inorderTraversal((function(n,l){".priority"===n?(Object(c.e)(null!==l.value,"Priority writes must always be leaf nodes"),o=l.value):r=e(Te(t,n),l,r)})),r.getChild(t).isEmpty()||null===o||(r=r.updateChild(Te(t,".priority"),o)),r}(ye(),e.writeTree_,t)}function pn(e,path){return kn(path,e)}function fn(e,t){var n=e.allWrites.findIndex((function(s){return s.writeId===t}));Object(c.e)(n>=0,"removeWrite called with nonexistent writeId.");var r=e.allWrites[n];e.allWrites.splice(n,1);for(var o=r.visible,l=!1,i=e.allWrites.length-1;o&&i>=0;){var h=e.allWrites[i];h.visible&&(i>=n&&_n(h,r.path)?o=!1:Pe(r.path,h.path)&&(l=!0)),i--}if(o){if(l)return function(e){e.visibleWrites=yn(e.allWrites,vn,ye()),e.allWrites.length>0?e.lastWriteId=e.allWrites[e.allWrites.length-1].writeId:e.lastWriteId=-1}(e),!0;r.snap?e.visibleWrites=an(e.visibleWrites,r.path):V(r.children,(function(t){e.visibleWrites=an(e.visibleWrites,Te(r.path,t))}));return!0}return!1}function _n(e,path){if(e.snap)return Pe(e.path,path);for(var t in e.children)if(e.children.hasOwnProperty(t)&&Pe(Te(e.path,t),path))return!0;return!1}function vn(e){return e.visible}function yn(e,filter,t){for(var n=nn.empty(),i=0;i<e.length;++i){var r=e[i];if(filter(r)){var o=r.path,l=void 0;if(r.snap)Pe(t,o)?n=rn(n,l=ke(t,o),r.snap):Pe(o,t)&&(l=ke(o,t),n=rn(n,ye(),r.snap.getChild(l)));else{if(!r.children)throw Object(c.f)("WriteRecord should have .snap or .children");if(Pe(t,o))n=on(n,l=ke(t,o),r.children);else if(Pe(o,t))if(Ee(l=ke(o,t)))n=on(n,ye(),r.children);else{var h=Object(c.A)(r.children,ge(l));if(h){var d=h.getChild(be(l));n=rn(n,ye(),d)}}}}}return n}function gn(e,t,n,r,o){if(r||o){var c=ln(e.visibleWrites,t);if(!o&&hn(c))return n;if(o||null!=n||sn(c,ye())){return dn(yn(e.allWrites,(function(e){return(e.visible||o)&&(!r||!~r.indexOf(e.writeId))&&(Pe(e.path,t)||Pe(t,e.path))}),t),n||ut.EMPTY_NODE)}return null}var l=un(e.visibleWrites,t);if(null!=l)return l;var h=ln(e.visibleWrites,t);return hn(h)?n:null!=n||sn(h,ye())?dn(h,n||ut.EMPTY_NODE):null}function mn(e,t,n,r){return gn(e.writeTree,e.treePath,t,n,r)}function bn(e,t){return function(e,t,n){var r=ut.EMPTY_NODE,o=un(e.visibleWrites,t);if(o)return o.isLeafNode()||o.forEachChild(tt,(function(e,t){r=r.updateImmediateChild(e,t)})),r;if(n){var c=ln(e.visibleWrites,t);return n.forEachChild(tt,(function(e,t){var n=dn(ln(c,new ve(e)),t);r=r.updateImmediateChild(e,n)})),cn(c).forEach((function(e){r=r.updateImmediateChild(e.name,e.node)})),r}return cn(ln(e.visibleWrites,t)).forEach((function(e){r=r.updateImmediateChild(e.name,e.node)})),r}(e.writeTree,e.treePath,t)}function wn(e,path,t,n){return function(e,t,n,r,o){Object(c.e)(r||o,"Either existingEventSnap or existingServerSnap must exist");var path=Te(t,n);if(sn(e.visibleWrites,path))return null;var l=ln(e.visibleWrites,path);return hn(l)?o.getChild(n):dn(l,o.getChild(n))}(e.writeTree,e.treePath,path,t,n)}function Cn(e,path){return function(e,path){return un(e.visibleWrites,path)}(e.writeTree,Te(e.treePath,path))}function On(e,t,n,r,o,c){return function(e,t,n,r,o,c,l){var h,d=ln(e.visibleWrites,t),f=un(d,ye());if(null!=f)h=f;else{if(null==n)return[];h=dn(d,n)}if((h=h.withIndex(l)).isEmpty()||h.isLeafNode())return[];for(var _=[],v=l.getCompare(),y=c?h.getReverseIteratorFrom(r,l):h.getIteratorFrom(r,l),m=y.getNext();m&&_.length<o;)0!==v(m,r)&&_.push(m),m=y.getNext();return _}(e.writeTree,e.treePath,t,n,r,o,c)}function Tn(e,t,n){return function(e,t,n,r){var path=Te(t,n),o=un(e.visibleWrites,path);return null!=o?o:r.isCompleteForChild(n)?dn(ln(e.visibleWrites,path),r.getNode().getImmediateChild(n)):null}(e.writeTree,e.treePath,t,n)}function En(e,t){return kn(Te(e.treePath,t),e.writeTree)}function kn(path,e){return{treePath:path,writeTree:e}}var In=function(){function e(){this.changeMap=new Map}return e.prototype.trackChildChange=function(e){var t=e.type,n=e.childName;Object(c.e)("child_added"===t||"child_changed"===t||"child_removed"===t,"Only child changes supported for tracking"),Object(c.e)(".priority"!==n,"Only non-priority child changes can be tracked.");var r=this.changeMap.get(n);if(r){var o=r.type;if("child_added"===t&&"child_removed"===o)this.changeMap.set(n,Ot(n,e.snapshotNode,r.snapshotNode));else if("child_removed"===t&&"child_added"===o)this.changeMap.delete(n);else if("child_removed"===t&&"child_changed"===o)this.changeMap.set(n,Ct(n,r.oldSnap));else if("child_changed"===t&&"child_added"===o)this.changeMap.set(n,wt(n,e.snapshotNode));else{if("child_changed"!==t||"child_changed"!==o)throw Object(c.f)("Illegal combination of changes: "+e+" occurred after "+r);this.changeMap.set(n,Ot(n,e.snapshotNode,r.oldSnap))}}else this.changeMap.set(n,e)},e.prototype.getChanges=function(){return Array.from(this.changeMap.values())},e}(),Sn=new(function(){function e(){}return e.prototype.getCompleteChild=function(e){return null},e.prototype.getChildAfterChild=function(e,t,n){return null},e}()),Pn=function(){function e(e,t,n){void 0===n&&(n=null),this.writes_=e,this.viewCache_=t,this.optCompleteServerCache_=n}return e.prototype.getCompleteChild=function(e){var t=this.viewCache_.eventCache;if(t.isCompleteForChild(e))return t.getNode().getImmediateChild(e);var n=null!=this.optCompleteServerCache_?new Yt(this.optCompleteServerCache_,!0,!1):this.viewCache_.serverCache;return Tn(this.writes_,e,n)},e.prototype.getChildAfterChild=function(e,t,n){var r=null!=this.optCompleteServerCache_?this.optCompleteServerCache_:en(this.viewCache_),o=On(this.writes_,r,t,1,n,e);return 0===o.length?null:o[0]},e}();function xn(e,t,n,r,o){var l,h,d=new In;if(n.type===Mt.OVERWRITE){var f=n;f.source.fromUser?l=Rn(e,t,f.path,f.snap,r,o,d):(Object(c.e)(f.source.fromServer,"Unknown source."),h=f.source.tagged||t.serverCache.isFiltered()&&!Ee(f.path),l=Nn(e,t,f.path,f.snap,r,o,h,d))}else if(n.type===Mt.MERGE){var _=n;_.source.fromUser?l=function(e,t,path,n,r,o,c){var l=t;return n.foreach((function(n,h){var d=Te(path,n);Dn(t,ge(d))&&(l=Rn(e,l,d,h,r,o,c))})),n.foreach((function(n,h){var d=Te(path,n);Dn(t,ge(d))||(l=Rn(e,l,d,h,r,o,c))})),l}(e,t,_.path,_.children,r,o,d):(Object(c.e)(_.source.fromServer,"Unknown source."),h=_.source.tagged||t.serverCache.isFiltered(),l=Fn(e,t,_.path,_.children,r,o,h,d))}else if(n.type===Mt.ACK_USER_WRITE){var v=n;l=v.revert?function(e,t,path,n,r,o){var l;if(null!=Cn(n,path))return t;var source=new Pn(n,t,r),h=t.eventCache.getNode(),d=void 0;if(Ee(path)||".priority"===ge(path)){var f=void 0;if(t.serverCache.isFullyInitialized())f=mn(n,en(t));else{var _=t.serverCache.getNode();Object(c.e)(_ instanceof ut,"serverChildren would be complete if leaf node"),f=bn(n,_)}f=f,d=e.filter.updateFullNode(h,f,o)}else{var v=ge(path),y=Tn(n,v,t.serverCache);null==y&&t.serverCache.isCompleteForChild(v)&&(y=h.getImmediateChild(v)),(d=null!=y?e.filter.updateChild(h,v,y,be(path),source,o):t.eventCache.getNode().hasChild(v)?e.filter.updateChild(h,v,ut.EMPTY_NODE,be(path),source,o):h).isEmpty()&&t.serverCache.isFullyInitialized()&&(l=mn(n,en(t))).isLeafNode()&&(d=e.filter.updateFullNode(d,l,o))}return l=t.serverCache.isFullyInitialized()||null!=Cn(n,ye()),Jt(t,d,l,e.filter.filtersNodes())}(e,t,v.path,r,o,d):function(e,t,n,r,o,c,l){if(null!=Cn(o,n))return t;var h=t.serverCache.isFiltered(),d=t.serverCache;if(null!=r.value){if(Ee(n)&&d.isFullyInitialized()||d.isCompleteForPath(n))return Nn(e,t,n,d.getNode().getChild(n),o,c,h,l);if(Ee(n)){var f=new tn(null);return d.getNode().forEachChild(We,(function(e,t){f=f.set(new ve(e),t)})),Fn(e,t,n,f,o,c,h,l)}return t}var _=new tn(null);return r.foreach((function(e,t){var r=Te(n,e);d.isCompleteForPath(r)&&(_=_.set(e,d.getNode().getChild(r)))})),Fn(e,t,n,_,o,c,h,l)}(e,t,v.path,v.affectedTree,r,o,d)}else{if(n.type!==Mt.LISTEN_COMPLETE)throw Object(c.f)("Unknown operation type: "+n.type);l=function(e,t,path,n,r){var o=t.serverCache,c=Xt(t,o.getNode(),o.isFullyInitialized()||Ee(path),o.isFiltered());return jn(e,c,path,n,Sn,r)}(e,t,n.path,r,d)}var y=d.getChanges();return function(e,t,n){var r=t.eventCache;if(r.isFullyInitialized()){var o=r.getNode().isLeafNode()||r.getNode().isEmpty(),c=Zt(e);(n.length>0||!e.eventCache.isFullyInitialized()||o&&!r.getNode().equals(c)||!r.getNode().getPriority().equals(c.getPriority()))&&n.push(bt(Zt(t)))}}(t,l,y),{viewCache:l,changes:y}}function jn(e,t,n,r,source,o){var l=t.eventCache;if(null!=Cn(r,n))return t;var h=void 0,d=void 0;if(Ee(n))if(Object(c.e)(t.serverCache.isFullyInitialized(),"If change path is empty, we must have complete server data"),t.serverCache.isFiltered()){var f=en(t),_=bn(r,f instanceof ut?f:ut.EMPTY_NODE);h=e.filter.updateFullNode(t.eventCache.getNode(),_,o)}else{var v=mn(r,en(t));h=e.filter.updateFullNode(t.eventCache.getNode(),v,o)}else{var y=ge(n);if(".priority"===y){Object(c.e)(1===me(n),"Can't have a priority with additional path components");var m=l.getNode(),w=wn(r,n,m,d=t.serverCache.getNode());h=null!=w?e.filter.updatePriority(m,w):l.getNode()}else{var C=be(n),O=void 0;if(l.isCompleteForChild(y)){d=t.serverCache.getNode();var T=wn(r,n,l.getNode(),d);O=null!=T?l.getNode().getImmediateChild(y).updateChild(C,T):l.getNode().getImmediateChild(y)}else O=Tn(r,y,t.serverCache);h=null!=O?e.filter.updateChild(l.getNode(),y,O,C,source,o):l.getNode()}}return Jt(t,h,l.isFullyInitialized()||Ee(n),e.filter.filtersNodes())}function Nn(e,t,n,r,o,c,l,h){var d,f=t.serverCache,_=l?e.filter:e.filter.getIndexedFilter();if(Ee(n))d=_.updateFullNode(f.getNode(),r,null);else if(_.filtersNodes()&&!f.isFiltered()){var v=f.getNode().updateChild(n,r);d=_.updateFullNode(f.getNode(),v,null)}else{var y=ge(n);if(!f.isCompleteForPath(n)&&me(n)>1)return t;var m=be(n),w=f.getNode().getImmediateChild(y).updateChild(m,r);d=".priority"===y?_.updatePriority(f.getNode(),w):_.updateChild(f.getNode(),y,w,m,Sn,null)}var C=Xt(t,d,f.isFullyInitialized()||Ee(n),_.filtersNodes());return jn(e,C,n,o,new Pn(o,C,c),h)}function Rn(e,t,n,r,o,c,l){var h,d,f=t.eventCache,source=new Pn(o,t,c);if(Ee(n))d=e.filter.updateFullNode(t.eventCache.getNode(),r,l),h=Jt(t,d,!0,e.filter.filtersNodes());else{var _=ge(n);if(".priority"===_)d=e.filter.updatePriority(t.eventCache.getNode(),r),h=Jt(t,d,f.isFullyInitialized(),f.isFiltered());else{var v=be(n),y=f.getNode().getImmediateChild(_),m=void 0;if(Ee(v))m=r;else{var w=source.getCompleteChild(_);m=null!=w?".priority"===we(v)&&w.getChild(Oe(v)).isEmpty()?w:w.updateChild(v,r):ut.EMPTY_NODE}if(y.equals(m))h=t;else h=Jt(t,e.filter.updateChild(f.getNode(),_,m,v,source,l),f.isFullyInitialized(),e.filter.filtersNodes())}}return h}function Dn(e,t){return e.eventCache.isCompleteForChild(t)}function An(e,t,n){return n.foreach((function(e,n){t=t.updateChild(e,n)})),t}function Fn(e,t,path,n,r,o,c,l){if(t.serverCache.getNode().isEmpty()&&!t.serverCache.isFullyInitialized())return t;var h,d=t;h=Ee(path)?n:new tn(null).setTree(path,n);var f=t.serverCache.getNode();return h.children.inorderTraversal((function(n,h){if(f.hasChild(n)){var _=An(0,t.serverCache.getNode().getImmediateChild(n),h);d=Nn(e,d,new ve(n),_,r,o,c,l)}})),h.children.inorderTraversal((function(n,h){var _=!t.serverCache.isCompleteForChild(n)&&void 0===h.value;if(!f.hasChild(n)&&!_){var v=An(0,t.serverCache.getNode().getImmediateChild(n),h);d=Nn(e,d,new ve(n),v,r,o,c,l)}})),d}var qn,Mn=function(){function e(e,t){this.query_=e,this.eventRegistrations_=[];var n,r=this.query_._queryParams,o=new Tt(r.getIndex()),filter=(n=r).loadsAllData()?new Tt(n.getIndex()):n.hasLimit()?new kt(n):new Et(n);this.processor_=function(filter){return{filter:filter}}(filter);var c=t.serverCache,l=t.eventCache,h=o.updateFullNode(ut.EMPTY_NODE,c.getNode(),null),d=filter.updateFullNode(ut.EMPTY_NODE,l.getNode(),null),f=new Yt(h,c.isFullyInitialized(),o.filtersNodes()),_=new Yt(d,l.isFullyInitialized(),filter.filtersNodes());this.viewCache_=$t(_,f),this.eventGenerator_=new Kt(this.query_)}return Object.defineProperty(e.prototype,"query",{get:function(){return this.query_},enumerable:!1,configurable:!0}),e}();function Ln(view,path){var e=en(view.viewCache_);return e&&(view.query._queryParams.loadsAllData()||!Ee(path)&&!e.getImmediateChild(ge(path)).isEmpty())?e.getChild(path):null}function Wn(view){return 0===view.eventRegistrations_.length}function Un(view,e,t){var n=[];if(t){Object(c.e)(null==e,"A cancel should cancel all event registrations.");var r=view.query._path;view.eventRegistrations_.forEach((function(e){var o=e.createCancelEvent(t,r);o&&n.push(o)}))}if(e){for(var o=[],i=0;i<view.eventRegistrations_.length;++i){var l=view.eventRegistrations_[i];if(l.matches(e)){if(e.hasAnyCallback()){o=o.concat(view.eventRegistrations_.slice(i+1));break}}else o.push(l)}view.eventRegistrations_=o}else view.eventRegistrations_=[];return n}function Bn(view,e,t,n){e.type===Mt.MERGE&&null!==e.source.queryId&&(Object(c.e)(en(view.viewCache_),"We should always have a full cache before handling merges"),Object(c.e)(Zt(view.viewCache_),"Missing event cache, even though we have a server cache"));var r,o,l=view.viewCache_,h=xn(view.processor_,l,e,t,n);return r=view.processor_,o=h.viewCache,Object(c.e)(o.eventCache.getNode().isIndexed(r.filter.getIndex()),"Event snap not indexed"),Object(c.e)(o.serverCache.getNode().isIndexed(r.filter.getIndex()),"Server snap not indexed"),Object(c.e)(h.viewCache.serverCache.isFullyInitialized()||!l.serverCache.isFullyInitialized(),"Once a server snap is complete, it should never go back"),view.viewCache_=h.viewCache,Qn(view,h.changes,h.viewCache.eventCache.getNode(),null)}function Qn(view,e,t,n){var r=n?[n]:view.eventRegistrations_;return function(e,t,n,r){var o=[],c=[];return t.forEach((function(t){var n;"child_changed"===t.type&&e.index_.indexedValueChanged(t.oldSnap,t.snapshotNode)&&c.push((n=t.childName,{type:"child_moved",snapshotNode:t.snapshotNode,childName:n}))})),Gt(e,o,"child_removed",t,r,n),Gt(e,o,"child_added",t,r,n),Gt(e,o,"child_moved",c,r,n),Gt(e,o,"child_changed",t,r,n),Gt(e,o,"value",t,r,n),o}(view.eventGenerator_,e,t,r)}var Vn,Hn=function(){this.views=new Map};function zn(e,t,n,r){var o,h,d=t.source.queryId;if(null!==d){var view=e.views.get(d);return Object(c.e)(null!=view,"SyncTree gave us an op for an invalid query."),Bn(view,t,n,r)}var f=[];try{for(var _=Object(l.g)(e.views.values()),v=_.next();!v.done;v=_.next()){view=v.value;f=f.concat(Bn(view,t,n,r))}}catch(e){o={error:e}}finally{try{v&&!v.done&&(h=_.return)&&h.call(_)}finally{if(o)throw o.error}}return f}function Yn(e,t,n,r,o){var c=t._queryIdentifier,view=e.views.get(c);if(!view){var l=mn(n,o?r:null),h=!1;l?h=!0:r instanceof ut?(l=bn(n,r),h=!1):(l=ut.EMPTY_NODE,h=!1);var d=$t(new Yt(l,h,!1),new Yt(r,o,!1));return new Mn(t,d)}return view}function Kn(e,t,n,r,o,c){var view=Yn(e,t,r,o,c);return e.views.has(t._queryIdentifier)||e.views.set(t._queryIdentifier,view),function(view,e){view.eventRegistrations_.push(e)}(view,n),function(view,e){var t=view.viewCache_.eventCache,n=[];return t.getNode().isLeafNode()||t.getNode().forEachChild(tt,(function(e,t){n.push(wt(e,t))})),t.isFullyInitialized()&&n.push(bt(t.getNode())),Qn(view,n,t.getNode(),e)}(view,n)}function Gn(e,t,n,r){var o,h,d=t._queryIdentifier,f=[],_=[],v=er(e);if("default"===d)try{for(var y=Object(l.g)(e.views.entries()),m=y.next();!m.done;m=y.next()){var w=Object(l.e)(m.value,2),C=w[0],view=w[1];_=_.concat(Un(view,n,r)),Wn(view)&&(e.views.delete(C),view.query._queryParams.loadsAllData()||f.push(view.query))}}catch(e){o={error:e}}finally{try{m&&!m.done&&(h=y.return)&&h.call(y)}finally{if(o)throw o.error}}else(view=e.views.get(d))&&(_=_.concat(Un(view,n,r)),Wn(view)&&(e.views.delete(d),view.query._queryParams.loadsAllData()||f.push(view.query)));return v&&!er(e)&&f.push(new(Object(c.e)(qn,"Reference.ts has not been loaded"),qn)(t._repo,t._path)),{removed:f,events:_}}function $n(e){var t,n,r=[];try{for(var o=Object(l.g)(e.views.values()),c=o.next();!c.done;c=o.next()){var view=c.value;view.query._queryParams.loadsAllData()||r.push(view)}}catch(e){t={error:e}}finally{try{c&&!c.done&&(n=o.return)&&n.call(o)}finally{if(t)throw t.error}}return r}function Jn(e,path){var t,n,r=null;try{for(var o=Object(l.g)(e.views.values()),c=o.next();!c.done;c=o.next()){var view=c.value;r=r||Ln(view,path)}}catch(e){t={error:e}}finally{try{c&&!c.done&&(n=o.return)&&n.call(o)}finally{if(t)throw t.error}}return r}function Xn(e,t){if(t._queryParams.loadsAllData())return nr(e);var n=t._queryIdentifier;return e.views.get(n)}function Zn(e,t){return null!=Xn(e,t)}function er(e){return null!=nr(e)}function nr(e){var t,n;try{for(var r=Object(l.g)(e.views.values()),o=r.next();!o.done;o=r.next()){var view=o.value;if(view.query._queryParams.loadsAllData())return view}}catch(e){t={error:e}}finally{try{o&&!o.done&&(n=r.return)&&n.call(r)}finally{if(t)throw t.error}}return null}var rr=1,ir=function(e){this.listenProvider_=e,this.syncPointTree_=new tn(null),this.pendingWriteTree_={visibleWrites:nn.empty(),allWrites:[],lastWriteId:-1},this.tagToQueryMap=new Map,this.queryToTagMap=new Map};function or(e,path,t,n,r){return function(e,path,t,n,r){Object(c.e)(n>e.lastWriteId,"Stacking an older write on top of newer ones"),void 0===r&&(r=!0),e.allWrites.push({path:path,snap:t,writeId:n,visible:r}),r&&(e.visibleWrites=rn(e.visibleWrites,path,t)),e.lastWriteId=n}(e.pendingWriteTree_,path,t,n,r),r?fr(e,new Ht({fromUser:!0,fromServer:!1,queryId:null,tagged:!1},path,t)):[]}function ar(e,path,t,n){!function(e,path,t,n){Object(c.e)(n>e.lastWriteId,"Stacking an older merge on top of newer ones"),e.allWrites.push({path:path,children:t,writeId:n,visible:!0}),e.visibleWrites=on(e.visibleWrites,path,t),e.lastWriteId=n}(e.pendingWriteTree_,path,t,n);var r=tn.fromObject(t);return fr(e,new zt({fromUser:!0,fromServer:!1,queryId:null,tagged:!1},path,r))}function sr(e,t,n){void 0===n&&(n=!1);var r=function(e,t){for(var i=0;i<e.allWrites.length;i++){var n=e.allWrites[i];if(n.writeId===t)return n}return null}(e.pendingWriteTree_,t);if(fn(e.pendingWriteTree_,t)){var o=new tn(null);return null!=r.snap?o=o.set(ye(),!0):V(r.children,(function(e){o=o.set(new ve(e),!0)})),fr(e,new Qt(r.path,o,n))}return[]}function ur(e,path,t){return fr(e,new Ht({fromUser:!1,fromServer:!0,queryId:null,tagged:!1},path,t))}function cr(e,t,n,r){var path=t._path,o=e.syncPointTree_.get(path),c=[];if(o&&("default"===t._queryIdentifier||Zn(o,t))){var l=Gn(o,t,n,r);0===o.views.size&&(e.syncPointTree_=e.syncPointTree_.remove(path));var h=l.removed;c=l.events;var d=-1!==h.findIndex((function(e){return e._queryParams.loadsAllData()})),f=e.syncPointTree_.findOnPath(path,(function(e,t){return er(t)}));if(d&&!f){var _=e.syncPointTree_.subtree(path);if(!_.isEmpty())for(var v=function(e){return e.fold((function(e,t,n){if(t&&er(t))return[nr(t)];var r=[];return t&&(r=$n(t)),V(n,(function(e,t){r=r.concat(t)})),r}))}(_),i=0;i<v.length;++i){var view=v[i],y=view.query,m=_r(e,view);e.listenProvider_.startListening(Cr(y),vr(e,y),m.hashFn,m.onComplete)}}if(!f&&h.length>0&&!r)if(d){e.listenProvider_.stopListening(Cr(t),null)}else h.forEach((function(t){var n=e.queryToTagMap.get(yr(t));e.listenProvider_.stopListening(Cr(t),n)}));!function(e,t){for(var n=0;n<t.length;++n){var r=t[n];if(!r._queryParams.loadsAllData()){var o=yr(r),c=e.queryToTagMap.get(o);e.queryToTagMap.delete(o),e.tagToQueryMap.delete(c)}}}(e,h)}return c}function lr(e,t,n){var path=t._path,r=null,o=!1;e.syncPointTree_.foreachOnPath(path,(function(e,t){var n=ke(e,path);r=r||Jn(t,n),o=o||er(t)}));var l,h=e.syncPointTree_.get(path);(h?(o=o||er(h),r=r||Jn(h,ye())):(h=new Hn,e.syncPointTree_=e.syncPointTree_.set(path,h)),null!=r)?l=!0:(l=!1,r=ut.EMPTY_NODE,e.syncPointTree_.subtree(path).foreachChild((function(e,t){var n=Jn(t,ye());n&&(r=r.updateImmediateChild(e,n))})));var d=Zn(h,t);if(!d&&!t._queryParams.loadsAllData()){var f=yr(t);Object(c.e)(!e.queryToTagMap.has(f),"View does not exist, but we have a tag");var _=rr++;e.queryToTagMap.set(f,_),e.tagToQueryMap.set(_,f)}var v=Kn(h,t,n,pn(e.pendingWriteTree_,path),r,l);if(!d&&!o){var view=Xn(h,t);v=v.concat(function(e,t,view){var path=t._path,n=vr(e,t),r=_r(e,view),o=e.listenProvider_.startListening(Cr(t),n,r.hashFn,r.onComplete),l=e.syncPointTree_.subtree(path);if(n)Object(c.e)(!er(l.value),"If we're adding a query, it shouldn't be shadowed");else for(var h=l.fold((function(e,t,n){if(!Ee(e)&&t&&er(t))return[nr(t).query];var r=[];return t&&(r=r.concat($n(t).map((function(view){return view.query})))),V(n,(function(e,t){r=r.concat(t)})),r})),i=0;i<h.length;++i){var d=h[i];e.listenProvider_.stopListening(Cr(d),vr(e,d))}return o}(e,t,view))}return v}function dr(e,path,t){var n=e.pendingWriteTree_,r=e.syncPointTree_.findOnPath(path,(function(e,t){var n=Jn(t,ke(e,path));if(n)return n}));return gn(n,path,r,t,!0)}function pr(e,t){var path=t._path,n=null;e.syncPointTree_.foreachOnPath(path,(function(e,t){var r=ke(e,path);n=n||Jn(t,r)}));var r=e.syncPointTree_.get(path);r?n=n||Jn(r,ye()):(r=new Hn,e.syncPointTree_=e.syncPointTree_.set(path,r));var o=null!=n,c=o?new Yt(n,!0,!1):null;return function(view){return Zt(view.viewCache_)}(Yn(r,t,pn(e.pendingWriteTree_,t._path),o?c.getNode():ut.EMPTY_NODE,o))}function fr(e,t){return function e(t,n,r,o){if(Ee(t.path))return function e(t,n,r,o){var c=n.get(ye());null==r&&null!=c&&(r=Jn(c,ye()));var l=[];n.children.inorderTraversal((function(n,c){var h=r?r.getImmediateChild(n):null,d=En(o,n),f=t.operationForChild(n);f&&(l=l.concat(e(f,c,h,d)))})),c&&(l=l.concat(zn(c,t,o,r)));return l}(t,n,r,o);var c=n.get(ye());null==r&&null!=c&&(r=Jn(c,ye()));var l=[],h=ge(t.path),d=t.operationForChild(h),f=n.children.get(h);if(f&&d){var _=r?r.getImmediateChild(h):null,v=En(o,h);l=l.concat(e(d,f,_,v))}return c&&(l=l.concat(zn(c,t,o,r))),l}(t,e.syncPointTree_,null,pn(e.pendingWriteTree_,ye()))}function _r(e,view){var t=view.query,n=vr(e,t);return{hashFn:function(){return(function(view){return view.viewCache_.serverCache.getNode()}(view)||ut.EMPTY_NODE).hash()},onComplete:function(r){if("ok"===r)return n?function(e,path,t){var n=gr(e,t);if(n){var r=mr(n),o=r.path,c=r.queryId,l=ke(o,path);return wr(e,o,new Vt(Ut(c),l))}return[]}(e,t._path,n):function(e,path){return fr(e,new Vt({fromUser:!1,fromServer:!0,queryId:null,tagged:!1},path))}(e,t._path);var o=function(code,e){var t="Unknown Error";"too_big"===code?t="The data requested exceeds the maximum size that can be accessed with a single request.":"permission_denied"===code?t="Client doesn't have permission to access the desired data.":"unavailable"===code&&(t="The service is unavailable");var n=new Error(code+" at "+e._path.toString()+": "+t);return n.code=code.toUpperCase(),n}(r,t);return cr(e,t,null,o)}}}function vr(e,t){var n=yr(t);return e.queryToTagMap.get(n)}function yr(e){return e._path.toString()+"$"+e._queryIdentifier}function gr(e,t){return e.tagToQueryMap.get(t)}function mr(e){var t=e.indexOf("$");return Object(c.e)(-1!==t&&t<e.length-1,"Bad queryKey."),{queryId:e.substr(t+1),path:new ve(e.substr(0,t))}}function wr(e,t,n){var r=e.syncPointTree_.get(t);return Object(c.e)(r,"Missing sync point for query tag that we're tracking"),zn(r,n,pn(e.pendingWriteTree_,t),null)}function Cr(e){return e._queryParams.loadsAllData()&&!e._queryParams.isDefault()?new(Object(c.e)(Vn,"Reference.ts has not been loaded"),Vn)(e._repo,e._path):e}var Or=function(){function e(e){this.node_=e}return e.prototype.getImmediateChild=function(t){return new e(this.node_.getImmediateChild(t))},e.prototype.node=function(){return this.node_},e}(),Tr=function(){function e(e,path){this.syncTree_=e,this.path_=path}return e.prototype.getImmediateChild=function(t){var n=Te(this.path_,t);return new e(this.syncTree_,n)},e.prototype.node=function(){return dr(this.syncTree_,this.path_)},e}(),Er=function(e,t,n){return e&&"object"==typeof e?(Object(c.e)(".sv"in e,"Unexpected leaf node or priority contents"),"string"==typeof e[".sv"]?kr(e[".sv"],t,n):"object"==typeof e[".sv"]?Ir(e[".sv"],t):void Object(c.e)(!1,"Unexpected server value: "+JSON.stringify(e,null,2))):e},kr=function(e,t,n){switch(e){case"timestamp":return n.timestamp;default:Object(c.e)(!1,"Unexpected server value: "+e)}},Ir=function(e,t,n){e.hasOwnProperty("increment")||Object(c.e)(!1,"Unexpected server value: "+JSON.stringify(e,null,2));var r=e.increment;"number"!=typeof r&&Object(c.e)(!1,"Unexpected increment value: "+r);var o=t.node();if(Object(c.e)(null!=o,"Expected ChildrenNode.EMPTY_NODE for nulls"),!o.isLeafNode())return r;var l=o.getValue();return"number"!=typeof l?r:l+r},Sr=function(path,e,t,n){return xr(e,new Tr(t,path),n)},Pr=function(e,t,n){return xr(e,new Or(t),n)};function xr(e,t,n){var r,o=e.getPriority().val(),c=Er(o,t.getImmediateChild(".priority"),n);if(e.isLeafNode()){var l=e,h=Er(l.getValue(),t,n);return h!==l.getValue()||c!==l.getPriority().val()?new Xe(h,lt(c)):e}var d=e;return r=d,c!==d.getPriority().val()&&(r=r.updatePriority(new Xe(c))),d.forEachChild(tt,(function(e,o){var c=xr(o,t.getImmediateChild(e),n);c!==o&&(r=r.updateImmediateChild(e,c))})),r}var jr=function(e,t,n){void 0===e&&(e=""),void 0===t&&(t=null),void 0===n&&(n={children:{},childCount:0}),this.name=e,this.parent=t,this.node=n};function Nr(e,t){for(var path=t instanceof ve?t:new ve(t),n=e,r=ge(path);null!==r;){var o=Object(c.A)(n.node.children,r)||{children:{},childCount:0};n=new jr(r,n,o),r=ge(path=be(path))}return n}function Rr(e){return e.node.value}function Dr(e,t){e.node.value=t,Mr(e)}function Ar(e){return e.node.childCount>0}function Fr(e,t){V(e.node.children,(function(n,r){t(new jr(n,e,r))}))}function qr(e){return new ve(null===e.parent?e.name:qr(e.parent)+"/"+e.name)}function Mr(e){null!==e.parent&&function(e,t,n){var r=function(e){return void 0===Rr(e)&&!Ar(e)}(n),o=Object(c.i)(e.node.children,t);r&&o?(delete e.node.children[t],e.node.childCount--,Mr(e)):r||o||(e.node.children[t]=n.node,e.node.childCount++,Mr(e))}(e.parent,e.name,e)}var Lr=/[\[\].#$\/\u0000-\u001F\u007F]/,Wr=/[\[\].#$\u0000-\u001F\u007F]/,Ur=function(e){return"string"==typeof e&&0!==e.length&&!Lr.test(e)},Br=function(e){return"string"==typeof e&&0!==e.length&&!Wr.test(e)},Qr=function(e){return null===e||"string"==typeof e||"number"==typeof e&&!A(e)||e&&"object"==typeof e&&Object(c.i)(e,".sv")},Vr=function(e,t,path,n){n&&void 0===t||Hr(Object(c.n)(e,"value"),t,path)},Hr=function(e,data,t){var path=t instanceof ve?new xe(t,e):t;if(void 0===data)throw new Error(e+"contains undefined "+Ne(path));if("function"==typeof data)throw new Error(e+"contains a function "+Ne(path)+" with contents = "+data.toString());if(A(data))throw new Error(e+"contains "+data.toString()+" "+Ne(path));if("string"==typeof data&&data.length>10485760/3&&Object(c.B)(data)>10485760)throw new Error(e+"contains a string greater than 10485760 utf8 bytes "+Ne(path)+" ('"+data.substring(0,50)+"...')");if(data&&"object"==typeof data){var n=!1,r=!1;if(V(data,(function(t,o){if(".value"===t)n=!0;else if(".priority"!==t&&".sv"!==t&&(r=!0,!Ur(t)))throw new Error(e+" contains an invalid key ("+t+") "+Ne(path)+'.  Keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]"');var l,h;!function(e,t){e.parts_.length>0&&(e.byteLength_+=1),e.parts_.push(t),e.byteLength_+=Object(c.B)(t),je(e)}(path,t),Hr(e,o,path),h=(l=path).parts_.pop(),l.byteLength_-=Object(c.B)(h),l.parts_.length>0&&(l.byteLength_-=1)})),n&&r)throw new Error(e+' contains ".value" child '+Ne(path)+" in addition to actual children.")}},zr=function(e,data,path,t){if(!t||void 0!==data){var n=Object(c.n)(e,"values");if(!data||"object"!=typeof data||Array.isArray(data))throw new Error(n+" must be an object containing the children to replace.");var r=[];V(data,(function(e,t){var o=new ve(e);if(Hr(n,t,Te(path,o)),".priority"===we(o)&&!Qr(t))throw new Error(n+"contains an invalid value for '"+o.toString()+"', which must be a valid Firebase priority (a string, finite number, server value, or null).");r.push(o)})),function(e,t){var i,n;for(i=0;i<t.length;i++)for(var r=Ce(n=t[i]),o=0;o<r.length;o++)if(".priority"===r[o]&&o===r.length-1);else if(!Ur(r[o]))throw new Error(e+"contains an invalid key ("+r[o]+") in path "+n.toString()+'. Keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]"');t.sort(Ie);var c=null;for(i=0;i<t.length;i++){if(n=t[i],null!==c&&Pe(c,n))throw new Error(e+"contains a path "+c.toString()+" that is ancestor of another path "+n.toString());c=n}}(n,r)}},Yr=function(e,t,n){if(!n||void 0!==t){if(A(t))throw new Error(Object(c.n)(e,"priority")+"is "+t.toString()+", but must be a valid Firebase priority (a string, finite number, server value, or null).");if(!Qr(t))throw new Error(Object(c.n)(e,"priority")+"must be a valid Firebase priority (a string, finite number, server value, or null).")}},Kr=function(e,t,n){if(!n||void 0!==t)switch(t){case"value":case"child_added":case"child_removed":case"child_changed":case"child_moved":break;default:throw new Error(Object(c.n)(e,"eventType")+'must be a valid event type = "value", "child_added", "child_removed", "child_changed", or "child_moved".')}},Gr=function(e,t,n,r){if(!(r&&void 0===n||Ur(n)))throw new Error(Object(c.n)(e,t)+'was an invalid key = "'+n+'".  Firebase keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]").')},$r=function(e,t,n,r){if(!(r&&void 0===n||Br(n)))throw new Error(Object(c.n)(e,t)+'was an invalid path = "'+n+'". Paths must be non-empty strings and can\'t contain ".", "#", "$", "[", or "]"')},Jr=function(e,path){if(".info"===ge(path))throw new Error(e+" failed = Can't modify data under /.info/")},Xr=function(e,t){var n=t.path.toString();if("string"!=typeof t.repoInfo.host||0===t.repoInfo.host.length||!Ur(t.repoInfo.namespace)&&"localhost"!==t.repoInfo.host.split(":")[0]||0!==n.length&&!function(e){return e&&(e=e.replace(/^\/*\.info(\/|$)/,"/")),Br(e)}(n))throw new Error(Object(c.n)(e,"url")+'must be a valid firebase URL and the path can\'t contain ".", "#", "$", "[", or "]".')},Zr=function(e,t,n,r){if((!r||void 0!==n)&&"boolean"!=typeof n)throw new Error(Object(c.n)(e,t)+"must be a boolean.")},ei=function(){this.eventLists_=[],this.recursionDepth_=0};function ti(e,t){for(var n=null,i=0;i<t.length;i++){var data=t[i],path=data.getPath();null===n||Se(path,n.path)||(e.eventLists_.push(n),n=null),null===n&&(n={events:[],path:path}),n.events.push(data)}n&&e.eventLists_.push(n)}function ni(e,path,t){ti(e,t),ii(e,(function(e){return Se(e,path)}))}function ri(e,t,n){ti(e,n),ii(e,(function(e){return Pe(e,t)||Pe(t,e)}))}function ii(e,t){e.recursionDepth_++;for(var n=!0,i=0;i<e.eventLists_.length;i++){var r=e.eventLists_[i];if(r)t(r.path)?(oi(e.eventLists_[i]),e.eventLists_[i]=null):n=!1}n&&(e.eventLists_=[]),e.recursionDepth_--}function oi(e){for(var i=0;i<e.events.length;i++){var t=e.events[i];if(null!==t){e.events[i]=null;var n=t.getEventRunner();I&&x("event: "+t.toString()),K(n)}}}var ai=function(){function e(e,t,n,r){this.repoInfo_=e,this.forceRestClient_=t,this.authTokenProvider_=n,this.appCheckProvider_=r,this.dataUpdateCount=0,this.statsListener_=null,this.eventQueue_=new ei,this.nextWriteId_=1,this.interceptServerDataCallback_=null,this.onDisconnect_=At(),this.transactionQueueTree_=new jr,this.persistentConnection_=null,this.key=this.repoInfo_.toURLString()}return e.prototype.toString=function(){return(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host},e}();function si(e,t,n){if(e.stats_=oe(e.repoInfo_),e.forceRestClient_||("object"==typeof window&&window.navigator&&window.navigator.userAgent||"").search(/googlebot|google webmaster tools|bingbot|yahoo! slurp|baiduspider|yandexbot|duckduckbot/i)>=0)e.server_=new Rt(e.repoInfo_,(function(t,data,n,r){hi(e,t,data,n,r)}),e.authTokenProvider_,e.appCheckProvider_),setTimeout((function(){return di(e,!0)}),0);else{if(null!=n){if("object"!=typeof n)throw new Error("Only objects are supported for option databaseAuthVariableOverride");try{Object(c.D)(n)}catch(e){throw new Error("Invalid authOverride provided: "+e)}}e.persistentConnection_=new Fe(e.repoInfo_,t,(function(t,data,n,r){hi(e,t,data,n,r)}),(function(t){di(e,t)}),(function(t){!function(e,t){V(t,(function(t,n){pi(e,t,n)}))}(e,t)}),e.authTokenProvider_,e.appCheckProvider_,n),e.server_=e.persistentConnection_}var r,o,l;e.authTokenProvider_.addTokenChangeListener((function(t){e.server_.refreshAuthToken(t)})),e.appCheckProvider_.addTokenChangeListener((function(t){e.server_.refreshAppCheckToken(t.token)})),e.statsReporter_=(r=e.repoInfo_,o=function(){return new Wt(e.stats_,e.server_)},l=r.toString(),ie[l]||(ie[l]=o()),ie[l]),e.infoData_=new Dt,e.infoSyncTree_=new ir({startListening:function(t,n,r,o){var c=[],l=e.infoData_.getNode(t._path);return l.isEmpty()||(c=ur(e.infoSyncTree_,t._path,l),setTimeout((function(){o("ok")}),0)),c},stopListening:function(){}}),pi(e,"connected",!1),e.serverSyncTree_=new ir({startListening:function(t,n,r,o){return e.server_.listen(t,r,n,(function(n,data){var r=o(n,data);ri(e.eventQueue_,t._path,r)})),[]},stopListening:function(t,n){e.server_.unlisten(t,n)}})}function ui(e){var t=e.infoData_.getNode(new ve(".info/serverTimeOffset")).val()||0;return(new Date).getTime()+t}function ci(e){return(t=(t={timestamp:ui(e)})||{}).timestamp=t.timestamp||(new Date).getTime(),t;var t}function hi(e,t,data,n,r){e.dataUpdateCount++;var path=new ve(t);data=e.interceptServerDataCallback_?e.interceptServerDataCallback_(t,data):data;var o=[];if(r)if(n){var l=Object(c.y)(data,(function(e){return lt(e)}));o=function(e,path,t,n){var r=gr(e,n);if(r){var o=mr(r),c=o.path,l=o.queryId,h=ke(c,path),d=tn.fromObject(t);return wr(e,c,new zt(Ut(l),h,d))}return[]}(e.serverSyncTree_,path,l,r)}else{var h=lt(data);o=function(e,path,t,n){var r=gr(e,n);if(null!=r){var o=mr(r),c=o.path,l=o.queryId,h=ke(c,path);return wr(e,c,new Ht(Ut(l),h,t))}return[]}(e.serverSyncTree_,path,h,r)}else if(n){var d=Object(c.y)(data,(function(e){return lt(e)}));o=function(e,path,t){var n=tn.fromObject(t);return fr(e,new zt({fromUser:!1,fromServer:!0,queryId:null,tagged:!1},path,n))}(e.serverSyncTree_,path,d)}else{var f=lt(data);o=ur(e.serverSyncTree_,path,f)}var _=path;o.length>0&&(_=Ti(e,path)),ri(e.eventQueue_,_,o)}function di(e,t){pi(e,"connected",t),!1===t&&function(e){bi(e,"onDisconnectEvents");var t=ci(e),n=At();qt(e.onDisconnect_,ye(),(function(path,r){var o=Sr(path,r,e.serverSyncTree_,t);Ft(n,path,o)}));var r=[];qt(n,ye(),(function(path,t){r=r.concat(ur(e.serverSyncTree_,path,t));var n=Si(e,path);Ti(e,n)})),e.onDisconnect_=At(),ri(e.eventQueue_,ye(),r)}(e)}function pi(e,t,n){var path=new ve("/.info/"+t),r=lt(n);e.infoData_.updateSnapshot(path,r);var o=ur(e.infoSyncTree_,path,r);ri(e.eventQueue_,path,o)}function fi(e){return e.nextWriteId_++}function _i(e,path,t,n,r){bi(e,"set",{path:path.toString(),value:t,priority:n});var o=ci(e),c=lt(t,n),l=dr(e.serverSyncTree_,path),h=Pr(c,l,o),d=fi(e),f=or(e.serverSyncTree_,path,h,d,!0);ti(e.eventQueue_,f),e.server_.put(path.toString(),c.val(!0),(function(t,n){var o="ok"===t;o||D("set at "+path+" failed: "+t);var c=sr(e.serverSyncTree_,d,!o);ri(e.eventQueue_,path,c),wi(e,r,t,n)}));var _=Si(e,path);Ti(e,_),ri(e.eventQueue_,_,[])}function vi(e,path,t){e.server_.onDisconnectCancel(path.toString(),(function(n,r){"ok"===n&&function e(t,path){if(Ee(path))return t.value=null,t.children.clear(),!0;if(null!==t.value){if(t.value.isLeafNode())return!1;var n=t.value;return t.value=null,n.forEachChild(tt,(function(e,n){Ft(t,new ve(e),n)})),e(t,path)}if(t.children.size>0){var r=ge(path);if(path=be(path),t.children.has(r))e(t.children.get(r),path)&&t.children.delete(r);return 0===t.children.size}return!0}(e.onDisconnect_,path),wi(e,t,n,r)}))}function yi(e,path,t,n){var r=lt(t);e.server_.onDisconnectPut(path.toString(),r.val(!0),(function(t,o){"ok"===t&&Ft(e.onDisconnect_,path,r),wi(e,n,t,o)}))}function gi(e,t,n){var r;r=".info"===ge(t._path)?cr(e.infoSyncTree_,t,n):cr(e.serverSyncTree_,t,n),ni(e.eventQueue_,t._path,r)}function mi(e){e.persistentConnection_&&e.persistentConnection_.interrupt("repo_interrupt")}function bi(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];var r="";e.persistentConnection_&&(r=e.persistentConnection_.id+":"),x.apply(void 0,Object(l.f)([r],Object(l.e)(t)))}function wi(e,t,n,r){t&&K((function(){if("ok"===n)t(null);else{var code=(n||"error").toUpperCase(),e=code;r&&(e+=": "+r);var o=new Error(e);o.code=code,t(o)}}))}function Ci(e,path,t){return dr(e.serverSyncTree_,path,t)||ut.EMPTY_NODE}function Oi(e,t){if(void 0===t&&(t=e.transactionQueueTree_),t||Ii(e,t),Rr(t)){var n=ki(e,t);Object(c.e)(n.length>0,"Sending zero length transaction queue"),n.every((function(e){return 0===e.status}))&&function(e,path,t){for(var n=t.map((function(e){return e.currentWriteId})),r=Ci(e,path,n),o=r,l=r.hash(),i=0;i<t.length;i++){var h=t[i];Object(c.e)(0===h.status,"tryToSendTransactionQueue_: items in queue should all be run."),h.status=1,h.retryCount++;var d=ke(path,h.path);o=o.updateChild(d,h.currentOutputSnapshotRaw)}var f=o.val(!0),_=path;e.server_.put(_.toString(),f,(function(n){bi(e,"transaction put response",{path:_.toString(),status:n});var r=[];if("ok"===n){for(var o=[],c=function(i){t[i].status=2,r=r.concat(sr(e.serverSyncTree_,t[i].currentWriteId)),t[i].onComplete&&o.push((function(){return t[i].onComplete(null,!0,t[i].currentOutputSnapshotResolved)})),t[i].unwatcher()},i=0;i<t.length;i++)c(i);Ii(e,Nr(e.transactionQueueTree_,path)),Oi(e,e.transactionQueueTree_),ri(e.eventQueue_,path,r);for(i=0;i<o.length;i++)K(o[i])}else{if("datastale"===n)for(i=0;i<t.length;i++)3===t[i].status?t[i].status=4:t[i].status=0;else{D("transaction at "+_.toString()+" failed: "+n);for(i=0;i<t.length;i++)t[i].status=4,t[i].abortReason=n}Ti(e,path)}}),l)}(e,qr(t),n)}else Ar(t)&&Fr(t,(function(t){Oi(e,t)}))}function Ti(e,t){var n=Ei(e,t),path=qr(n);return function(e,t,path){if(0===t.length)return;for(var n=[],r=[],o=t.filter((function(q){return 0===q.status})).map((function(q){return q.currentWriteId})),l=function(i){var l,h,d=t[i],f=ke(path,d.path),_=!1;if(Object(c.e)(null!==f,"rerunTransactionsUnderNode_: relativePath should not be null."),4===d.status)_=!0,l=d.abortReason,r=r.concat(sr(e.serverSyncTree_,d.currentWriteId,!0));else if(0===d.status)if(d.retryCount>=25)_=!0,l="maxretry",r=r.concat(sr(e.serverSyncTree_,d.currentWriteId,!0));else{var v=Ci(e,d.path,o);d.currentInputSnapshot=v;var y=t[i].update(v.val());if(void 0!==y){Hr("transaction failed: Data returned ",y,d.path);var m=lt(y);"object"==typeof y&&null!=y&&Object(c.i)(y,".priority")||(m=m.updatePriority(v.getPriority()));var w=d.currentWriteId,C=ci(e),O=Pr(m,v,C);d.currentOutputSnapshotRaw=m,d.currentOutputSnapshotResolved=O,d.currentWriteId=fi(e),o.splice(o.indexOf(w),1),r=(r=r.concat(or(e.serverSyncTree_,d.path,O,d.currentWriteId,d.applyLocally))).concat(sr(e.serverSyncTree_,w,!0))}else _=!0,l="nodata",r=r.concat(sr(e.serverSyncTree_,d.currentWriteId,!0))}ri(e.eventQueue_,path,r),r=[],_&&(t[i].status=2,h=t[i].unwatcher,setTimeout(h,Math.floor(0)),t[i].onComplete&&("nodata"===l?n.push((function(){return t[i].onComplete(null,!1,t[i].currentInputSnapshot)})):n.push((function(){return t[i].onComplete(new Error(l),!1,null)}))))},i=0;i<t.length;i++)l(i);Ii(e,e.transactionQueueTree_);for(i=0;i<n.length;i++)K(n[i]);Oi(e,e.transactionQueueTree_)}(e,ki(e,n),path),path}function Ei(e,path){var t,n=e.transactionQueueTree_;for(t=ge(path);null!==t&&void 0===Rr(n);)n=Nr(n,t),t=ge(path=be(path));return n}function ki(e,t){var n=[];return function e(t,n,r){var o=Rr(n);if(o)for(var i=0;i<o.length;i++)r.push(o[i]);Fr(n,(function(n){e(t,n,r)}))}(e,t,n),n.sort((function(a,b){return a.order-b.order})),n}function Ii(e,t){var n=Rr(t);if(n){for(var r=0,o=0;o<n.length;o++)2!==n[o].status&&(n[r]=n[o],r++);n.length=r,Dr(t,n.length>0?n:void 0)}Fr(t,(function(t){Ii(e,t)}))}function Si(e,path){var t=qr(Ei(e,path)),n=Nr(e.transactionQueueTree_,path);return function(e,t,n){for(var r=n?e:e.parent;null!==r;){if(t(r))return!0;r=r.parent}}(n,(function(t){Pi(e,t)})),Pi(e,n),function e(t,n,r,o){r&&!o&&n(t),Fr(t,(function(t){e(t,n,!0,o)})),r&&o&&n(t)}(n,(function(t){Pi(e,t)})),t}function Pi(e,t){var n=Rr(t);if(n){for(var r=[],o=[],l=-1,i=0;i<n.length;i++)3===n[i].status||(1===n[i].status?(Object(c.e)(l===i-1,"All SENT items should be at beginning of queue."),l=i,n[i].status=3,n[i].abortReason="set"):(Object(c.e)(0===n[i].status,"Unexpected transaction status in abort"),n[i].unwatcher(),o=o.concat(sr(e.serverSyncTree_,n[i].currentWriteId,!0)),n[i].onComplete&&r.push(n[i].onComplete.bind(null,new Error("set"),!1,null))));-1===l?Dr(t,void 0):n.length=l+1,ri(e.eventQueue_,qr(t),o);for(i=0;i<r.length;i++)K(r[i])}}var xi=function(e,t){var n=ji(e),r=n.namespace;"firebase.com"===n.domain&&R(n.host+" is no longer supported. Please use <YOUR FIREBASE>.firebaseio.com instead"),r&&"undefined"!==r||"localhost"===n.domain||R("Cannot parse Firebase url. Please use https://<YOUR FIREBASE>.firebaseio.com"),n.secure||"undefined"!=typeof window&&window.location&&window.location.protocol&&-1!==window.location.protocol.indexOf("https:")&&D("Insecure Firebase access from a secure page. Please use https in calls to new Firebase().");var o="ws"===n.scheme||"wss"===n.scheme;return{repoInfo:new ee(n.host,n.secure,r,t,o,"",r!==n.subdomain),path:new ve(n.pathString)}},ji=function(e){var t="",n="",r="",o="",c="",h=!0,d="https",f=443;if("string"==typeof e){var _=e.indexOf("//");_>=0&&(d=e.substring(0,_-1),e=e.substring(_+2));var v=e.indexOf("/");-1===v&&(v=e.length);var y=e.indexOf("?");-1===y&&(y=e.length),t=e.substring(0,Math.min(v,y)),v<y&&(o=function(e){for(var t="",n=e.split("/"),i=0;i<n.length;i++)if(n[i].length>0){var r=n[i];try{r=decodeURIComponent(r.replace(/\+/g," "))}catch(e){}t+="/"+r}return t}(e.substring(v,y)));var m=function(e){var t,n,r={};"?"===e.charAt(0)&&(e=e.substring(1));try{for(var o=Object(l.g)(e.split("&")),c=o.next();!c.done;c=o.next()){var h=c.value;if(0!==h.length){var d=h.split("=");2===d.length?r[decodeURIComponent(d[0])]=decodeURIComponent(d[1]):D("Invalid query segment '"+h+"' in query '"+e+"'")}}}catch(e){t={error:e}}finally{try{c&&!c.done&&(n=o.return)&&n.call(o)}finally{if(t)throw t.error}}return r}(e.substring(Math.min(e.length,y)));(_=t.indexOf(":"))>=0?(h="https"===d||"wss"===d,f=parseInt(t.substring(_+1),10)):_=t.length;var w=t.slice(0,_);if("localhost"===w.toLowerCase())n="localhost";else if(w.split(".").length<=2)n=w;else{var C=t.indexOf(".");r=t.substring(0,C).toLowerCase(),n=t.substring(C+1),c=r}"ns"in m&&(c=m.ns)}return{host:t,port:f,domain:n,subdomain:r,secure:h,scheme:d,pathString:o,namespace:c}},Ni=function(){function e(e,t,n,r){this.eventType=e,this.eventRegistration=t,this.snapshot=n,this.prevName=r}return e.prototype.getPath=function(){var e=this.snapshot.ref;return"value"===this.eventType?e._path:e.parent._path},e.prototype.getEventType=function(){return this.eventType},e.prototype.getEventRunner=function(){return this.eventRegistration.getEventRunner(this)},e.prototype.toString=function(){return this.getPath().toString()+":"+this.eventType+":"+Object(c.D)(this.snapshot.exportVal())},e}(),Ri=function(){function e(e,t,path){this.eventRegistration=e,this.error=t,this.path=path}return e.prototype.getPath=function(){return this.path},e.prototype.getEventType=function(){return"cancel"},e.prototype.getEventRunner=function(){return this.eventRegistration.getEventRunner(this)},e.prototype.toString=function(){return this.path.toString()+":cancel"},e}(),Di=function(){function e(e,t){this.snapshotCallback=e,this.cancelCallback=t}return e.prototype.onValue=function(e,t){this.snapshotCallback.call(null,e,t)},e.prototype.onCancel=function(e){return Object(c.e)(this.hasCancelCallback,"Raising a cancel event on a listener with no cancel callback"),this.cancelCallback.call(null,e)},Object.defineProperty(e.prototype,"hasCancelCallback",{get:function(){return!!this.cancelCallback},enumerable:!1,configurable:!0}),e.prototype.matches=function(e){return this.snapshotCallback===e.snapshotCallback||this.snapshotCallback.userCallback===e.snapshotCallback.userCallback&&this.snapshotCallback.context===e.snapshotCallback.context},e}(),Ai=function(){function e(e,t){this._repo=e,this._path=t}return e.prototype.cancel=function(){var e=new c.a;return vi(this._repo,this._path,e.wrapCallback((function(){}))),e.promise},e.prototype.remove=function(){Jr("OnDisconnect.remove",this._path);var e=new c.a;return yi(this._repo,this._path,null,e.wrapCallback((function(){}))),e.promise},e.prototype.set=function(e){Jr("OnDisconnect.set",this._path),Vr("OnDisconnect.set",e,this._path,!1);var t=new c.a;return yi(this._repo,this._path,e,t.wrapCallback((function(){}))),t.promise},e.prototype.setWithPriority=function(e,t){Jr("OnDisconnect.setWithPriority",this._path),Vr("OnDisconnect.setWithPriority",e,this._path,!1),Yr("OnDisconnect.setWithPriority",t,!1);var n=new c.a;return function(e,path,t,n,r){var o=lt(t,n);e.server_.onDisconnectPut(path.toString(),o.val(!0),(function(t,n){"ok"===t&&Ft(e.onDisconnect_,path,o),wi(e,r,t,n)}))}(this._repo,this._path,e,t,n.wrapCallback((function(){}))),n.promise},e.prototype.update=function(e){Jr("OnDisconnect.update",this._path),zr("OnDisconnect.update",e,this._path,!1);var t=new c.a;return function(e,path,t,n){if(Object(c.r)(t))return x("onDisconnect().update() called with empty data.  Don't do anything."),void wi(e,n,"ok",void 0);e.server_.onDisconnectMerge(path.toString(),t,(function(r,o){"ok"===r&&V(t,(function(t,n){var r=lt(n);Ft(e.onDisconnect_,Te(path,t),r)})),wi(e,n,r,o)}))}(this._repo,this._path,e,t.wrapCallback((function(){}))),t.promise},e}(),Fi=function(){function e(e,t,n,r){this._repo=e,this._path=t,this._queryParams=n,this._orderByCalled=r}return Object.defineProperty(e.prototype,"key",{get:function(){return Ee(this._path)?null:we(this._path)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"ref",{get:function(){return new Wi(this._repo,this._path)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"_queryIdentifier",{get:function(){var e=Nt(this._queryParams),t=B(e);return"{}"===t?"default":t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"_queryObject",{get:function(){return Nt(this._queryParams)},enumerable:!1,configurable:!0}),e.prototype.isEqual=function(t){if(!((t=Object(c.o)(t))instanceof e))return!1;var n=this._repo===t._repo,r=Se(this._path,t._path),o=this._queryIdentifier===t._queryIdentifier;return n&&r&&o},e.prototype.toJSON=function(){return this.toString()},e.prototype.toString=function(){return this._repo.toString()+function(path){for(var e="",i=path.pieceNum_;i<path.pieces_.length;i++)""!==path.pieces_[i]&&(e+="/"+encodeURIComponent(String(path.pieces_[i])));return e||"/"}(this._path)},e}();function qi(e,t){if(!0===e._orderByCalled)throw new Error(t+": You can't combine multiple orderBy calls.")}function Mi(e){var t=null,n=null;if(e.hasStart()&&(t=e.getIndexStartValue()),e.hasEnd()&&(n=e.getIndexEndValue()),e.getIndex()===We){var r="Query: When ordering by key, you may only pass one argument to startAt(), endAt(), or equalTo().",o="Query: When ordering by key, the argument passed to startAt(), startAfter(), endAt(), endBefore(), or equalTo() must be a string.";if(e.hasStart()){if(e.getIndexStartName()!==F)throw new Error(r);if("string"!=typeof t)throw new Error(o)}if(e.hasEnd()){if(e.getIndexEndName()!==M)throw new Error(r);if("string"!=typeof n)throw new Error(o)}}else if(e.getIndex()===tt){if(null!=t&&!Qr(t)||null!=n&&!Qr(n))throw new Error("Query: When ordering by priority, the first argument passed to startAt(), startAfter() endAt(), endBefore(), or equalTo() must be a valid priority value (null, a number, or a string).")}else if(Object(c.e)(e.getIndex()instanceof ft||e.getIndex()===_t,"unknown index type."),null!=t&&"object"==typeof t||null!=n&&"object"==typeof n)throw new Error("Query: First argument passed to startAt(), startAfter(), endAt(), endBefore(), or equalTo() cannot be an object.")}function Li(e){if(e.hasStart()&&e.hasEnd()&&e.hasLimit()&&!e.hasAnchoredLimit())throw new Error("Query: Can't combine startAt(), startAfter(), endAt(), endBefore(), and limit(). Use limitToFirst() or limitToLast() instead.")}var Wi=function(e){function t(t,path){return e.call(this,t,path,new It,!1)||this}return Object(l.c)(t,e),Object.defineProperty(t.prototype,"parent",{get:function(){var e=Oe(this._path);return null===e?null:new t(this._repo,e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"root",{get:function(){for(var e=this;null!==e.parent;)e=e.parent;return e},enumerable:!1,configurable:!0}),t}(Fi),Ui=function(){function e(e,t,n){this._node=e,this.ref=t,this._index=n}return Object.defineProperty(e.prototype,"priority",{get:function(){return this._node.getPriority().val()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"key",{get:function(){return this.ref.key},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"size",{get:function(){return this._node.numChildren()},enumerable:!1,configurable:!0}),e.prototype.child=function(path){var t=new ve(path),n=Vi(this.ref,path);return new e(this._node.getChild(t),n,tt)},e.prototype.exists=function(){return!this._node.isEmpty()},e.prototype.exportVal=function(){return this._node.val(!0)},e.prototype.forEach=function(t){var n=this;return!this._node.isLeafNode()&&!!this._node.forEachChild(this._index,(function(r,o){return t(new e(o,Vi(n.ref,r),tt))}))},e.prototype.hasChild=function(path){var e=new ve(path);return!this._node.getChild(e).isEmpty()},e.prototype.hasChildren=function(){return!this._node.isLeafNode()&&!this._node.isEmpty()},e.prototype.toJSON=function(){return this.exportVal()},e.prototype.val=function(){return this._node.val()},e}();function Bi(e,path){return(e=Object(c.o)(e))._checkNotDeleted("ref"),void 0!==path?Vi(e._root,path):e._root}function Qi(e,t){(e=Object(c.o)(e))._checkNotDeleted("refFromURL");var n=xi(t,e._repo.repoInfo_.nodeAdmin);Xr("refFromURL",n);var r=n.repoInfo;return e._repo.repoInfo_.isCustomHost()||r.host===e._repo.repoInfo_.host||R("refFromURL: Host name does not match the current database: (found "+r.host+" but expected "+e._repo.repoInfo_.host+")"),Bi(e,n.path.toString())}function Vi(e,path){var t,n,r,o;return null===ge((e=Object(c.o)(e))._path)?(t="child",n="path",o=!1,(r=path)&&(r=r.replace(/^\/*\.info(\/|$)/,"/")),$r(t,n,r,o)):$r("child","path",path,!1),new Wi(e._repo,Te(e._path,path))}function Hi(e,t){e=Object(c.o)(e),Jr("push",e._path),Vr("push",t,e._path,!0);var n,r=ui(e._repo),o=yt(r),l=Vi(e,o),h=Vi(e,o);return n=null!=t?Yi(h,t).then((function(){return h})):Promise.resolve(h),l.then=n.then.bind(n),l.catch=n.then.bind(n,void 0),l}function zi(e){return Jr("remove",e._path),Yi(e,null)}function Yi(e,t){e=Object(c.o)(e),Jr("set",e._path),Vr("set",t,e._path,!1);var n=new c.a;return _i(e._repo,e._path,t,null,n.wrapCallback((function(){}))),n.promise}function Ki(e,t){e=Object(c.o)(e),Jr("setPriority",e._path),Yr("setPriority",t,!1);var n=new c.a;return _i(e._repo,Te(e._path,".priority"),t,null,n.wrapCallback((function(){}))),n.promise}function Gi(e,t,n){if(Jr("setWithPriority",e._path),Vr("setWithPriority",t,e._path,!1),Yr("setWithPriority",n,!1),".length"===e.key||".keys"===e.key)throw"setWithPriority failed: "+e.key+" is a read-only object.";var r=new c.a;return _i(e._repo,e._path,t,n,r.wrapCallback((function(){}))),r.promise}function $i(e,t){zr("update",t,e._path,!1);var n=new c.a;return function(e,path,t,n){bi(e,"update",{path:path.toString(),value:t});var r=!0,o=ci(e),c={};if(V(t,(function(t,n){r=!1,c[t]=Sr(Te(path,t),lt(n),e.serverSyncTree_,o)})),r)x("update() called with empty data.  Don't do anything."),wi(e,n,"ok",void 0);else{var l=fi(e),h=ar(e.serverSyncTree_,path,c,l);ti(e.eventQueue_,h),e.server_.merge(path.toString(),t,(function(t,r){var o="ok"===t;o||D("update at "+path+" failed: "+t);var c=sr(e.serverSyncTree_,l,!o),h=c.length>0?Ti(e,path):path;ri(e.eventQueue_,h,c),wi(e,n,t,r)})),V(t,(function(t){var n=Si(e,Te(path,t));Ti(e,n)})),ri(e.eventQueue_,path,[])}}(e._repo,e._path,t,n.wrapCallback((function(){}))),n.promise}function Ji(e){return function(e,t){var n=pr(e.serverSyncTree_,t);return null!=n?Promise.resolve(n):e.server_.get(t).then((function(n){var r=lt(n).withIndex(t._queryParams.getIndex()),o=ur(e.serverSyncTree_,t._path,r);return ni(e.eventQueue_,t._path,o),Promise.resolve(r)}),(function(n){return bi(e,"get for query "+Object(c.D)(t)+" failed: "+n),Promise.reject(new Error(n))}))}((e=Object(c.o)(e))._repo,e).then((function(t){return new Ui(t,new Wi(e._repo,e._path),e._queryParams.getIndex())}))}var Xi=function(){function e(e){this.callbackContext=e}return e.prototype.respondsTo=function(e){return"value"===e},e.prototype.createEvent=function(e,t){var n=t._queryParams.getIndex();return new Ni("value",this,new Ui(e.snapshotNode,new Wi(t._repo,t._path),n))},e.prototype.getEventRunner=function(e){var t=this;return"cancel"===e.getEventType()?function(){return t.callbackContext.onCancel(e.error)}:function(){return t.callbackContext.onValue(e.snapshot,null)}},e.prototype.createCancelEvent=function(e,path){return this.callbackContext.hasCancelCallback?new Ri(this,e,path):null},e.prototype.matches=function(t){return t instanceof e&&(!t.callbackContext||!this.callbackContext||t.callbackContext.matches(this.callbackContext))},e.prototype.hasAnyCallback=function(){return null!==this.callbackContext},e}(),Zi=function(){function e(e,t){this.eventType=e,this.callbackContext=t}return e.prototype.respondsTo=function(e){var t="children_added"===e?"child_added":e;return t="children_removed"===t?"child_removed":t,this.eventType===t},e.prototype.createCancelEvent=function(e,path){return this.callbackContext.hasCancelCallback?new Ri(this,e,path):null},e.prototype.createEvent=function(e,t){Object(c.e)(null!=e.childName,"Child events should have a childName.");var n=Vi(new Wi(t._repo,t._path),e.childName),r=t._queryParams.getIndex();return new Ni(e.type,this,new Ui(e.snapshotNode,n,r),e.prevName)},e.prototype.getEventRunner=function(e){var t=this;return"cancel"===e.getEventType()?function(){return t.callbackContext.onCancel(e.error)}:function(){return t.callbackContext.onValue(e.snapshot,e.prevName)}},e.prototype.matches=function(t){return t instanceof e&&(this.eventType===t.eventType&&(!this.callbackContext||!t.callbackContext||this.callbackContext.matches(t.callbackContext)))},e.prototype.hasAnyCallback=function(){return!!this.callbackContext},e}();function eo(e,t,n,r,o){var c;if("object"==typeof r&&(c=void 0,o=r),"function"==typeof r&&(c=r),o&&o.onlyOnce){var l=n,h=function(t,n){gi(e._repo,e,f),l(t,n)};h.userCallback=n.userCallback,h.context=n.context,n=h}var d=new Di(n,c||void 0),f="value"===t?new Xi(d):new Zi(t,d);return function(e,t,n){var r;r=".info"===ge(t._path)?lr(e.infoSyncTree_,t,n):lr(e.serverSyncTree_,t,n),ni(e.eventQueue_,t._path,r)}(e._repo,e,f),function(){return gi(e._repo,e,f)}}function to(e,t,n,r){return eo(e,"value",t,n,r)}function no(e,t,n,r){return eo(e,"child_added",t,n,r)}function ro(e,t,n,r){return eo(e,"child_changed",t,n,r)}function io(e,t,n,r){return eo(e,"child_moved",t,n,r)}function oo(e,t,n,r){return eo(e,"child_removed",t,n,r)}function ao(e,t,n){var r=null,o=n?new Di(n):null;"value"===t?r=new Xi(o):t&&(r=new Zi(t,o)),gi(e._repo,e,r)}var so=function(){},uo=function(e){function t(t,n){var r=e.call(this)||this;return r._value=t,r._key=n,r}return Object(l.c)(t,e),t.prototype._apply=function(e){Vr("endAt",this._value,e._path,!0);var t=Pt(e._queryParams,this._value,this._key);if(Li(t),Mi(t),e._queryParams.hasEnd())throw new Error("endAt: Starting point was already set (by another call to endAt, endBefore or equalTo).");return new Fi(e._repo,e._path,t,e._orderByCalled)},t}(so);function co(e,t){return Gr("endAt","key",t,!0),new uo(e,t)}var lo=function(e){function t(t,n){var r=e.call(this)||this;return r._value=t,r._key=n,r}return Object(l.c)(t,e),t.prototype._apply=function(e){Vr("endBefore",this._value,e._path,!1);var t,n,r,o,c=(t=e._queryParams,n=this._value,r=this._key,t.index_===We?("string"==typeof n&&(n=mt(n)),o=Pt(t,n,r)):o=Pt(t,n,null==r?F:mt(r)),o.endBeforeSet_=!0,o);if(Li(c),Mi(c),e._queryParams.hasEnd())throw new Error("endBefore: Starting point was already set (by another call to endAt, endBefore or equalTo).");return new Fi(e._repo,e._path,c,e._orderByCalled)},t}(so);function ho(e,t){return Gr("endBefore","key",t,!0),new lo(e,t)}var po=function(e){function t(t,n){var r=e.call(this)||this;return r._value=t,r._key=n,r}return Object(l.c)(t,e),t.prototype._apply=function(e){Vr("startAt",this._value,e._path,!0);var t=St(e._queryParams,this._value,this._key);if(Li(t),Mi(t),e._queryParams.hasStart())throw new Error("startAt: Starting point was already set (by another call to startAt, startBefore or equalTo).");return new Fi(e._repo,e._path,t,e._orderByCalled)},t}(so);function fo(e,t){return void 0===e&&(e=null),Gr("startAt","key",t,!0),new po(e,t)}var _o=function(e){function t(t,n){var r=e.call(this)||this;return r._value=t,r._key=n,r}return Object(l.c)(t,e),t.prototype._apply=function(e){Vr("startAfter",this._value,e._path,!1);var t=function(e,t,n){var r;if(e.index_===We)"string"==typeof t&&(t=gt(t)),r=St(e,t,n);else{r=St(e,t,null==n?M:gt(n))}return r.startAfterSet_=!0,r}(e._queryParams,this._value,this._key);if(Li(t),Mi(t),e._queryParams.hasStart())throw new Error("startAfter: Starting point was already set (by another call to startAt, startAfter, or equalTo).");return new Fi(e._repo,e._path,t,e._orderByCalled)},t}(so);function vo(e,t){return Gr("startAfter","key",t,!0),new _o(e,t)}var yo=function(e){function t(t){var n=e.call(this)||this;return n._limit=t,n}return Object(l.c)(t,e),t.prototype._apply=function(e){if(e._queryParams.hasLimit())throw new Error("limitToFirst: Limit was already set (by another call to limitToFirst or limitToLast).");return new Fi(e._repo,e._path,(t=e._queryParams,n=this._limit,(r=t.copy()).limitSet_=!0,r.limit_=n,r.viewFrom_="l",r),e._orderByCalled);var t,n,r},t}(so);function go(e){if("number"!=typeof e||Math.floor(e)!==e||e<=0)throw new Error("limitToFirst: First argument must be a positive integer.");return new yo(e)}var mo=function(e){function t(t){var n=e.call(this)||this;return n._limit=t,n}return Object(l.c)(t,e),t.prototype._apply=function(e){if(e._queryParams.hasLimit())throw new Error("limitToLast: Limit was already set (by another call to limitToFirst or limitToLast).");return new Fi(e._repo,e._path,(t=e._queryParams,n=this._limit,(r=t.copy()).limitSet_=!0,r.limit_=n,r.viewFrom_="r",r),e._orderByCalled);var t,n,r},t}(so);function bo(e){if("number"!=typeof e||Math.floor(e)!==e||e<=0)throw new Error("limitToLast: First argument must be a positive integer.");return new mo(e)}var wo=function(e){function t(t){var n=e.call(this)||this;return n._path=t,n}return Object(l.c)(t,e),t.prototype._apply=function(e){qi(e,"orderByChild");var t=new ve(this._path);if(Ee(t))throw new Error("orderByChild: cannot pass in empty path. Use orderByValue() instead.");var n=new ft(t),r=xt(e._queryParams,n);return Mi(r),new Fi(e._repo,e._path,r,!0)},t}(so);function Co(path){if("$key"===path)throw new Error('orderByChild: "$key" is invalid.  Use orderByKey() instead.');if("$priority"===path)throw new Error('orderByChild: "$priority" is invalid.  Use orderByPriority() instead.');if("$value"===path)throw new Error('orderByChild: "$value" is invalid.  Use orderByValue() instead.');return $r("orderByChild","path",path,!1),new wo(path)}var Oo=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Object(l.c)(t,e),t.prototype._apply=function(e){qi(e,"orderByKey");var t=xt(e._queryParams,We);return Mi(t),new Fi(e._repo,e._path,t,!0)},t}(so);function To(){return new Oo}var Eo=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Object(l.c)(t,e),t.prototype._apply=function(e){qi(e,"orderByPriority");var t=xt(e._queryParams,tt);return Mi(t),new Fi(e._repo,e._path,t,!0)},t}(so);function ko(){return new Eo}var Io=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Object(l.c)(t,e),t.prototype._apply=function(e){qi(e,"orderByValue");var t=xt(e._queryParams,_t);return Mi(t),new Fi(e._repo,e._path,t,!0)},t}(so);function So(){return new Io}var Po=function(e){function t(t,n){var r=e.call(this)||this;return r._value=t,r._key=n,r}return Object(l.c)(t,e),t.prototype._apply=function(e){if(Vr("equalTo",this._value,e._path,!1),e._queryParams.hasStart())throw new Error("equalTo: Starting point was already set (by another call to startAt/startAfter or equalTo).");if(e._queryParams.hasEnd())throw new Error("equalTo: Ending point was already set (by another call to endAt/endBefore or equalTo).");return new uo(this._value,this._key)._apply(new po(this._value,this._key)._apply(e))},t}(so);function xo(e,t){return Gr("equalTo","key",t,!0),new Po(e,t)}function jo(e){for(var t,n,r=[],o=1;o<arguments.length;o++)r[o-1]=arguments[o];var h=Object(c.o)(e);try{for(var d=Object(l.g)(r),f=d.next();!f.done;f=d.next()){var _=f.value;h=_._apply(h)}}catch(e){t={error:e}}finally{try{f&&!f.done&&(n=d.return)&&n.call(d)}finally{if(t)throw t.error}}return h}!function(e){Object(c.e)(!qn,"__referenceConstructor has already been defined"),qn=e}(Wi),function(e){Object(c.e)(!Vn,"__referenceConstructor has already been defined"),Vn=e}(Wi);var No={},Ro=!1;function Do(t,n,r,o,c){var l=o||t.options.databaseURL;void 0===l&&(t.options.projectId||R("Can't determine Firebase Database URL. Be sure to include  a Project ID when calling firebase.initializeApp()."),x("Using default host for project ",t.options.projectId),l=t.options.projectId+"-default-rtdb.firebaseio.com");var h,d=xi(l,c),f=d.repoInfo,_=void 0;void 0!==e&&(_=e.env.FIREBASE_DATABASE_EMULATOR_HOST),_?(h=!0,l="http://"+_+"?ns="+f.namespace,f=(d=xi(l,c)).repoInfo):h=!d.repoInfo.secure;var v=c&&h?new X(X.OWNER):new J(t.name,t.options,n);Xr("Invalid Firebase Database URL",d),Ee(d.path)||R("Database URL must point to the root of a Firebase Database (not including a child path).");var y=function(e,t,n,r){var o=No[t.name];o||(o={},No[t.name]=o);var c=o[e.toURLString()];c&&R("Database initialized multiple times. Please make sure the format of the database URL matches with each database() call.");return c=new ai(e,Ro,n,r),o[e.toURLString()]=c,c}(f,t,v,new $(t.name,r));return new Ao(y,t)}var Ao=function(){function e(e,t){this._repoInternal=e,this.app=t,this.type="database",this._instanceStarted=!1}return Object.defineProperty(e.prototype,"_repo",{get:function(){return this._instanceStarted||(si(this._repoInternal,this.app.options.appId,this.app.options.databaseAuthVariableOverride),this._instanceStarted=!0),this._repoInternal},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"_root",{get:function(){return this._rootInternal||(this._rootInternal=new Wi(this._repo,ye())),this._rootInternal},enumerable:!1,configurable:!0}),e.prototype._delete=function(){var e,t,n;return this._checkNotDeleted("delete"),e=this._repo,t=this.app.name,(n=No[t])&&n[e.key]===e||R("Database "+t+"("+e.repoInfo_+") has already been deleted."),mi(e),delete n[e.key],this._repoInternal=null,this._rootInternal=null,Promise.resolve()},e.prototype._checkNotDeleted=function(e){null===this._rootInternal&&R("Cannot call "+e+" on a deleted database.")},e}();function Fo(e,t,n,r){void 0===r&&(r={}),(e=Object(c.o)(e))._checkNotDeleted("useEmulator"),e._instanceStarted&&R("Cannot call useEmulator() after instance has already been initialized.");var o=e._repoInternal,l=void 0;if(o.repoInfo_.nodeAdmin)r.mockUserToken&&R('mockUserToken is not supported by the Admin SDK. For client access with mock users, please use the "firebase" package instead of "firebase-admin".'),l=new X(X.OWNER);else if(r.mockUserToken){var h=Object(c.j)(r.mockUserToken,e.app.options.projectId);l=new X(h)}!function(e,t,n,r){e.repoInfo_=new ee(t+":"+n,!1,e.repoInfo_.namespace,e.repoInfo_.webSocketOnly,e.repoInfo_.nodeAdmin,e.repoInfo_.persistenceKey,e.repoInfo_.includeNamespaceInQueryParams),r&&(e.authTokenProvider_=r)}(o,t,n,l)}function qo(e){(e=Object(c.o)(e))._checkNotDeleted("goOffline"),mi(e._repo)}function Mo(e){var t;(e=Object(c.o)(e))._checkNotDeleted("goOnline"),(t=e._repo).persistentConnection_&&t.persistentConnection_.resume("repo_interrupt")}var Lo={".sv":"timestamp"};var Wo=function(){function e(e,t){this.committed=e,this.snapshot=t}return e.prototype.toJSON=function(){return{committed:this.committed,snapshot:this.snapshot.toJSON()}},e}();function Uo(e,t,n){var r;if(e=Object(c.o)(e),Jr("Reference.transaction",e._path),".length"===e.key||".keys"===e.key)throw"Reference.transaction failed: "+e.key+" is a read-only object.";var o=null===(r=null==n?void 0:n.applyLocally)||void 0===r||r,l=new c.a,h=to(e,(function(){}));return function(e,path,t,n,r,o){bi(e,"transaction on "+path);var l={path:path,update:t,onComplete:n,status:null,order:T(),applyLocally:o,retryCount:0,unwatcher:r,abortReason:null,currentWriteId:null,currentInputSnapshot:null,currentOutputSnapshotRaw:null,currentOutputSnapshotResolved:null},h=Ci(e,path,void 0);l.currentInputSnapshot=h;var d=l.update(h.val());if(void 0===d)l.unwatcher(),l.currentOutputSnapshotRaw=null,l.currentOutputSnapshotResolved=null,l.onComplete&&l.onComplete(null,!1,l.currentInputSnapshot);else{Hr("transaction failed: Data returned ",d,l.path),l.status=0;var f=Nr(e.transactionQueueTree_,path),_=Rr(f)||[];_.push(l),Dr(f,_);var v=void 0;if("object"==typeof d&&null!==d&&Object(c.i)(d,".priority"))v=Object(c.A)(d,".priority"),Object(c.e)(Qr(v),"Invalid priority returned by transaction. Priority must be a valid string, finite number, server value, or null.");else v=(dr(e.serverSyncTree_,path)||ut.EMPTY_NODE).getPriority().val();var y=ci(e),m=lt(d,v),w=Pr(m,h,y);l.currentOutputSnapshotRaw=m,l.currentOutputSnapshotResolved=w,l.currentWriteId=fi(e);var C=or(e.serverSyncTree_,path,w,l.currentWriteId,l.applyLocally);ri(e.eventQueue_,path,C),Oi(e,e.transactionQueueTree_)}}(e._repo,e._path,t,(function(t,n,r){var o=null;t?l.reject(t):(o=new Ui(r,new Wi(e._repo,e._path),tt),l.resolve(new Wo(n,o)))}),h,o),l.promise}var Bo=function(){function e(e){this._delegate=e}return e.prototype.cancel=function(e){Object(c.E)("OnDisconnect.cancel",0,1,arguments.length),Object(c.F)("OnDisconnect.cancel","onComplete",e,!0);var t=this._delegate.cancel();return e&&t.then((function(){return e(null)}),(function(t){return e(t)})),t},e.prototype.remove=function(e){Object(c.E)("OnDisconnect.remove",0,1,arguments.length),Object(c.F)("OnDisconnect.remove","onComplete",e,!0);var t=this._delegate.remove();return e&&t.then((function(){return e(null)}),(function(t){return e(t)})),t},e.prototype.set=function(e,t){Object(c.E)("OnDisconnect.set",1,2,arguments.length),Object(c.F)("OnDisconnect.set","onComplete",t,!0);var n=this._delegate.set(e);return t&&n.then((function(){return t(null)}),(function(e){return t(e)})),n},e.prototype.setWithPriority=function(e,t,n){Object(c.E)("OnDisconnect.setWithPriority",2,3,arguments.length),Object(c.F)("OnDisconnect.setWithPriority","onComplete",n,!0);var r=this._delegate.setWithPriority(e,t);return n&&r.then((function(){return n(null)}),(function(e){return n(e)})),r},e.prototype.update=function(e,t){if(Object(c.E)("OnDisconnect.update",1,2,arguments.length),Array.isArray(e)){for(var n={},i=0;i<e.length;++i)n[""+i]=e[i];e=n,D("Passing an Array to firebase.database.onDisconnect().update() is deprecated. Use set() if you want to overwrite the existing data, or an Object with integer keys if you really do want to only update some of the children.")}Object(c.F)("OnDisconnect.update","onComplete",t,!0);var r=this._delegate.update(e);return t&&r.then((function(){return t(null)}),(function(e){return t(e)})),r},e}(),Qo=function(){function e(e,t){this.committed=e,this.snapshot=t}return e.prototype.toJSON=function(){return Object(c.E)("TransactionResult.toJSON",0,1,arguments.length),{committed:this.committed,snapshot:this.snapshot.toJSON()}},e}(),Vo=function(){function e(e,t){this._database=e,this._delegate=t}return e.prototype.val=function(){return Object(c.E)("DataSnapshot.val",0,0,arguments.length),this._delegate.val()},e.prototype.exportVal=function(){return Object(c.E)("DataSnapshot.exportVal",0,0,arguments.length),this._delegate.exportVal()},e.prototype.toJSON=function(){return Object(c.E)("DataSnapshot.toJSON",0,1,arguments.length),this._delegate.toJSON()},e.prototype.exists=function(){return Object(c.E)("DataSnapshot.exists",0,0,arguments.length),this._delegate.exists()},e.prototype.child=function(path){return Object(c.E)("DataSnapshot.child",0,1,arguments.length),path=String(path),$r("DataSnapshot.child","path",path,!1),new e(this._database,this._delegate.child(path))},e.prototype.hasChild=function(path){return Object(c.E)("DataSnapshot.hasChild",1,1,arguments.length),$r("DataSnapshot.hasChild","path",path,!1),this._delegate.hasChild(path)},e.prototype.getPriority=function(){return Object(c.E)("DataSnapshot.getPriority",0,0,arguments.length),this._delegate.priority},e.prototype.forEach=function(t){var n=this;return Object(c.E)("DataSnapshot.forEach",1,1,arguments.length),Object(c.F)("DataSnapshot.forEach","action",t,!1),this._delegate.forEach((function(r){return t(new e(n._database,r))}))},e.prototype.hasChildren=function(){return Object(c.E)("DataSnapshot.hasChildren",0,0,arguments.length),this._delegate.hasChildren()},Object.defineProperty(e.prototype,"key",{get:function(){return this._delegate.key},enumerable:!1,configurable:!0}),e.prototype.numChildren=function(){return Object(c.E)("DataSnapshot.numChildren",0,0,arguments.length),this._delegate.size},e.prototype.getRef=function(){return Object(c.E)("DataSnapshot.ref",0,0,arguments.length),new zo(this._database,this._delegate.ref)},Object.defineProperty(e.prototype,"ref",{get:function(){return this.getRef()},enumerable:!1,configurable:!0}),e}(),Ho=function(){function e(e,t){this.database=e,this._delegate=t}return e.prototype.on=function(t,n,r,o){var l,h=this;Object(c.E)("Query.on",2,4,arguments.length),Object(c.F)("Query.on","callback",n,!1);var d=e.getCancelAndContextArgs_("Query.on",r,o),f=function(e,t){n.call(d.context,new Vo(h.database,e),t)};f.userCallback=n,f.context=d.context;var _=null===(l=d.cancel)||void 0===l?void 0:l.bind(d.context);switch(t){case"value":return to(this._delegate,f,_),n;case"child_added":return no(this._delegate,f,_),n;case"child_removed":return oo(this._delegate,f,_),n;case"child_changed":return ro(this._delegate,f,_),n;case"child_moved":return io(this._delegate,f,_),n;default:throw new Error(Object(c.n)("Query.on","eventType")+'must be a valid event type = "value", "child_added", "child_removed", "child_changed", or "child_moved".')}},e.prototype.off=function(e,t,n){if(Object(c.E)("Query.off",0,3,arguments.length),Kr("Query.off",e,!0),Object(c.F)("Query.off","callback",t,!0),Object(c.G)("Query.off","context",n,!0),t){var r=function(){};r.userCallback=t,r.context=n,ao(this._delegate,e,r)}else ao(this._delegate,e)},e.prototype.get=function(){var e=this;return Ji(this._delegate).then((function(t){return new Vo(e.database,t)}))},e.prototype.once=function(t,n,r,o){var l=this;Object(c.E)("Query.once",1,4,arguments.length),Object(c.F)("Query.once","callback",n,!0);var h=e.getCancelAndContextArgs_("Query.once",r,o),d=new c.a,f=function(e,t){var r=new Vo(l.database,e);n&&n.call(h.context,r,t),d.resolve(r)};f.userCallback=n,f.context=h.context;var _=function(e){h.cancel&&h.cancel.call(h.context,e),d.reject(e)};switch(t){case"value":to(this._delegate,f,_,{onlyOnce:!0});break;case"child_added":no(this._delegate,f,_,{onlyOnce:!0});break;case"child_removed":oo(this._delegate,f,_,{onlyOnce:!0});break;case"child_changed":ro(this._delegate,f,_,{onlyOnce:!0});break;case"child_moved":io(this._delegate,f,_,{onlyOnce:!0});break;default:throw new Error(Object(c.n)("Query.once","eventType")+'must be a valid event type = "value", "child_added", "child_removed", "child_changed", or "child_moved".')}return d.promise},e.prototype.limitToFirst=function(t){return Object(c.E)("Query.limitToFirst",1,1,arguments.length),new e(this.database,jo(this._delegate,go(t)))},e.prototype.limitToLast=function(t){return Object(c.E)("Query.limitToLast",1,1,arguments.length),new e(this.database,jo(this._delegate,bo(t)))},e.prototype.orderByChild=function(path){return Object(c.E)("Query.orderByChild",1,1,arguments.length),new e(this.database,jo(this._delegate,Co(path)))},e.prototype.orderByKey=function(){return Object(c.E)("Query.orderByKey",0,0,arguments.length),new e(this.database,jo(this._delegate,To()))},e.prototype.orderByPriority=function(){return Object(c.E)("Query.orderByPriority",0,0,arguments.length),new e(this.database,jo(this._delegate,ko()))},e.prototype.orderByValue=function(){return Object(c.E)("Query.orderByValue",0,0,arguments.length),new e(this.database,jo(this._delegate,So()))},e.prototype.startAt=function(t,n){return void 0===t&&(t=null),Object(c.E)("Query.startAt",0,2,arguments.length),new e(this.database,jo(this._delegate,fo(t,n)))},e.prototype.startAfter=function(t,n){return void 0===t&&(t=null),Object(c.E)("Query.startAfter",0,2,arguments.length),new e(this.database,jo(this._delegate,vo(t,n)))},e.prototype.endAt=function(t,n){return void 0===t&&(t=null),Object(c.E)("Query.endAt",0,2,arguments.length),new e(this.database,jo(this._delegate,co(t,n)))},e.prototype.endBefore=function(t,n){return void 0===t&&(t=null),Object(c.E)("Query.endBefore",0,2,arguments.length),new e(this.database,jo(this._delegate,ho(t,n)))},e.prototype.equalTo=function(t,n){return Object(c.E)("Query.equalTo",1,2,arguments.length),new e(this.database,jo(this._delegate,xo(t,n)))},e.prototype.toString=function(){return Object(c.E)("Query.toString",0,0,arguments.length),this._delegate.toString()},e.prototype.toJSON=function(){return Object(c.E)("Query.toJSON",0,1,arguments.length),this._delegate.toJSON()},e.prototype.isEqual=function(t){if(Object(c.E)("Query.isEqual",1,1,arguments.length),!(t instanceof e)){var n="Query.isEqual failed: First argument must be an instance of firebase.database.Query.";throw new Error(n)}return this._delegate.isEqual(t._delegate)},e.getCancelAndContextArgs_=function(e,t,n){var r={cancel:void 0,context:void 0};if(t&&n)r.cancel=t,Object(c.F)(e,"cancel",r.cancel,!0),r.context=n,Object(c.G)(e,"context",r.context,!0);else if(t)if("object"==typeof t&&null!==t)r.context=t;else{if("function"!=typeof t)throw new Error(Object(c.n)(e,"cancelOrContext")+" must either be a cancel callback or a context object.");r.cancel=t}return r},Object.defineProperty(e.prototype,"ref",{get:function(){return new zo(this.database,new Wi(this._delegate._repo,this._delegate._path))},enumerable:!1,configurable:!0}),e}(),zo=function(e){function t(t,n){var r=e.call(this,t,new Fi(n._repo,n._path,new It,!1))||this;return r.database=t,r._delegate=n,r}return Object(l.c)(t,e),t.prototype.getKey=function(){return Object(c.E)("Reference.key",0,0,arguments.length),this._delegate.key},t.prototype.child=function(e){return Object(c.E)("Reference.child",1,1,arguments.length),"number"==typeof e&&(e=String(e)),new t(this.database,Vi(this._delegate,e))},t.prototype.getParent=function(){Object(c.E)("Reference.parent",0,0,arguments.length);var e=this._delegate.parent;return e?new t(this.database,e):null},t.prototype.getRoot=function(){return Object(c.E)("Reference.root",0,0,arguments.length),new t(this.database,this._delegate.root)},t.prototype.set=function(e,t){Object(c.E)("Reference.set",1,2,arguments.length),Object(c.F)("Reference.set","onComplete",t,!0);var n=Yi(this._delegate,e);return t&&n.then((function(){return t(null)}),(function(e){return t(e)})),n},t.prototype.update=function(e,t){if(Object(c.E)("Reference.update",1,2,arguments.length),Array.isArray(e)){for(var n={},i=0;i<e.length;++i)n[""+i]=e[i];e=n,D("Passing an Array to Firebase.update() is deprecated. Use set() if you want to overwrite the existing data, or an Object with integer keys if you really do want to only update some of the children.")}Jr("Reference.update",this._delegate._path),Object(c.F)("Reference.update","onComplete",t,!0);var r=$i(this._delegate,e);return t&&r.then((function(){return t(null)}),(function(e){return t(e)})),r},t.prototype.setWithPriority=function(e,t,n){Object(c.E)("Reference.setWithPriority",2,3,arguments.length),Object(c.F)("Reference.setWithPriority","onComplete",n,!0);var r=Gi(this._delegate,e,t);return n&&r.then((function(){return n(null)}),(function(e){return n(e)})),r},t.prototype.remove=function(e){Object(c.E)("Reference.remove",0,1,arguments.length),Object(c.F)("Reference.remove","onComplete",e,!0);var t=zi(this._delegate);return e&&t.then((function(){return e(null)}),(function(t){return e(t)})),t},t.prototype.transaction=function(e,t,n){var r=this;Object(c.E)("Reference.transaction",1,3,arguments.length),Object(c.F)("Reference.transaction","transactionUpdate",e,!1),Object(c.F)("Reference.transaction","onComplete",t,!0),Zr("Reference.transaction","applyLocally",n,!0);var o=Uo(this._delegate,e,{applyLocally:n}).then((function(e){return new Qo(e.committed,new Vo(r.database,e.snapshot))}));return t&&o.then((function(e){return t(null,e.committed,e.snapshot)}),(function(e){return t(e,!1,null)})),o},t.prototype.setPriority=function(e,t){Object(c.E)("Reference.setPriority",1,2,arguments.length),Object(c.F)("Reference.setPriority","onComplete",t,!0);var n=Ki(this._delegate,e);return t&&n.then((function(){return t(null)}),(function(e){return t(e)})),n},t.prototype.push=function(e,n){var r=this;Object(c.E)("Reference.push",0,2,arguments.length),Object(c.F)("Reference.push","onComplete",n,!0);var o=Hi(this._delegate,e),l=o.then((function(e){return new t(r.database,e)}));n&&l.then((function(){return n(null)}),(function(e){return n(e)}));var h=new t(this.database,o);return h.then=l.then.bind(l),h.catch=l.catch.bind(l,void 0),h},t.prototype.onDisconnect=function(){return Jr("Reference.onDisconnect",this._delegate._path),new Bo(new Ai(this._delegate._repo,this._delegate._path))},Object.defineProperty(t.prototype,"key",{get:function(){return this.getKey()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"parent",{get:function(){return this.getParent()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"root",{get:function(){return this.getRoot()},enumerable:!1,configurable:!0}),t}(Ho),Yo=function(){function e(e,t){var n=this;this._delegate=e,this.app=t,this.INTERNAL={delete:function(){return n._delegate._delete()}}}return e.prototype.useEmulator=function(e,t,n){void 0===n&&(n={}),Fo(this._delegate,e,t,n)},e.prototype.ref=function(path){if(Object(c.E)("database.ref",0,1,arguments.length),path instanceof zo){var e=Qi(this._delegate,path.toString());return new zo(this,e)}e=Bi(this._delegate,path);return new zo(this,e)},e.prototype.refFromURL=function(e){var t="database.refFromURL";Object(c.E)(t,1,1,arguments.length);var n=Qi(this._delegate,e);return new zo(this,n)},e.prototype.goOffline=function(){return Object(c.E)("database.goOffline",0,0,arguments.length),qo(this._delegate)},e.prototype.goOnline=function(){return Object(c.E)("database.goOnline",0,0,arguments.length),Mo(this._delegate)},e.ServerValue={TIMESTAMP:Lo,increment:function(e){return function(e){return{".sv":{increment:e}}}(e)}},e}();var Ko=Object.freeze({__proto__:null,forceLongPolling:function(){le.forceDisallow(),se.forceAllow()},forceWebSockets:function(){se.forceDisallow()},isWebSocketsAvailable:function(){return le.isAvailable()},setSecurityDebugCallback:function(e,t){e._delegate._repo.persistentConnection_.securityDebugCallback_=t},stats:function(e,t){!function(e,t){if(void 0===t&&(t=!1),"undefined"!=typeof console){var n;t?(e.statsListener_||(e.statsListener_=new Lt(e.stats_)),n=e.statsListener_.get()):n=e.stats_.get();var r=Object.keys(n).reduce((function(e,t){return Math.max(t.length,e)}),0);V(n,(function(e,t){for(var n=e,i=e.length;i<r+2;i++)n+=" ";console.log(n+t)}))}}(e._delegate._repo,t)},statsIncrementCounter:function(e,t){!function(e,t){var n,r;e.stats_.incrementCounter(t),n=e.statsReporter_,r=t,n.statsToReport_[r]=!0}(e._delegate._repo,t)},dataUpdateCount:function(e){return e._delegate._repo.dataUpdateCount},interceptServerData:function(e,t){return function(e,t){e.interceptServerDataCallback_=t}(e._delegate._repo,t)},initStandalone:function(e){var t=e.app,n=e.url,r=e.version,c=e.customAuthImpl,l=e.namespace,h=e.nodeAdmin,d=void 0!==h&&h;f(r);var _=new o.c("auth-internal",new o.b("database-standalone"));return _.setComponent(new o.a("auth-internal",(function(){return c}),"PRIVATE")),{instance:new Yo(Do(t,_,void 0,n,d),t),namespace:l}}}),Go=Fe;Fe.prototype.simpleListen=function(e,t){this.sendRequest("q",{p:e},t)},Fe.prototype.echo=function(data,e){this.sendRequest("echo",{d:data},e)};var $o=de,Jo=ee,Xo=Object.freeze({__proto__:null,DataConnection:Go,RealTimeConnection:$o,hijackHash:function(e){var t=Fe.prototype.put;return Fe.prototype.put=function(n,data,r,o){void 0!==o&&(o=e()),t.call(this,n,data,r,o)},function(){Fe.prototype.put=t}},ConnectionTarget:Jo,queryIdentifier:function(e){return e._delegate._queryIdentifier},forceRestClient:function(e){!function(e){Ro=e}(e)}}),Zo=Yo.ServerValue;!function(e){f(e.SDK_VERSION);var n=e.INTERNAL.registerComponent(new o.a("database",(function(e,t){var n=t.instanceIdentifier,r=e.getProvider("app").getImmediate(),o=e.getProvider("auth-internal"),c=e.getProvider("app-check-internal");return new Yo(Do(r,o,c,n),r)}),"PUBLIC").setServiceProps({Reference:zo,Query:Ho,Database:Yo,DataSnapshot:Vo,enableLogging:P,INTERNAL:Ko,ServerValue:Zo,TEST_ACCESS:Xo}).setMultipleInstances(!0));e.registerVersion("@firebase/database","0.10.8"),Object(c.u)()&&(t.exports=n)}(r.a)}).call(this,n(115),n(904)(e))},904:function(e,t){e.exports=function(e){if(!e.webpackPolyfill){var t=Object.create(e);t.children||(t.children=[]),Object.defineProperty(t,"loaded",{enumerable:!0,get:function(){return t.l}}),Object.defineProperty(t,"id",{enumerable:!0,get:function(){return t.i}}),Object.defineProperty(t,"exports",{enumerable:!0}),t.webpackPolyfill=1}return t}},908:function(e,t,n){"use strict";n.r(t);n(903)}}]);